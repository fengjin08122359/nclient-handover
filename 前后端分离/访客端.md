# 访客端

#### 核心
1. keyFrame 发布订阅
通过发布订阅模式连接不同的用户状态
```javascript
const WEBSOCKETOFF = -2; //断网  
const LIMIT = -1; //访问受限超出访问次数  
const STOP = 0  //初始化状态  
const ROBOT = 1   //机器人对话  
const QUEUE = 2   //排队  
const DEPARTMENT = 3    //业务类型选择  
const CHAT = 4    //对话  
const OUTWORK = 5   //超出工作时间  
const CLOSE = 6   //关闭对话  
```
在每个状态中独立处理
keyFrame参见 [https://www.npmjs.com/package/nclient-microfront](https://www.npmjs.com/package/nclient-microfront) frame片段监听

同时参见 npm组件/发布订阅

2. 组件化
代码组件化划分,不同的目录中处理不同的事务  
visitor -> sdk主入口  
visitor-data -> 数据层  
visitor-http -> 接口连接整理  
visitor-message -> websocket消息连接  

3. vuex和keyframe组合
将分离的部分重组拼接
```javascript
state.keyFrame.addHandler('store', 'visitor-data-skin-logo', (data) => {
  dispatch('skin/setLogo', data, {root: true});
})
```
参见 杂项/sdk与vuex.md

4. 打包更新
参见 杂项/打包

#### 目录: 
- src -> 开发文件夹  
  - components -> 通用插件  
    - Alert -> 提示框  
    - ContextMenu -> 右键菜单  
    - ImgPreview -> 图片预览  
    - validator -> 验证  
    - ChatList -> 对话列表  
    - ForeKnow -> 消息预知  
    - ImgPresend -> 图片,文件预发送  
    - Mcontent -> 输入框  
    - SingleChat -> 单一对话  
    - ToolList -> 工具栏(pc)  
    - Upload -> 文件发送  
    - VueAudio -> 音频  
  - css -> 样式文件  
  - event -> 跨文件交互  
  - images -> 图片  
  - mobile -> 手机端  
    - components -> 插件  
      - Department -> 业务类型  
      - History -> 历史记录  
      - SingleHistory -> 单条历史记录  
      - SystemMsg -> 系统消息  
    - page -> 路由页面  
      - Chat -> 对话  
      - Error -> 错误  
      - Guide -> 引流  
      - Iframe -> iframe网页打开  
      - LeaveMessage -> 留言  
      - Satisfaction -> 满意度  
      - VisitorInfo -> 访客信息收集  
    - router -> 路由  
  - pc -> 网页端  
    - components -> 插件  
      - Aside(dir) -> 边栏  
        - History -> 历史记录  
        - Problem -> 常见问题  
      - Aside -> 边栏主体  
      - Chat -> 对话  
      - Department -> 业务类型  
      - LeaveMessage -> 留言  
      - Satisfaction -> 满意度  
      - SystemMsg -> 系统消息  
      - VisitorInfo -> 访客信息收集  
  - sdk -> sdk接口文件  
    - changeTitle -> 切换标题  
    - faceIco -> 表情  
    - lang -> 多语言  
    - mobileInput -> 手机输入框适配  
    - screenCapture -> 截屏  
    - visitor -> sdk主入口  
    - visitor-data -> 数据层  
    - visitor-http -> 接口连接整理  
    - visitor-message -> websocket消息连接  
  - store -> vuex的实例  
  - util -> 工具文件夹  
- public  
  - static -> 静态文件  
  - images -> 对话静态文件  
  - img -> 图标文件  
  - tools -> websoket使用flash方式连接的文件  
- vue.config.js -> 配置项  




#### sdk改版后的目录: 
- src 
  - sdk
    - control             控制层
      - commonHandle.js   处理通用层方法
      - dataHandle.js     处理数据层方法
      - keyHandle.js      处理外部调用
      - index.js          sdk初始化
    - http                http接口    
      - filter.js         http数据处理  
      - index.js          接口列表
    - language            多语言数据
      - en.js             英语
      - zh_TW.js          繁体中文
      - zh-cn.js          简体中文
    - state               状态层
      - [组件]              (与改版前visitor-data中的相同)
        - data.js         数据层
        - index.js        数据处理
      - ...
    - websocket           websocket
      - index.js          初始化,接收发送消息
      - UccMessage.js     一般消息类型
      - UccReceipts.js    回执消息类型
    - index               sdk入口
  - sdk-extend            sdk外部扩展