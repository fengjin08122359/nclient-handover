!function(e,t,i){var o=[],n=function(e,t,i,o){var n={};return n.webkit=!!t.match(/WebKit\/([\d.]+)/),n.ipod=!(!/iPod/i.test(i)&&!t.match(/(iPod).*OS\s([\d_]+)/)),n.ipad=!(!/iPad/i.test(e.userAgent)&&!t.match(/(iPad).*OS\s([\d_]+)/)),n.iphone=!!(/iPhone/i.test(i)||!n.ipad&&t.match(/(iPhone\sOS)\s([\d_]+)/)),n.mac=/Mac/i.test(i),n.ios=n.ipod||n.ipad||n.iphone,n.safari=!(!t.match(/Safari/)||n.chrome),n.mobileSafari=n.ios&&!!o.match(/(?:Version\/)([\w\._]+)/),n.ios&&(n.iosVersion=parseFloat(o.slice(o.indexOf("Version/")+8))||-1),n}(navigator,navigator.userAgent,navigator.platform,navigator.appVersion||navigator.userAgent);t("html").css({position:"absolute",top:0,left:0,width:"100%",height:"100%"});var a=t("html").width(),s=t("html").height(),r=function(i){return"undefined"==typeof i?document.documentElement.scrollTop+document.body.scrollTop:(t(e).scrollTop(i),t(e).scrollTop())},c=function(){var e=0,t=0;return n.ios&&n.iosVersion<=12&&(e=40,812==screen.height&&375==screen.width?console.log("Æ»¹ûX"):736==screen.height&&414==screen.width?(a>365&&a<385&&(e=40,t=288),a>404&&a<424&&(e=40,t=303)):667==screen.height&&375==screen.width?(a>365&&a<385&&(e=40,t=288),a>404&&a<424&&(e=40,t=303)):568==screen.height&&320==screen.width?console.log("iPhone5"):console.log("iPhone4")),{adjustHeight:e,special:t}}(),l={currentStatus:[],blurClick:0,focusClick:1,onScroll:2,onResize:3,checking:4,checkSuccess:5,blurSuccess:6,blurFail:7,focusAfterInsert:8,checkSuccessNormal:9,checkSuccessIphone:10,checkSuccessAndroid:11,changeStatus:function(e){if(this.blurFail==e)this.currentStatus=[];else if(this.focusAfterInsert==e){var t=this.currentStatus.indexOf(this.blurClick);t>-1&&this.currentStatus.splice(t,1)}else this.blurSuccess==e?this.currentStatus=[]:this.currentStatus.push(e);console.log("currentStatus:"+this.currentStatus)},has:function(e){return this.currentStatus.length>0&&this.currentStatus.indexOf(e)>-1}},d={changeStatus:1,changeCheckTimeout:null,init:function(){console.log(c.adjustHeight,c.special);var i=this;t(e).on("scroll",function(){i.startCheckTimeout&&clearTimeout(i.startCheckTimeout),i.startCheckTimeout=null,l.has(l.blurClick)||(l.changeStatus(l.onScroll),i.changeCheck())}),t(e).on("resize",function(){i.startCheckTimeout&&clearTimeout(i.startCheckTimeout),i.startCheckTimeout=null,l.has(l.blurClick)||(l.changeStatus(l.onResize),i.changeCheck())})},changeCheck:function(){var e=this;this.changeCheckTimeout&&clearTimeout(this.changeCheckTimeout),this.changeCheckTimeout=setTimeout(function(){l.has(l.checking)||e.checkFun()},700)},startCheck:function(){var e=this;navigator.userAgent.match(/.*iphone.*|.*Linux.*|.*AppleWebKit.*Mobile.*/)&&(l.changeStatus(l.focusClick),console.log("startCheckTime"+(new Date).Format("hh:mm:ss")),t("body").height("auto"),t("body").css("bottom",c.adjustHeight),this.startCheckTimeout&&clearTimeout(this.startCheckTimeout),this.startCheckTimeout=setTimeout(function(){e.isWindowChange()?e.changeCheck():e.options.blurInput(e.isDetectedError())},2e3))},isWindowChange:function(){var e=t("html").height(),i=e!=s,o=0!=r();return console.log("scrollY:"+r()),i||o},isInReliableArea:function(){var e=t("html").height(),i=e!==s,o=r(),n=!(c.special&&c.special>o),a=0!=o&&o<s&&n;return i||a},isDetectedError:function(){return!(l.has(l.onScroll)||l.has(l.onResize))},isScorll:!1,checkFun:function(){var e=this;e.isScorll=!1,console.warn("checkFun start"),e.isWindowChange()?(t("body").height("auto"),t("body").css("bottom",c.adjustHeight),l.changeStatus(l.checking),e.isInReliableArea()?(l.changeStatus(l.checkSuccessNormal),e.success()):(r(c.special||99999),e.isScorll=!0,n.ios?(o[0]=1,e.checkIphone(),l.changeStatus(l.checkSuccessIphone)):(o[0]=2,e.checkNotIphone(),l.changeStatus(l.checkSuccessAndroid)))):e.options.blurInput()},success:function(){l.changeStatus(l.checkSuccess),this.savedHeight=t("html").height()},end:function(){var e=this;l.changeStatus(l.blurClick),setTimeout(function(){l.has(l.blurClick)?(e.checkTimeout&&clearTimeout(e.checkTimeout),t("html").css({position:"absolute",top:"0px",left:"0px",width:"100%"}),console.log("end"),t("html").height("100%"),t("body").css("bottom",0),r(0),l.changeStatus(l.blurSuccess)):l.changeStatus(l.blurFail)},100)},checkIphone:function(){var e=this;e.checkTimeout&&clearTimeout(e.checkTimeout),e.checkTimeout=setTimeout(function(){e.checkIphoneFun()},300)},checkNotIphone:function(){var e=this;e.checkTimeout&&clearTimeout(e.checkTimeout),e.checkTimeout=setTimeout(function(){e.checkNotIphoneFun()},500)},samples:[],checkIphoneFun:function(){var t=this;return t.isInReliableArea()?void t.success():(document.activeElement&&document.activeElement.scrollIntoViewIfNeeded&&e.setTimeout(function(){document.activeElement.scrollIntoViewIfNeeded()},0),t.checkTimeout&&clearTimeout(t.checkTimeout),t.samples=[],void t.getSample())},checkNotIphoneFun:function(){var i=this;r()<document.body.scrollHeight&&0!=document.documentElement.scrollTop?(o[0]=1,this.checkIphone()):320!=t("body").width()&&(document.activeElement&&document.activeElement.scrollIntoViewIfNeeded&&e.setTimeout(function(){document.activeElement.scrollIntoViewIfNeeded()},0),i.success())},getSample:function(){var i=this,o=document.body.scrollHeight,n=t("html").height(),a=r();i.samples.push({scHeight:o,scrollY:a,height:n}),i.changeHeight(),i.isInReliableArea()?i.success():1==i.samples.length&&(i.checkTimeout=setTimeout(function(){if(r()<100&&i.isScorll||0==r()&&document.body.scrollHeight==t("html").height()){var o=r()||s-e.innerHeight,n=o||99999;r(n)}i.getSample()},500))},changeHeight:function(){var e=this;if(console.log(JSON.stringify(e.samples)),1==e.samples.length){var i=e.checkHeight(e.samples[0]),n=i.a,a=i.b,r=i.c,c=i.h;return r<-100?e.samples[0].type=1:n<10?a>0?(e.samples[0].type=2,t("html").css({top:0,width:"100%",height:c})):(e.samples[0].type=3,t("html").css({top:0,width:"100%",height:s})):(e.samples[0].type=4,t("html").css({top:0,width:"100%",height:s})),void(o[1]=e.samples[0].type)}if(e.samples.length>=2){var l=e.samples[0],d=e.samples[1];if(o[2]=3,l.scrollY==d.scrollY&&l.height==d.height&&l.scHeight==d.scHeight)return o[2]=0,void e.success();if(l.scrollY==d.scrollY)return l.height!=d.height?(3==l.type&&(o[2]=2,t("html").css({top:0,width:"100%",height:d.height})),void e.success()):void e.success();var i=e.checkHeight(d),a=i.b,c=i.h;a>0?(d.type=2,t("html").css({top:0,width:"100%",height:c})):t("html").css({top:0,width:"100%",height:s}),o[2]=1,e.samples=[e.samples.pop()]}},checkHeight:function(e){var t=Math.abs(e.scHeight-s),i=e.scrollY-2*s,o=e.height-s,n=e.scHeight-e.scrollY,a=Math.min(n,s/2);return a=parseInt(Math.max(a,s/2)),{a:t,b:i,c:o,h:a}},focusAfterInsert:function(){var e=s!=t("html").height()||0!=r();return e&&l.changeStatus(l.focusAfterInsert),e}},u=function(e){this.defaults={compantPk:"",codeKey:"",type:""},this.options=t.extend({},this.defaults,e)};u.prototype=d,u.prototype.height=s,u.prototype.scrollY=r,t.mobileInput=function(e){var t=new u(e);return t.init(),t}}(window,jQuery),function(e,t,i){"use strict";var o=function(e,i){this.$el=e,this.defaults={},this.options=t.extend({},this.defaults,i)};o.prototype={show:function(e){if(e&&"undefined"!=e&&"null"!=e){var t=this.$el;t.find(".systemInfo").remove(),t.append('<center class="systemInfromBox systemInfo"><span class="systemInfrom">'+e+"</span></center>"),document.getElementById("message").scrollTop=document.getElementById("message").scrollHeight}},hide:function(){var e=this.$el;e.find(".systemInfo").remove()}},t.fn.systemInfo=function(e){var i=new o(t(this),e);return i}}(window,jQuery),function(e,t,i){var o=function(e){this.defaults={},this.options=t.extend({},this.defaults,e)};o.prototype={init:function(){uccH5Init.initLang().done(function(){if("undefined"!=typeof custom&&custom)try{var e=JSON.parse(custom),i="./custom/"+(e.functionType||"")+"/pc.js";t.ajaxJs(i,!1).done(function(){t(".ucc").html(""),t("#h5Impl").tmpl(lang).appendTo(".ucc")}),langControl.addBtn()}catch(o){console.error(o)}uccH5Event.resetInterval(),uccH5Init.initBasic(),uccH5Init.initData().done(function(){uccH5Init.initFunc(),uccH5Logic.initFront(),uccH5Logic.initFace(),uccH5Event.binds(),uccH5Logic.viewFunc(),uccH5Init.initSatifaction(),uccH5Init.initLocalHistory(),uccH5Event.scrollToBottom(),t("img[defsrc]").each(function(e,i){t(this).attr("src",t(this).attr("defsrc"))}),t(".dialogue-footer-cover").hide()})})},initLang:function(){var e=new t.Deferred;return storage=t.storage({companyPk:ucc.companyPk}),langControl=t.langControl({langList:ucc.langs,storage:storage,addBtn:function(){t(".dialogue-footer").append("<div class='langSwitch'><span>"+("en"==langControl.c?"中":"EN")+"</span></div>"),langControl.insertStyle(".langSwitch{position: absolute; top: -60px;right: 11px;z-index: 99;border: 1px solid #5fbeee;padding: 0;border-radius: 50%;width: 46px;height: 46px;cursor: pointer;background: #5fbeee;}.langSwitch span{display: inline-block;font-size: 14px;text-align:center;line-height:46px;width:46px;color:#fff;s}")}}),langControl.loadLangJs(langControl.c).done(function(){if(lang=langControl.langs[langControl.c],t("#h5Impl").tmpl(lang).appendTo(".ucc"),langControl.addBtn(),t(".dialogue-footer-cover").show(),langControl.c){var i=langControl.langList[langControl.c].pk;if(ucc.defaultLangPk==i)return e.resolve();pageLoad.getLangAndMessageSettings(langControl.langList[langControl.c].pk).done(function(){e.resolve()})}}),e.promise()},initBasic:function(){params=t.getParameter(),Alert=t.Alert(),showBigImgFun=t.showBigImg(),showBigImgFun.init(),msgdb=t.msgdb(),datas=t.db({storage:storage}),localHistory=t.localHistory({storage:storage,loadMore:function(e){for(var i=0,o=e.length;i<o;i++)"date"!=e[i].type&&dialogue.showMsg({date:e[i].time,from:e[i].from,content:e[i].content,status:1});t("#getMore").length>0&&t("#getMore").remove(),t("#leaveHistory").prepend('<span id="getMore"><span class="c">'+lang.history.btnStr+'</span><span class="l"></span></span>'),localHistory.lastChat==-1&&t("#getMore").hide()}}),localHistory.init(),userDatas=t.userDatas({param:params,storage:storage,storageVisitor:"visitor",storageIpStr:"ipStr",storageChatNum:"chatNum",companyPk:ucc.companyPk,aDset:ucc.aDset,businessId:"",businessName:"",visitorPre:lang.userDatas.visitorPre}),visitLimit=t.visitLimit({open:params.vl?params.vl:1,storage:storage}),visitLimit.init(),bList=t.businessList({businessList:ucc.businessList,aDset:ucc.aDset}),workTime=t.workTime({BasicSetting:ucc.BasicSetting,ExtraSetting:ucc.ExtraSetting,workStr:lang.workTime.server+"【$1】<br>"+lang.workTime.clickNotice+"<a href='javascript:void(0)' class='dialogue-a fanke-liuyan'>"+lang.workTime.btn+"</a><br>"+lang.workTime.notice,holidayStr:lang.workTime.holiday+"【$1】<br>"+lang.workTime.clickNotice+"<a href='javascript:void(0)' class='dialogue-a fanke-liuyan'>"+lang.workTime.btn+"</a><br>"+lang.workTime.notice,lang:lang.workTime,show:function(e){if(e&&(t(".dialogue-footer-cover").show(),0==t(".pop_bg").length)){var i='<div class="dialogue-in"><div class="dialogue-pic"><img src="style/images/mobileImages/newImages/server.png"></div><div class="dialogue-c"><span class="dialogue-dot1"><img src="style/images/mobileImages/newImages/dialogue_dot1.png"></span><p class="pop_bg"><p class = "pop_msg">'+e+'</p></p></div></div><div class="clearboth"></div>';t("#message").html(i),t(".fanke-liuyan").on("click",function(e){leaveMessage.show()}),datas.set("iswork",!1),setTimeout(function(){t(".pop_msg").slideDown("slow")},300)}}}),sensitive=t.sensitive({vocabulary:ucc.vocabulary}),changeFaceFun=t.changeFace({after:function(){for(var e=this.imgIco,i="",o=0,n=e.length;o<n;o++){var a=e[o][0];i+="<span>"+a+"</span>"}t(".dialogue-footer-face .footer-face").html(i)}})},initData:function(){var e=new t.Deferred;return datas.set("iswork",!0),t(".close").hide(),datas.set("hasInQueue",!1),t.ajax({type:"POST",url:"./echatManager.do",data:{method:"initChatId",companyPk:ucc.companyPk,vid:userDatas.getVisitorInfo().visitorId,hjUserData:params.hjUserData,visitorInfo:params.visitorInfo},dataType:"json",async:!1,cache:!1}).done(function(e){ucc.chatID=e.chatID,ucc.browserId=(new Date).getTime(),storage.get("oldChatId")!=e.chatID?(storage.get("msgObjCurrentChat")&&t.ajax({type:"POST",url:"./echat.do",async:"false",data:{method:"closeEchat",chatID:storage.get("oldChatId"),url:storage.get("msgObjCurrentChat").url,opname:datas.get("opName")?datas.get("opName"):""},success:function(e){},dataType:"json"}),uccH5Logic.addmonitorJs(),localHistory.saveCurrent(),storage.set("oldChatId",e.chatID),datas.set("openSatisfactionAfterCloseChat",!1),datas.set("hasSatisfaction",!1),datas.set("_workGroupName",""),datas.set("remoteUrl",""),datas.set("opShow",""),datas.set("opName",""),datas.set("operatorId","")):"connnected"==e.state&&(storage.set("offChat",ucc.browserId),storage.set("browserId",ucc.browserId))}),webSocket=t.webSocket({path:"/any800/UccWebSocket/",isWs:ucc.isWs,visitorId:userDatas.getVisitorInfo().visitorId,message:function(e,t,i){e==ucc.chatID&&("object"==typeof t&&(t=JSON.stringify(t)),msgdb.get(i)||(dialogue.showMsg({msgid:i,date:(new Date).getTime(),content:t,from:"client"}),detectWeb.msgPush("customer",t),TimeoutList.startALLTimeout()))},deal:function(e,i,o){if(i==ucc.chatID)if("CUTOMER_IS_INVITED"==e)if(dialogue.islive()){if(dialogue.toolFun(!0),dialogue.showMsg({msgid:"",date:(new Date).getTime(),content:o,from:"client",saveIn:1}),detectWeb.getIsReconnection()){var n="["+detectWeb.getMsgs(5).join(",")+"]";dialogue.sendMessage(n,"offLineMessage")}TimeoutList.startALLTimeout()}else dialogue.setAttr("CUTOMER_IS_INVITED",o);else if("CLOSE"==e)detectWeb.getIsInitiate()?dialogue.end(6):dialogue.end(2);else if("CLOSE_CUSTOMER"==e)dialogue.end(3);else if("CLOSE_VISITOR"==e)dialogue.islive()&&(langTip.show(langTip.type.system,langTip.key.no_answer_close),dialogue.end(2));else if("OPERATION_TIPS"==e)"pushsatisfaction"==o.params.opType?satisfaction.hasSat&&satisfaction.show():"getinfo"==o.params.opType?visitorInformation.show():"uploadfile"==o.params.opType&&dialogue.showMsg({msgid:"",date:(new Date).getTime(),content:o.content,from:"client",status:0});else if("CUSTOMER_NETWORK_INTERRUPT"==e)dialogue.end(7);else if("CUTOMER_ISNOT_INVITED"==e)dialogue.showMsg({msgid:"",date:(new Date).getTime(),content:o,from:"client",status:0}),dialogue.end(0);else if("CUTOMER_REVOKE"==e){msgdb.set(o,"isRevoke",!0),changeWindow&&changeWindow.change(),localHistory.setCurrent(msgdb.db);var a=t("div[name="+o+"]");"none"!=a.css("display")&&(a.hide(),a.prev().hasClass("time")&&a.prev().hide(),a.after("<div class='msg_back_success'>"+dialogue.getAttr("operatorName")+lang.dialogue.revoke+"</div>"))}else"RECEIPT"==e&&(msgdb.set(o,"checkSend",1),t("div[name="+o+"] .msg_sending").hide(),t("div[name="+o+"] .msg_repeat").hide(),changeWindow&&changeWindow.change(),localHistory.setCurrent(msgdb.db))},connect:function(e){dialogue.islive()&&(e?(detectWeb.getIsInitiate()&&systemInfo.show(dialogue.options.msgList.reconnectSuc),detectWeb.getIsInitiate()&&(dialogue.toolFun(!0),detectWeb.checkedSuccess())):detectWeb.getIsInitiate()||(dialogue.toolFun(!1),systemInfo.show(dialogue.options.msgList.reconnectFail),detectWeb.checkedFail()))},confirmSend:function(e){setTimeout(function(){var i=msgdb.get(e);i&&0==i.checkSend&&t("div[name="+e+"] .msg_sending").show()},600),setTimeout(function(){var i=msgdb.get(e);i&&0==i.checkSend&&(t("div[name="+e+"] .msg_sending").hide(),t("div[name="+e+"] .msg_repeat").show(),msgdb.set(e,"checkSend",2),changeWindow&&changeWindow.change(),localHistory.setCurrent(msgdb.db))},3e3)},leaveCover:function(){dialogue.islive()&&uccH5Event.leaveCover()},open:function(){uccH5Event.openCover()}}),t("#message").delegate(".msg_repeat","click",function(){var e=t(this).parents(".contentMessage");if(e.attr("name")&&dialogue.islive()){e.attr("name");e.prev().hasClass("time")&&e.prev().hide(),e.hide();var i=uccH5Event.getMsgStr(e.find("span.content"));dialogue.sendMessage(i)}}),webSocket.init().done(function(){return e.resolve()}),confirmBox=t.confirm({cancel:lang.cancel,submit:lang.submit}),e.promise()},initFunc:function(){systemInfo=t("#message").systemInfo(),mobileInput=t.mobileInput({blurInput:function(e){}}),mobileInput.init(),detectWeb=t.detectWeb({period:30,after:function(){dialogue.end(6)}}),TimeoutList=t.TimeoutList({msgdb:msgdb,ops:ucc.OperatorBasicSettings,startFun:function(){dialogue.islive()&&(TimeoutList.isVisitorHalfTimeout()&&(langTip.show(langTip.type.system,langTip.key.no_answer_hint),changeWindow&&changeWindow.change()),TimeoutList.isVisitorTimeout()&&(langTip.show(langTip.type.system,langTip.key.no_answer_close),dialogue.end(2)),TimeoutList.isClientBusy()&&(langTip.show(langTip.type.system,langTip.key.cs_busy),changeWindow&&changeWindow.change()))}}),userDatas.options.chatID=ucc.chatID,userDatas.options.businessId="",userDatas.options.businessName="",queue=t.queueManager({companyPk:ucc.companyPk,chatID:ucc.chatID,langPk:ucc.defaultLangPk,message:JSON.stringify(userDatas.getJsonStr()),IpStr:JSON.stringify(userDatas.getIpStr()),netError:lang.queue.netError,success:function(e){msgdb.clear(),changeWindow.clear(),datas.set("remoteUrl",e.url),datas.set("opShow",e.opShow),datas.set("opName",e.workgroupName),datas.set("_workGroupName",e.workgroupName);var t=e.workgroupName.split("-");dialogue.setAttr("operatorName",e.opShow?e.opShow:t[1]),dialogue.setAttr("_workGroupName",e.workgroupName),dialogue.setAttr("remoteUrl",e.url),changeWindow.setMsgObj(e),datas.set("hasInQueue",!1),systemInfo.hide(),langTip.show("1","7"),langTip.show("1","9");var i=dialogue.getAttr("CUTOMER_IS_INVITED");if(i){if(dialogue.toolFun(!0),dialogue.showMsg({msgid:"",date:(new Date).getTime(),content:i,from:"client",saveIn:1}),detectWeb.getIsReconnection()){var o="["+detectWeb.getMsgs(5).join(",")+"]";dialogue.sendMessage(o,"offLineMessage")}TimeoutList.startALLTimeout()}return dialogue.setAttr("CUTOMER_IS_INVITED",""),1==e.success?(storage.set("chatNum",(storage.get("chatNum")?storage.get("chatNum"):0)+1),dialogue.start(),JSON.stringify(userDatas.getJsonStr())&&1==ucc.BasicSetting.need&&dialogue.sendMessage(JSON.stringify(userDatas.getJsonStr()),"getinfoSubmit"),!0):(langTip.show(data.langType,data.langKey),!1)},fail:function(e){systemInfo.show(decodeURIComponent(decodeURIComponent(e.msg))),t(".systemInfromBox #liveMessageId").click(function(){leaveMessage.show()}),t(".systemInfromBox #continueId").click(function(){t.ajax({type:"POST",url:"./queue.do",dataType:"json",data:{method:"continueBusinessQueue",chatID:ucc.chatID,companyPk:ucc.companyPk,langPk:ucc.defaultLangPk,businessId:userDatas.getJsonStr().businessId}}).done(function(e){0==e.success?(systemInfo.show(e.msg),t("#liveMessageId").click(function(){leaveMessage.show()})):(queue.index=-1,queue.isTimeOut=!1,queue.getInfo(userDatas.getJsonStr().businessId,1,!1))}).fail(function(e){dialogue.showSysMsg(lang.errorNetWork)});var e=t(this);e.unbind("click")})},leave:function(e){systemInfo.show(e.msg),t("#liveMessageId").click(function(){leaveMessage.show()})},continueque:function(e){systemInfo.show(e.msg)},always:function(e){systemInfo.show(e.msg)}}),queue.reqStartQueue=function(e,i){datas.get("hasInQueue")||(datas.set("hasInQueue",!0),pageLoad.getDepartment().done(function(){if(bList=t.businessList({businessList:ucc.businessList,aDset:ucc.aDset}),bList.getItemOnline(e)){userDatas.options.businessId=e,userDatas.options.businessName=i,userDatas.options.storageOldService=storage.get("oldService");var o=userDatas.getJsonStr();o.isWs=webSocket.isWork,queue.options.message=JSON.stringify(o),queue.options.IpStr=JSON.stringify(userDatas.getIpStr()),queue.start(e,i),storage.set("businessId",e),storage.set("businessName",i)}else{if(datas.set("hasInQueue",!1),0==t(".onlineCls[data-num]").length){var n=uccH5Logic.showBusinessList(bList.getParentPk(e));dialogue.showMsg({from:"client",content:n,saveIn:1})}t(".onlineCls[data-pk='"+e+"']").last().click(),leaveMessage.show()}}))},webSocket.connect(),dialogue=t.dialogue({webSocket:webSocket,TimeoutList:TimeoutList,timeStr:'<div class="time">$1</div>',callbackStr:'<div class="msg_repeat" ><img style="vertical-align: bottom;margin-right:5px;" src="style/images/repeat.png"></div>',msgEle:"#message",visitorId:userDatas.getVisitorInfo().visitorId,historyEle:"#leaveHistory",textEle:".dialogue-footer-text",storage:storage,browserId:ucc.browserId,changeFaceFun:changeFaceFun,limitReceiveTime:60,chatId:ucc.chatID,detectWeb:detectWeb,userDatas:userDatas,lang:lang.dialogue,msgList:{reconnectSuc:lang.dialogue.reconnectSuc,reconnectFail:lang.dialogue.reconnectFail},closeStrList:lang.dialogue.closeChat,showSysMsgFun:function(e){var i='<center class="systemInfromBox"><span class="systemInfrom">'+e+"</span></center>";t("#message").append(i),uccH5Event.scrollToBottom(),msgdb.add({type:"system",content:e}),changeWindow&&changeWindow.change()},getReceivedFun:function(e){},msgReplace:function(e){var t='<div class="$1 contentMessage" name="$msgid"><div class="dialogue-pic"><img src="$2"></div>';"visitor"!=e&&(t+='<div class="dialogue-name">$name</div>'),t+='<div class="dialogue-c"><span class="$4"><img src="$3"></span><span class="content">$content</span>$msgResend</div></div><div class="clearboth"></div>';var i={client:{$1:"dialogue-in",$2:"./style/images/mobileImages/newImages/server.png",$3:"./style/images/mobileImages/newImages/dialogue_dot1.png",$4:"dialogue-dot1"},visitor:{$1:"dialogue-me",$2:"./style/images/mobileImages/newImages/victors.png",$3:"./style/images/mobileImages/newImages/dialogue_dot2.png",$4:"dialogue-dot2"},robot:{$1:"dialogue-in",$2:"./style/images/mobileImages/newImages/server.png",$3:"./style/images/mobileImages/newImages/dialogue_dot1.png",$4:"dialogue-dot1"}},o=i[e];return t.replace(/\$1/g,o.$1).replace(/\$2/g,o.$2).replace(/\$3/g,o.$3).replace(/\$4/g,o.$4)},startChat:function(){uccH5Init.initSatifaction(),t(".satisfied").show(),webSocket.startTimeout(),storage.set("browserId",ucc.browserId),t(".close").show(),t(".langSwitch").hide()},endChat:function(){datas.set("hasInQueue",!1),localHistory.saveCurrent(),t(".langSwitch").show(),t.ajax({type:"POST",url:"./echat.do",data:{method:"closeEchat",chatID:ucc.chatID,url:dialogue.getAttr("remoteUrl"),opname:dialogue.getAttr("operatorName")},success:function(e){},dataType:"json",async:!1});if(t(".dialogue-footer-cover").show(),1==ucc.BasicSetting.jump&&satisfaction.hasSat&&datas.get("openSatisfactionAfterCloseChat")&&!datas.get("hasSatisfaction")){var e=(new Date).getTime();dialogue.showMsg({from:"client",content:lang.satisfaction.msg+"<span class = 'spans v_info satisfaction' id = 'satisfaction"+e+"'>"+lang.satisfaction.btn+"</span><br>",saveIn:1})}t(".onlineCls[data-num]").removeClass("onlineCls"),uccH5Logic.blistNum=1,t.ajax({url:"./echatManager.do",data:{method:"initChatId",companyPk:ucc.companyPk,vid:userDatas.getVisitorInfo().visitorId,hjUserData:params.hjUserData},dataType:"json",async:!1,cache:!1}).done(function(e){try{ucc.chatID=e.chatID,storage.set("oldChatId",e.chatID),ucc.browserId=(new Date).getTime(),storage.set("oldChatId",e.chatID),datas.set("openSatisfactionAfterCloseChat",!1),datas.set("hasSatisfaction",!1);userDatas.getJsonStr();uccH5Init.initFunc(),uccH5Logic.addmonitorJs()}catch(e){}})},endChatFun:function(){webSocket.endTimeout(),changeWindow.stopCheck()},msgFun:function(e){"visitor"!=e.from&&"client"!=e.from||TimeoutList.reset(),msgdb.add({date:e.date,msgId:e.msgid,type:e.from,content:e.content,saveIn:e.saveIn?e.saveIn:0,hasChecked:e.hasChecked}),uccH5Event.showAudio(),1==e.status?uccH5Event.scrollToTop():uccH5Event.scrollToBottom(),changeWindow&&changeWindow.change(),dialogue.islive()&&localHistory.setCurrent(msgdb.db)},sendMessageFun:function(e,t){TimeoutList.startALLTimeout(),datas.set("openSatisfactionAfterCloseChat",!0)},closeTool:function(){t(".close").hide(),t("#dialogue-footer-text").blur(),t(".dialogue-footer-text").html(""),t("#dialogue-send").attr("disabled","disabled"),t(".onlineCls").attr("disabled","disabled"),uccH5Event.checkHeight(4),t("#dialogue-biaoqing").attr("disabled","disabled"),t(".dialogue-footer-face").hide(),t(".fileup input").attr("disabled",!0)},openTool:function(){t(".close").show(),t("#dialogue-send").removeAttr("disabled"),t(".onlineCls").removeAttr("disabled"),t("#dialogue-biaoqing").removeAttr("disabled"),t(".dialogue-footer-text").attr("contenteditable","true"),t(".fileup input").attr("disabled",!1)},confirmSend:function(e,i){"add"==i&&e?t(".contentMessage[name='']:last").attr("name",e):e&&t(".contentMessage[name="+e+"] ._msg").hide()},specialFun:function(e,i){switch(e){case"200":TimeoutList.startALLTimeout();break;case"700":if("pushsatisfaction"==i.code){if(satisfaction.hasSat){var o=(new Date).getTime();dialogue.showMsg({from:"client",content:lang.satisfaction.msg+"<span class = 'spans v_info satisfaction' id = 'satisfaction"+o+"'>"+lang.satisfaction.btn+"</span><br>",saveIn:1})}}else"getinfo"==i.code?visitorInformation.show():"uploadfile"==i.code&&dialogue.showMsg({from:"client",content:JSON.parse(i.text).content});break;case"900":break;case"901":break;case"110":break;case"111":TimeoutList.startALLTimeout();break;case"112":break;case"113":var n=JSON.parse(i);msgdb.set(n.messageId,"isRevoke",!0),changeWindow&&changeWindow.change(),localHistory.setCurrent(msgdb.db);var a=t("div[name="+n.messageId+"]");"none"!=a.css("display")&&(a.hide(),a.prev().hasClass("dialogue-date")&&a.prev().hide(),a.after("<div class='msg_back_success'>"+dialogue.getAttr("operatorName")+lang.dialogue.revoke+"</div>"));break;case"114":var n=JSON.parse(i);break;case"902":langTip.show(langTip.type.system,langTip.key.no_answer_close)}}}),robot=t.robot({visitorId:storage.get("visitor").visitorId,visitorName:storage.get("visitor").visitorName,dialogue:dialogue,robotSetting:ucc.BasicSetting.robotSetting,companyPk:ucc.companyPk,chatId:ucc.chatID,ecselfList:ucc.ecselfList,langPk:ucc.defaultLangPk,lang:lang.robot,changeToNormal:function(e){t.ajax({type:"POST",url:"./echatManager.do",data:{method:"keepTenQA",chatId:ucc.chatID},dataType:"json"}).done(function(e){}),robot.isUse=!1,workTime.iswork(),0==workTime.type?uccH5Logic.loadScheme():workTime.show(),dialogue.toolFun(!1)}}),t("body").delegate(".robotResp","click",function(){robot.isUse&&!dialogue.islive()&&robot.options.changeToNormal()}),t("body").delegate(".robotSuggsetion","click",function(){robot.isUse&&!dialogue.islive()&&robot.check(t(this).text())}),robot.check(),robot.isUse,langTip=t.langTip({companyPk:ucc.companyPk,langMap:ucc.langMap,defaultLangPk:ucc.defaultLangPk,show:function(e){var t=new RegExp("&quot;","g");switch(e.langKey){case 1:var i=uccH5Logic.showBusinessList(-1);i&&datas.get("iswork")&&dialogue.showMsg({from:"robot",content:e.content.replace(t,'"')+lang.businessList.list+i,saveIn:1});break;case 2:dialogue.showMsg({from:"robot",content:e.content.replace(t,'"'),saveIn:1});break;case 3:dialogue.showMsg({from:"robot",content:e.content.replace(t,'"'),saveIn:1});break;case 4:dialogue.showMsg({from:"robot",content:e.content.replace(t,'"'),saveIn:1});break;case 5:dialogue.showMsg({from:"robot",content:e.content.replace(t,'"'),saveIn:1});break;case 6:dialogue.showMsg({from:"robot",content:e.content.replace(t,'"'),saveIn:1});break;case 7:dialogue.showMsg({from:"robot",content:e.content.replace(t,'"'),saveIn:1});break;case 9:dialogue.showMsg({from:"robot",content:e.content.replace(t,'"'),saveIn:1});break;default:dialogue.showMsg({from:"robot",content:e.content?e.content.replace(t,'"'):e.conntent.replace(t,'"'),saveIn:1})}}}),leaveMessage=t.leaveMessage({Alert:Alert,warn:".warning",messageDisplay:ucc.messageDisplay,messageContent:ucc.messageContent,messageTypeList:ucc.messageTypeList,companyPk:ucc.companyPk,title:lang.leaveMessage.boxTitle,bottom:"<div class='bottom'><div class='cancel'>"+lang.cancel+"</div><div class='submit'>"+lang.submit+"</div></div>",lang:lang.leaveMessage,generate:function(e){t(".leaveMessageView .title .cross img,.leaveMessageView .bottom .cancel").on("click",function(){leaveMessage.cancel()}),t(".leaveMessageView .col").each(function(i,o){var n=t(this);if("textarea"==n.data("type"))return void n.append('<textarea  placeholder="'+n.data("markedwords")+'" ></textarea>');if(n.append('<div class="colBack"><span class="name">'+n.data("name")+'</span><span class="input"></span><span class="warning"></span></div>'),"combox"==n.data("type")){n.find(".input").append('<span class="names">'+lang.leaveMessage.choose+'</span><span class="option"><img class="link" src="style/images/mobileImages/newImages/link.png"></span><div class="radiocover">'+lang.leaveMessage.type+"</div>");for(var a in e)if(e[a]&&e[a].pk){var s=e[a].name;"en"==langControl.c&&e[a].nameEN&&(s=e[a].nameEN),n.find(".radiocover").append('<div class="sel" data-key="'+e[a].pk+'"><span class="name">'+s+'</span><span class="option"><img class="ok" src="style/images/mobileImages/newImages/ok.png"></span></div>')}var r=n.find(".radiocover .sel").first();r.addClass("selected"),n.find(".input>.names").html(r.text()),n.find(".input>.names").data("key",r.data("key"))}else n.find(".input").append('<input type="text" placeholder="'+n.data("markedwords")+'" >')}),t(".leaveMessageView [data-type='combox'] .colBack>.input>.names,.leaveMessageView [data-type='combox'] .colBack>.input>.option").on("click",function(e){t(".leaveMessageView .radiocover").show()}),t(".leaveMessageView .radiocover .sel").on("click",function(e){var i=t(this);t(".leaveMessageView .radiocover .sel").removeClass("selected"),i.addClass("selected"),t(".leaveMessageView [data-type='combox'] .input>.names").html(i.text()),t(".leaveMessageView [data-type='combox'] .input>.names").data("key",i.data("key")),t(".radiocover").hide()}),t(".leaveMessageView .bottom .submit").on("click",function(){leaveMessage.submit({messageTypePk:t(".leaveMessageView [data-type='combox'] .input>.names").data("key"),name:t(".leaveMessageView .board [data-displayname='name']").length>0?t(".leaveMessageView .board [data-displayname='name'] input").val():"",telephone:t(".leaveMessageView .board [data-displayname='telephone']").length>0?t(".leaveMessageView .board [data-displayname='telephone'] input").val():"",email:t(".leaveMessageView .board [data-displayname='email']").length>0?t(".leaveMessageView .board [data-displayname='email'] input").val():"",title:t(".leaveMessageView .board [data-displayname='title']").length>0?t(".leaveMessageView .board [data-displayname='title'] input").val():"",content:t(".leaveMessageView .board [data-displayname='content']").length>0?t(".leaveMessageView .board [data-displayname='content'] textarea").val():"",company:t(".leaveMessageView .board [data-displayname='company']").length>0?t(".leaveMessageView .board [data-displayname='company'] input").val():"",brand:t(".leaveMessageView .board [data-displayname='brand']").length>0?t(".leaveMessageView .board [data-displayname='brand'] input").val():""})})},reset:function(e){t(".leaveMessageView .board [data-displayname='messageTypePk'] select").val(),t(".leaveMessageView .board [data-displayname='name'] input").val(""),t(".leaveMessageView .board [data-displayname='telephone'] input").val(""),t(".leaveMessageView .board [data-displayname='email'] input").val(""),t(".leaveMessageView .board [data-displayname='title'] input").val(""),t(".leaveMessageView .board [data-displayname='content'] textarea").val(""),t(".leaveMessageView .board [data-displayname='company'] input").val(""),t(".leaveMessageView .board [data-displayname='brand'] input").val("")},warn:function(e,t){Alert.show(t)}}),visitorInformation=t.visitorInformation({storage:storage,Alert:Alert,storageVisitor:"visitor",title:lang.visitorInformation.title,bottom:"<div class='bottom'><div class='cancel'>"+lang.cancel+"</div><div class='submit'>"+lang.submit+"</div></div>",lang:lang.visitorInformation,generate:function(e){t(".visitorInformationView .body .col").each(function(e,i){var o=t(this);if(o.append('<div class="colBack"><span class="name">'+o.data("name")+'</span><span class="input"></span><span class="warning"></span></div>'),
"radio"==o.data("type")){o.find(".input").append('<span class="name"></span><span class="option"><img class="link" src="style/images/mobileImages/newImages/link.png"></span><div class="radiocover">'+lang.visitorInformation.choose+'<div class="sel" data-key="1"><span class="name">'+lang.visitorInformation.male+'</span><span class="option"><img class="ok" src="style/images/mobileImages/newImages/ok.png"></span></div><div class="sel" data-key="2"><span class="name">'+lang.visitorInformation.female+'</span><span class="option"><img class="ok" src="style/images/mobileImages/newImages/ok.png"></span></div><div class="sel" data-key="0"><span class="name">'+lang.visitorInformation.unknow+'</span><span class="option"><img class="ok" src="style/images/mobileImages/newImages/ok.png"></span></div></div>');var n=o.data("markedwords")?o.data("markedwords"):"2",a=o.find(".input .radiocover .sel[data-key='"+n+"']");a.addClass("selected"),o.find(".input>.name").html(a.text()),o.find(".input>.name").data("key",a.data("key"))}else o.find(".input").append('<input type="text" placeholder="'+(o.data("placeholder")?o.data("placeholder"):"")+'" value="'+(o.data("markedwords")?o.data("markedwords"):"")+'" >')}),t(".visitorInformationView [data-type='radio'] .colBack>.input>.name,.visitorInformationView [data-type='radio'] .colBack>.input>.option").on("click",function(e){t(".visitorInformationView .radiocover").show()}),t(".visitorInformationView .radiocover .sel").on("click",function(e){var i=t(this);t(".visitorInformationView .radiocover .sel").removeClass("selected"),i.addClass("selected"),t(".visitorInformationView [data-type='radio'] .input>.name").html(i.text()),t(".visitorInformationView [data-type='radio'] .input>.name").data("key",i.data("key")),t(".radiocover").hide()}),t(".visitorInformationView .title .cross img,.visitorInformationView .bottom .cancel").on("click",function(){visitorInformation.cancel()}),t(".visitorInformationView .board .input").focus(function(e){visitorInformation.check()}),t(".visitorInformationView .bottom .submit").on("click",function(e){visitorInformation.submit({visitorName:t(".visitorInformationView .board [data-displayname='visitorName'] input").val(),sex:t(".visitorInformationView [data-type='radio'] .input>.name").data("key"),realName:t(".visitorInformationView .board [data-displayname='realName'] input").val(),mobile:t(".visitorInformationView .board [data-displayname='phone'] input").val(),email:t(".visitorInformationView .board [data-displayname='email'] input").val(),QQ:t(".visitorInformationView .board [data-displayname='QQ'] input").val(),address:t(".visitorInformationView .board [data-displayname='address'] input").val(),company:t(".visitorInformationView .board [data-displayname='company'] input").val()})})},warn:function(e,t){Alert.show(t)},submitFun:function(){dialogue.sendMessage(JSON.stringify(userDatas.getJsonStr()),"getinfoSubmit"),dialogue.showSysMsg(lang.visitorInformation.submit)},cancelFun:function(){dialogue.islive()&&dialogue.sendMessage(lang.visitorInformation.cancel,"cancelVisitorInformation")}}),changeWindow&&clearInterval(changeWindow.browserInterval),changeWindow=t.changeWindow({msgdb:msgdb,open:!0,storage:storage,chatId:ucc.chatID,browserId:ucc.browserId,dialogue:dialogue,TimeoutList:TimeoutList,data:datas,start:function(){t(".satisfied").show(),t("#message").html(""),t(".leaveMessage").remove(),t("#fangkexinxi").hide(),ucc.BasicSetting.need=0},end:function(){t(".satisfied").hide(),t(".reminder").hide(),uccH5Event.leaveCover()}}),changeWindow.init()},initSatifaction:function(){satisfaction=t.satisfaction({dialogue:dialogue,companyPk:ucc.companyPk,langPk:ucc.defaultLangPk,chatId:ucc.chatID,title:lang.satisfaction.title,bottom:"<div class='bottom'><div class='cancel'>"+lang.cancel+"</div><div class='submit'>"+lang.submit+"</div></div>",lang:lang.satisfaction,generate:function(){t("#message").delegate(".satisfaction","click",function(){satisfaction.hasSat&&satisfaction.show()}),satisfaction.hasSat&&(t(".dialogue-footer").append("<div class='satisfied'><img src='./style/images/echat/satisfied.png'></div>"),t(".satisfied").css({position:"absolute",top:-60,right:11,"z-index":99}).on("click",function(){satisfaction.show()})),t(".satisfied img").css("width","46px"),t(".satisfied").hide(),t("#satisfactionid").hide(),t(".satisfactionView .fr").each(function(e,i){var o=t(this),n="";n=satisfaction.getElementByParent(o.data("pk")).length<=0?'<img class="ok" src="style/images/mobileImages/newImages/ok.png">':'<img class="link" src="style/images/mobileImages/newImages/link.png">',o.append('<div class="sel"><span class="name">'+o.data("name")+'</span><span  class="option">'+n+"</span></div>")}),t(".satisfactionView .sr").each(function(e,i){var o=t(this);o.append('<div class="sel"><span class="name">'+o.data("name")+'</span><span  class="option"><img class="ok" src="style/images/mobileImages/newImages/ok.png"></span></div>')}),t(".satisfactionView .sr").hide(),t(".satisfactionView .fr").click(function(){var e=t(this);t(".satisfactionView .fr").removeClass("selected"),e.addClass("selected"),e.find(".link").length>0&&(t(".satisfactionView .fr ").hide(),t(".satisfactionView .sr ").hide(),t('.satisfactionView .sr[data-parent ="'+e.data("pk")+'"]').show())}),t(".satisfactionView .sr").click(function(){var e=t(this);e.toggleClass("selected")}),t(".satisfactionView .bottom .cancel").on("click",function(){"none"==t(".satisfactionView .fr").css("display")?(t(".satisfactionView .fr").show(),t(".satisfactionView .sr").hide().removeClass("selected")):satisfaction.cancel()}),t(".satisfactionView .title .cross img").on("click",function(){satisfaction.cancel(),t(".satisfactionView .fr").show(),t(".satisfactionView .sr").hide().removeClass("selected")}),t(".satisfactionView .bottom .submit").on("click",function(){if(0==t(".satisfactionView .fr.selected").length)return void Alert.show(lang.satisfaction.chooseSatisfaction);var e=t(".satisfactionView .fr.selected").data("pk"),i=t(".satisfactionView .fr.selected").data("parent"),o="";if(satisfaction.getElementByParent(e).length>0){if(0==t(".satisfactionView .sr.selected").length)return void Alert.show(lang.satisfaction.chooseReason);t(".satisfactionView .sr.selected").each(function(){var e=t(this);o+=e.data("pk")+","})}datas.set("hasSatisfaction",!0),satisfaction.submit({satisfactionPk:i,optionPk:e,satisfactionMemo:t(".satisfactionView .mome textarea").val()?t(".satisfactionView .mome textarea").val():"",nextSatisfactionPk:o})})}}),satisfaction.init()},initHistory:function(){History=t.history({visitorId:userDatas.getVisitorInfo().visitorId,companyPk:ucc.companyPk,dialogue:dialogue,leavePre:lang.history.leavePre,generation:function(){dialogue.islive()||(History.getLeaveChat(),History.showLeaveChat(),History.check(),t("#leaveHistory").delegate("#getMore .c","click",function(e){History.check()}))},checkFun:function(e){t("#leaveHistory #getMore").remove(),t("#leaveHistory").prepend('<span id="getMore"><span class="c">'+lang.history.btnStr+'</span><span class="l"></span></span>'),t("#leaveHistory #getMore").toggle(History.more)}}),History.init()},initLocalHistory:function(){History=t.history({show:!1,visitorId:userDatas.getVisitorInfo().visitorId,companyPk:ucc.companyPk,dialogue:dialogue,generation:function(){dialogue.islive()||(History.getLeaveChat(),History.showLeaveChat(),localHistory.history.length>0&&(localHistory.loadMore(),t("body").delegate("#getMore","click",function(){localHistory.loadMore()})))},checkFun:function(){}}),History.init()}},t.uccH5Init=function(e){var t=new o(e);return t}}(window,jQuery),function(e,t,i){var o=function(e){this.defaults={},this.options=t.extend({},this.defaults,e)};o.prototype={blistNum:1,initFront:function(){dialogue.islive()||(robot.isUse?langTip.show("2","1"):(workTime.iswork(),0==workTime.type?uccH5Logic.loadScheme():workTime.show()))},showBusinessList:function(e){var i=this;if(!dialogue.islive()){var o="";if(datas.get("iswork")){var n=bList.generate(e);if(n)if(n.access){if(n.online)return bList.setSelect(n.pk,n.name),storage.set("businessId",n.pk),storage.set("businessName",n.name),void queue.reqStartQueue(n.pk,n.name);if(!n.name)return langTip.show("1","1"),langTip.show("1","2"),void t("#fangke-liuyan").click(function(){leaveMessage.show()});var a=lang.businessList.offline;o+='<span><a class="onlineCls" data-online="'+a+'" data-num="'+i.blistNum+'" name="'+n.name+'" data-pk="'+n.pk+'">'+i.blistNum+"."+n.name+"【"+a+"】</a></span><br>"}else for(var s=n.list,r=0;r<s.length;r++){var c=s[r],a="online"==c.type?lang.businessList.online:lang.businessList.offline;o+='<span><a class="onlineCls" data-online="'+a+'" data-num="'+i.blistNum+'" name="'+c.item.name+'" data-pk="'+c.item.pk+'">'+i.blistNum+"."+c.item.name+"【"+a+"】</a></span><br>",i.blistNum++}return o}}},loadScheme:function(){uccH5Event.showVisitorInfo(),"1"==ucc.BasicSetting.need?(t(".show-visitor-info").parents(".contentMessage").prev(".time").show(),t(".show-visitor-info").parents(".contentMessage").show()):(t(".show-visitor-info").parents(".contentMessage").prev(".time").hide(),t(".show-visitor-info").parents(".contentMessage").hide()),pageLoad.getDepartment().done(function(){bList=t.businessList({businessList:ucc.businessList,aDset:ucc.aDset}),langTip.show(1,1)})},viewFunc:function(){t(".leaveMessageView").length>0&&(document.querySelector(".leaveMessageView").addEventListener("touchmove",function(e){e._isScroller=!0}),t(".leaveMessageView textarea").on("focus",function(){document.querySelector(".leaveMessageView .body").scrollTop=document.querySelector(".leaveMessageView .body").scrollHeight})),t(".satisfactionView").length>0&&(document.querySelector(".satisfactionView").addEventListener("touchmove",function(e){e._isScroller=!0}),t(".satisfactionView textarea").on("focus",function(){document.querySelector(".satisfactionView .body").scrollTop=document.querySelector(".satisfactionView .body").scrollHeight})),t(".visitorInformationView").length>0&&(document.querySelector(".visitorInformationView").addEventListener("touchmove",function(e){e._isScroller=!0}),t(".visitorInformationView textarea").on("focus",function(){document.querySelector(".visitorInformationView .body").scrollTop=document.querySelector(".visitorInformationView .body").scrollHeight}))},initFace:function(){t(".footer-face span img").click(function(){t("#dialogue-footer-text").append(t.clone(this)),t("#dialogue-send").show(),t("#dialogue-add").hide(),uccH5Event.checkHeight(4)})},addmonitorJs:function(){setTimeout(function(){dialogue.islive()||(monitor=t.monitor({storage:storage,companyPk:ucc.companyPk,userDatas:userDatas}))},3e3)}},t.uccH5Logic=function(e){var t=new o(e);return t}}(window,jQuery),function(e,t,i){var o=function(e){this.defaults={},this.options=t.extend({},this.defaults,e)};o.prototype={DOMCheck:null,binds:function(){this.businessListBind(),this.inputCheck(),this.viewFix(),this.bigImgBind(),this.inputClickBind(),this.faceBind(),this.closeBind(),this.uploadInit(),this.initReconnect(),this.unload(),this.enterBind(),this.messageChange(),dialogue.islive()||t(".fileup input").attr("disabled",!0)},enterBind:function(){t(document).keydown(function(i){var i=arguments[0]||e.event||i;13==i.keyCode&&(setTimeout(function(){t("#dialogue-send").click()},0),i.preventDefault?i.preventDefault():i.returnValue=!1)})},leaveCover:function(){if(!(t(".leaveMessage").length>0)){var e=webSocket.isWork?lang.websocketInterrupt:lang.boshInterrupt;t(".dialogue-footer-search").append("<div class='leaveMessage'>"+e+"</div><div class='leaveMessageCover'></div>"),t(".leaveMessage").css({position:"absolute",bottom:"50px",left:"13px"}),setInterval(function(){t(".leaveMessage").fadeIn(500).fadeOut(500)},1e3),t(".dialogue-footer-search .leaveMessage").unbind().click(function(){webSocket.isWork&&webSocket.connect()})}},openCover:function(){t(".leaveMessage").remove()},showVisitorInfo:function(){dialogue.showMsg({from:"client",content:"<div class='show-visitor-info'> "+lang.satisfaction.msg+"<span class = 'spans visitor_info' id = 'v_info'>"+lang.satisfaction.complete+"</span><br></div>",saveIn:1}),t(".visitor_info").click(function(){visitorInformation.show()})},showAudio:function(){t("audio").each(function(e,i){if(!t(i).parent().hasClass("audiojs")){var o=t(this);audiojs.helpers.whenError=function(){var e=t(".dialogue-c").find("a[placeholder]");e.html(lang.downloadAudio)},audiojs.create(o)}})},scrollToBottom:function(){document.getElementById("message").scrollTop=document.getElementById("message").scrollHeight},scrollToTop:function(){document.getElementById("message").scrollTop=0},businessListBind:function(){t("#message").delegate(".onlineCls","click",function(){if(!dialogue.islive()){t(this).data("num");storage.set("businessId",t(this).data("pk")),storage.set("businessName",t(this).attr("name"));var e=t(this).data("pk"),i=t(this).attr("name");if(bList.hasList(e).length>0){var o=uccH5Logic.showBusinessList(e);return void dialogue.showMsg({from:"client",content:o,saveIn:1})}var n=t(this).data("online")!=lang.businessList.online;n?(leaveMessage.show(),setTimeout(function(){document.activeElement.id&&"dialogue-footer-text"==document.activeElement.id&&(t("#dialogue-footer-text").blur(),t(".leaveMessageView input:visible").first().focus().blur())},500)):queue.reqStartQueue(e,i)}})},viewFix:function(){var e=function(e){e.addEventListener("touchstart",function(){var t=e.scrollTop,i=e.scrollHeight,o=t+e.offsetHeight;t<=0?e.scrollTop=1:o>=i&&(e.scrollTop=t-1)}),e.addEventListener("touchmove",function(t){e.offsetHeight<e.scrollHeight&&(t._isScroller=!0)})};e(document.querySelector(".dialogue")),document.querySelector(".dialogue-footer-text").addEventListener("touchmove",function(e){e._isScroller=!0}),document.body.addEventListener("touchmove",function(e){e._isScroller||(console.log("warn",e._isScroller),e.preventDefault())})},inputCheck:function(){var i=this;t(".dialogue-footer-text").css("overflowY","auto"),t("#dialogue-footer-text").on("focus",function(){t(".dialogue-footer-face").hide(),t(".dialogue-footer").css({position:"absolute"}),mobileInput.startCheck(),console.warn("focus"),i.DOMCheck&&(i.DOMCheck=e.clearInterval(i.DOMCheck)),i.DOMCheck=setInterval(function(){t("#dialogue-footer-text").html().length>0&&"<br>"!=t("#dialogue-footer-text").html()?(t("#dialogue-send").show(),t("#dialogue-add").hide(),t("#dialogue-footer-face").hide(),t(".dialogue").removeClass("dialogue-short"),t(".dialogue-footer-select").hide()):(t("#dialogue-send").hide(),t("#dialogue-add").show(),t("#dialogue-footer-text").empty()),setTimeout(function(){i.checkHeight(4)},300)},700)}).on("blur",function(){console.warn("blur"),t(".dialogue-footer").css({position:"absolute"}),i.DOMCheck=e.clearInterval(i.DOMCheck),setTimeout(function(){i.checkHeight(4)},333),mobileInput.end(),t("body").click()})},checkHeight:function(e){var i=24;t(".dialogue-footer-text").css("line-height",i+"px");for(var o=parseInt(t(".dialogue-footer-text").css("marginBottom"))+parseInt(t(".dialogue-footer-text").css("marginTop")),n=1;n<=e;n++)t(".dialogue-footer-text")[0].scrollHeight>=n*i&&(t(".dialogue-footer-search").height(n*i+o),t(".talk-btn").css("top",(n*i+o-t("#dialogue-send").height())/2));t(".dialogue-footer-text")[0].scrollHeight<2*i&&(t(".dialogue-footer-search").height(34+o),t(".dialogue-footer-text").css("line-height","34px"),t(".talk-btn").css("top",0)),t("#message").css("bottom",t(".dialogue-footer").height())},bigImgBind:function(){t("#message").delegate(".dialogue-me .dialogue-c .content img,.dialogue-in .dialogue-c .content img","click",function(){"true"!=t(this).attr("emotions")&&uccH5Event.downloadOrigin(t(this).attr("src")).done(function(e){showBigImgFun.showPic(e)})})},getMsgStr:function(e){var t=e.html();return t=t.replace(/\r|<br>|<div\s*>|<\/div>|<span\s*>|<\/span>|<p\s*>|<\/p>/g,""),t=t.replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,""),t=changeFaceFun.imgToIco(t)},inputClickBind:function(){var e=this;t("#dialogue-send").unbind().click(function(){var i=e.getMsgStr(t("#dialogue-footer-text"));if(i){if(i=sensitive.get(i),i.length>1e3)return Alert.show(lang.dialogue.maxLength),"";if(detectWeb.msgPush("visitor",i),i=i.replace(/ /gi,"&nbsp;").replace(/\n/gi,"<br>"),dialogue.islive())dialogue.sendMessage(i);else if(robot.isUse)robot.check(i.replace(/\&nbsp;/g,"").replace(/\s+/g,"").replace(/\<p><\/p>/g,"").replace(/\<br>/g,""));else if(datas.get("hasInQueue"))dialogue.showMsg({from:"visitor",content:i,saveIn:1});else{var o=Number(t("<div>"+i+"</div>").text());if(0==t(".onlineCls[data-num]").length&&pageLoad.getDepartment().done(function(){bList=t.businessList({businessList:ucc.businessList,aDset:ucc.aDset});var e=uccH5Logic.showBusinessList(-1);dialogue.showMsg({from:"client",content:e,saveIn:1})}),o){dialogue.showMsg({from:"visitor",content:i,saveIn:1});var n=t(".onlineCls[data-num='"+o+"']");n.length>0?t(n).click():dialogue.showMsg({from:"robot",content:lang.businessList.select,saveIn:1})}else dialogue.showMsg({from:"visitor",content:i,saveIn:1}),dialogue.showMsg({from:"robot",content:lang.businessList.select,saveIn:1})}}t("#dialogue-footer-text").text(""),mobileInput.focusAfterInsert()&&t("#dialogue-footer-text").focus(),uccH5Event.scrollToBottom(),setTimeout(function(){t("#dialogue-footer-text").html().length>0&&"<br>"!=t("#dialogue-footer-text").html()?(t("#dialogue-send").show(),t("#dialogue-add").hide(),t("#dialogue-footer-face").hide(),t(".dialogue").removeClass("dialogue-short"),t(".dialogue-footer-select").hide()):(t("#dialogue-send").hide(),t("#dialogue-add").show(),t("#dialogue-footer-text").empty())},1e3)})},faceBind:function(){t("#dialogue-biaoqing").unbind().click(function(){if(dialogue.islive()){var e=t(".dialogue-footer-face").is(":hidden");e?t(".dialogue-footer-face").show():t(".dialogue-footer-face").hide(),t(".dialogue").css("bottom",t(".dialogue-footer").height())}})},closeBind:function(){t(".close").click(function(){dialogue.islive()?confirmBox.create(lang.closeChat).done(function(e){e&&(dialogue.end(5),t(".close").hide())}):confirmBox.create(lang.closeWindow).done(function(t){t&&(e.close(),WeixinJSBridge.call("closeWindow"))})})},uploadInit:function(){t("#dialogue-add").uploadFile({size:5242880,uploadType:"image",inputImage:!0,other:function(e,i,o){if(dialogue.islive()){t("#dialogue-add").find(".fileup").attr("action","/any800/echatManager.do?method=uploadFile&fromType=visitor&chatId="+ucc.chatID),dialogue.showMsg({from:"visitor",content:'<img id="'+o+'" src="./pagesJs/echatJs/webuploader/loading.gif">'});var n=msgdb.last();e.submit(o,n)}},callback:function(e,i,o){var n='<img  src="'+e+'">';t("#"+i).attr("src",e),dialogue.sendMessage(n,"",!0),msgdb.setKey(o,"content",n),changeWindow&&changeWindow.change(),mobileInput.end()},error:function(e,i,o,n){o&&(Alert.show(o),t("#"+i).parents(".dialogue-me.contentMessage").hide(),t("#"+i).parents(".dialogue-me.contentMessage").prev(".time").hide(),msgdb.setKey(n,"isRevoke",!0),changeWindow&&changeWindow.change(),localHistory.setCurrent(msgdb.db)),"type"==e?Alert.show(lang.upload.uploadFileError_4):"size"==e?Alert.show(lang.upload.uploadFileError_5):(Alert.show(lang.upload.uploadFileError_3),t("#"+i).parents(".dialogue-me.contentMessage").hide(),t("#"+i).parents(".dialogue-me.contentMessage").prev(".time").hide(),msgdb.setKey(n,"isRevoke",!0),changeWindow&&changeWindow.change(),localHistory.setCurrent(msgdb.db)),mobileInput.end()}})},reconnectClick:!1,initReconnect:function(){var e=this;t("#message").delegate(".reconnectID","click",function(){dialogue.islive()||datas.get("hasInQueue")||e.reconnectClick||(e.reconnectClick=!0,t.ajax({type:"POST",url:"./echat.do",data:{method:"closeEchat",chatID:ucc.chatID,url:dialogue.getAttr("remoteUrl"),opname:dialogue.getAttr("operatroName")?dialogue.getAttr("operatroName"):""},success:function(e){},dataType:"json",async:!1,cache:!1}),t.ajax({url:"./echatManager.do",data:{method:"initChatId",companyPk:ucc.companyPk,vid:userDatas.getVisitorInfo().visitorId,hjUserData:params.hjUserData},dataType:"json",async:!1,cache:!1}).done(function(t){try{ucc.chatID=t.chatID,storage.set("oldChatId",t.chatID),ucc.browserId=(new Date).getTime(),storage.set("oldChatId",t.chatID),datas.set("openSatisfactionAfterCloseChat",!1),datas.set("hasSatisfaction",!1);userDatas.getJsonStr();uccH5Init.initFunc(),uccH5Logic.addmonitorJs(),detectWeb.setIsReconnection(!0),queue.reqStartQueue(storage.get("businessId"),storage.get("businessName"),detectWeb.getIsReconnection()),e.reconnectClick=!1}catch(t){}}).fail(function(t){e.reconnectClick=!1,dialogue.showSysMsg(lang.errorNetWork)}))})},unload:function(){t(e).unload(function(){storage.get("offChat")==ucc.browserId&&storage.set("offChat",!0),webSocket.isWork&&webSocket.websocket.close()})},messageChange:function(){t("#message").delegate(".message_news","click",function(){t(this).data("url")&&e.open(t(this).data("url"))})},downloadOrigin:function(e){var i=new t.Deferred,o=e.substring(e.lastIndexOf(".")),n=o.toLowerCase(),a=e.substring(0,e.lastIndexOf("."));if(a.indexOf("origin")>-1)return i.resolve(e);if(".jpg"==n||".jpeg"==n||".png"==n||".bmp"==n){var s=a+"origin"+o,r=new Image;if(r.src=s,r.complete)return i.resolve(s);r.onload=function(){return i.resolve(s)},r.onerror=function(){return i.resolve(e)}}return i.promise()},resetInterval:function(){e.requestAnimFrame=function(){return e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||function(t){e.setTimeout(t,100)}}(),e.setTimeout=function(t,i){var o,n=Date.now,a=e.requestAnimFrame,s=n(),r=function(){n()-s<i?o||a(r):t()};return a(r),{clear:function(){o=1}}},e.setInterval=function(t,i){var o,n=Date.now,a=e.requestAnimFrame,s=n(),r=function(){n()-s<i||(s+=i,t()),o||a(r)};return a(r),{clear:function(){o=1}}},e.clearTimeout=function(e){e&&e.clear()},e.clearInterval=function(e){e&&e.clear&&e.clear()}}},t.uccH5Event=function(e){var t=new o(e);return t}}(window,jQuery),function(e,t,i){String.prototype.trim=function(){return this.replace(/(^\s*)|(\s*$)/g,"")};var o=function(e){this.defaults={period:30,after:function(){}},this.options=t.extend({},this.defaults,e)};o.prototype={isInitiate:!1,isReconnection:!1,checkeTimeout:null,msgs:[],period:0,getIsInitiate:function(){return this.isInitiate},getIsReconnection:function(){return this.isReconnection},getMsgs:function(e){return this.msgs.length>e?this.msgs.slice(this.msgs.length-e,this.msgs.length):this.msgs},check:function(){this.period--,this.period<=0&&(this.options.after(),clearInterval(this.checkeTimeout),this.checkeTimeout=null,this.isInitiate=!1,this.period=this.options.period)},checkedSuccess:function(){clearInterval(this.checkeTimeout),this.checkeTimeout=null,this.period=this.options.period,this.isInitiate=!1},setInitiate:function(e){this.isInitiate=e},setIsReconnection:function(e){this.isReconnection=e},checkedFail:function(){var e=this;e.checkeTimeout=setInterval(function(){e.check()},1e3),this.isInitiate=!0},msgPush:function(e,t){this.msgs.push('{"'+e+'":"'+t+'"}')}},t.detectWeb=function(e){var t=new o(e);return t.period=t.options.period,t}}(window,jQuery),function(e,t,i){var o=function(e){this.defaults={BasicSetting:{},ExtraSetting:{},workStr:"温馨提示：尊敬的客户，我们的服务时间是【$1】<br>如果有重要的事情，请点击<a href='javascript:void(0)' class='dialogue-a fanke-liuyan'>在线留言</a><br>给您带来的不便，敬请谅解.",holidayStr:"温馨提示：尊敬的客户，我们的节假日时间是【$1】<br>如果有重要的事情，请点击<a href='javascript:void(0)' class='dialogue-a fanke-liuyan'>在线留言</a><br>给您带来的不便，敬请谅解.",show:function(e){}},this.options=t.extend({},this.defaults,e)};o.prototype={timeZone:"",type:0,init:function(){var e=this,t=this.options.BasicSetting,i=this.options.ExtraSetting;if(t&&1==t.open){var o=t.startTime.split(":"),n=t.endTime.split(":");if(o.length<2||n.length<2)return!1;var a=new Date,s=new Date,r=new Date;a.setHours(o[0]),a.setMinutes(o[1]),a.setSeconds("00"),s.setHours(n[0]),s.setMinutes(n[1]),s.setSeconds("00");for(var c,l,d=r.getMonth()+1<10?"0"+(r.getMonth()+1):r.getMonth()+1,u=r.getDate()<10?"0"+r.getDate():r.getDate(),m=r.getFullYear()+"-"+d+"-"+u,g="",p=t.week,h=r.getDay(),f=p.split(","),v=!1,w=0;w<=f.length;w++)switch(f[w]){case"0":g+="星期日&nbsp";break;case"1":g+="星期一&nbsp";break;case"2":g+="星期二&nbsp";break;case"3":g+="星期三&nbsp";break;case"4":g+="星期四&nbsp";break;case"5":g+="星期五&nbsp";break;case"6":g+="星期六&nbsp"}if(13==p.length&&(g=""),p.indexOf(h)>=0){if(r.getTime()>s.getTime()||r.getTime()<a.getTime())return e.type=1,e.timeZone=g+t.startTime+"-"+t.endTime,!1;for(var w=0;w<i.length;w++)if(1==i[w].exceType&&i[w].exceStartTime<=m&&i[w].exceEndTime>=m){c=i[w].exceStartTime,l=i[w].exceEndTime,v=!0;break}if(v)return e.type=2,e.timeZone=c+"-"+l,!1}else if("null"!=p){for(var w=0;w<i.length;w++)if(0==i[w].exceType&&i[w].exceStartTime<=m&&i[w].exceEndTime>=m){c=i[w].exceStartTime,l=i[w].exceEndTime,v=!0;break}if(!v)return e.type=1,e.timeZone=g+t.startTime+"-"+t.endTime,!1}}},iswork:function(){var e=this;e.type=0;var t=e.options.BasicSetting,i=e.options.ExtraSetting;if(t&&1==t.open){var o=t.startTime.split(":"),n=t.endTime.split(":");if(2!=o.length||2!=n.length)return!1;var a=new Date,s=new Date,r=new Date(nowtime);a.setHours(o[0]),a.setMinutes(o[1]),a.setSeconds("00"),s.setHours(n[0]),s.setMinutes(n[1]),s.setSeconds("00");for(var c,l,d=r.getMonth()+1<10?"0"+(r.getMonth()+1):r.getMonth()+1,u=r.getDate()<10?"0"+r.getDate():r.getDate(),m=r.getFullYear()+"-"+d+"-"+u,g="",p=t.week,h=r.getDay(),f=p.split(","),v=!1,w=0;w<=f.length;w++)switch(f[w]){case"0":g+="星期日&nbsp";break;case"1":g+="星期一&nbsp";break;case"2":g+="星期二&nbsp";break;case"3":g+="星期三&nbsp";break;case"4":g+="星期四&nbsp";break;case"5":g+="星期五&nbsp";break;case"6":g+="星期六&nbsp"}if(13==p.length&&(g=""),p.indexOf(h)>=0){if(r.getTime()>s.getTime()||r.getTime()<a.getTime())return e.type=1,e.timeZone=g+t.startTime+"-"+t.endTime,!1;for(var w=0;w<i.length;w++)if(1==i[w].exceType&&i[w].exceStartTime<=m&&i[w].exceEndTime>=m){c=i[w].exceStartTime,l=i[w].exceEndTime,v=!0;break}if(v)return e.type=2,e.timeZone=c+"-"+l,!1}else if("null"!=p){for(var w=0;w<i.length;w++)if(0==i[w].exceType&&i[w].exceStartTime<=m&&i[w].exceEndTime>=m){c=i[w].exceStartTime,l=i[w].exceEndTime,v=!0;break}if(!v)return e.type=1,e.timeZone=g+t.startTime+"-"+t.endTime,!1}}},getMsg:function(){return 1==this.type?this.options.workStr.replace(/\$1/g,this.timeZone):2==this.type&&this.options.holidayStr.replace(/\$1/g,this.timeZone)},show:function(){var e=this.getMsg();this.options.show(e)}},t.workTime=function(e){var t=new o(e);return t.init(),t}}(window,jQuery),function(e,t,i){var o=function(e){this.defaults={businessList:[],aDset:[],root:"-1"},this.options=t.extend({},this.defaults,e)};o.prototype={num:1,basePk:-1,init:function(){var e=this.options.aDset;if(e){this.options.businessList;"0"!=e.joinUpType&&e.joinUpType&&("1"==e.joinUpType||"2"==e.joinUpType),this.reset("-1")}},reset:function(e){for(var t=this,i=this.options.businessList,o=!1,n=0;n<i.length;n++)if(i[n].parentPk==e){var a=t.getList(i[n].pk);if(0==a.length)i[n].operators.length>0&&(o=!0);else{var s=t.reset(i[n].pk);0==s?i[n].operators=[]:1==s&&(o=!0)}}return o},hasList:function(e){for(var t=[],i=this.options.businessList,o=0;o<i.length;o++)i[o].parentPk==e&&(i[o].operators.length>0?t.push({item:i[o],type:"online"}):t.push({item:i[o],type:"offline"}));return t},getList:function(e){for(var t=(this.num,[]),i=this.options.businessList,o=0;o<i.length;o++)i[o].parentPk==e&&(i[o].operators.length>0?(t.push({num:this.num,item:i[o],type:"online"}),this.num++):(t.push({num:this.num,item:i[o],type:"offline"}),this.num++));return t},getAllLength:function(){var e=this.options.businessList;return{listLength:e.length,operatorLength:e.length>0?e[0].operators.length:0,firstItem:e.length>0?e[0]:null}},getParentPk:function(e){for(var t=this.options.businessList,i=0;i<t.length;i++)if(t[i].pk==e)return t[i].parentPk;return null},setSelect:function(e,t){this.select={pk:e,name:t}},getSelect:function(){return this.select},generate:function(e){var t=this.getList(e),i=(this.getParentPk(e),!1);return e==-1&&0==t.length?{access:!0,online:!1}:e==this.basePk&&1==t.length?(this.basePk=t[0].item.pk,this.getList(t[0].item.pk).length>0?this.generate(t[0].item.pk):t[0].item.operators.length>0?{access:!0,online:!0,pk:t[0].item.pk,name:t[0].item.name}:{access:!0,online:!1,pk:t[0].item.pk,name:t[0].item.name}):(this.basePk==e&&(i=!0),{access:!1,list:t,root:i})},getItemOnline:function(e){for(var t=this.options.businessList,i=!1,o=0;o<t.length;o++)t[o].pk==e&&t[o].operators.length>0&&(i=!0);return i}},t.businessList=function(e){var t=new o(e);return t.init(),t}}(window,jQuery),function(e,t,i){var o=0,n=0,a=function(e){this.defaults={picStr:"<img id='showpic' src='$1'/>",bgColor:"rgba(0,0,0,0.5)"},this.options=t.extend({},this.defaults,e)};a.prototype={init:function(){var e=this;e.getScreenRatio(),t(".showPicture").length>0||(t("body").append('<div class="showPicture"></div>'),t(".showPicture").css({position:"fixed",top:"0",bottom:"0",left:"0",right:"0",background:e.options.bgColor,display:"none",zIndex:"1001"}))},showPic:function(e){var i=this;i.init(),t(".showPicture").html("").append(this.options.picStr.replace(/\$1/g,e)),t(".showPicture").show();var n=document.getElementById("showpic");n.complete?(o=t(".showPicture img").width()/t(".showPicture img").height(),i.getShowPic()):n.onload=function(){o=t(".showPicture img").width()/t(".showPicture img").height(),i.getShowPic()},t(".showPicture").unbind().on("click",function(e){t(".showPicture").hide()})},getShowPic:function(){n&&o&&(n>o?t(".showPicture img").height()>=t(e).height()?t(".showPicture img").css({width:"auto",height:"98%",padding:" 1% 0",display:"block",margin:"0 auto",position:"initial",top:"0"}):t(".showPicture img").css({display:"block",margin:"0 auto",position:"relative",top:(t(e).height()-t(".showPicture img").height())/2+"px"}):t(".showPicture img").width()>=t(e).width()?(t(".showPicture img").css({display:"initial",width:"98%",padding:"0 1%",height:"auto",position:"fixed",top:"50%"}),t(".showPicture img").css({marginTop:-t(".showPicture img").height()/2})):(t(".showPicture img").css({display:"initial",left:"50%",position:"fixed",top:"50%",padding:"1% 1%"}),t(".showPicture img").css({marginTop:-t(".showPicture img").height()/2,marginLeft:-t(".showPicture img").width()/2})))},getScreenRatio:function(){n=t(e).width()/t(e).height()}},t.showBigImg=function(e){var t=new a(e);return t.init(),t}}(window,jQuery),function(e,t,i){var o=function(e){this.defaults={msgdb:null,clientEndtime:480,clientBusytime:240,visitorEndTime:240,visitorHalfTime:120,ops:{},startFun:function(){}},this.options=t.extend({},this.defaults,e)};o.prototype={diaList:new Object,timeout:null,hasVisitorHalfTimeout:!1,hasVisitorTimeout:!1,hasClientBusy:!1,hasClientEnd:!1,init:function(){this.setTime()},setTime:function(){var e=this.options.ops;this.options.clientEndtime=e.customerFroVisitors?e.customerFroVisitors:this.options.clientEndtime,this.options.clientBusytime=e.customerBusy?e.customerBusy:this.options.clientBusytime,this.options.visitorEndTime=e.customerFroVisitors?e.customerFroVisitors:this.options.visitorEndTime,this.options.visitorHalfTime=this.options.visitorEndTime<=2*this.options.visitorHalfTime?this.options.visitorEndTime/2:this.options.visitorEndTime-this.options.visitorHalfTime},startALLTimeout:function(){var e=this;clearInterval(this.timeout),this.timeout=setInterval(function(){e.options.startFun()},1e3)},endChat:function(){this.hasVisitorHalfTimeout=!0,this.hasVisitorTimeout=!0,this.hasClientBusy=!0,this.hasClientEnd=!0},reset:function(){this.hasVisitorHalfTimeout=!1,this.hasVisitorTimeout=!1,this.hasClientBusy=!1,this.hasClientEnd=!1},removeDiaList:function(e){delete this.diaList[e]},diaListLast:function(){var e,t=this.options.msgdb;for(var i in t.db)t.db[i]&&"robot"!=t.db[i].type&&"system"!=t.db[i].type&&!t.db[i].isRevoke&&(e&&("visitor"==t.db[i].type&&"visitor"==t.db[e].type||"client"==t.db[i].type&&"client"==t.db[e].type)||(e=i));return e},isVisitorHalfTimeout:function(){var e=this.options.msgdb,t=this,i=e.db[t.diaListLast()];
if(!t.hasVisitorHalfTimeout&&i&&"client"==i.type){var o=(new Date).getTime();if(o-i.time>=1e3*t.options.visitorHalfTime&&!i.hasChecked)return e.db[t.diaListLast()].hasChecked=!0,t.hasVisitorHalfTimeout=!0,!0}return!1},isVisitorTimeout:function(){var e=this.options.msgdb,t=this,i=e.db[t.diaListLast()];if(!t.hasVisitorTimeout&&i&&"client"==i.type){var o=(new Date).getTime();if(o-i.time>=1e3*t.options.visitorEndTime)return t.hasVisitorTimeout=!0,!0}return!1},isClientBusy:function(){var e=this.options.msgdb,t=this,i=this.options.ops,o=e.db[t.diaListLast()];if(0==i.customerBusy)return!1;if(!t.hasClientBusy&&o&&"visitor"==o.type){var n=(new Date).getTime();if(n-o.time>=1e3*t.options.clientBusytime&&!o.hasChecked)return e.db[t.diaListLast()].hasChecked=!0,t.hasClientBusy=!0,!0}return!1},isClientEnd:function(){var e=this.options.msgdb,t=this,i=e.db[t.diaListLast()],o=(new Date).getTime();return!!(o-i.time>=1e3*t.options.clientEndtime&&!t.hasClientEnd&&i.hasChecked)&&(e.db[t.diaListLast()].hasChecked=!0,t.hasClientEnd=!0,!0)}},t.TimeoutList=function(e){var t=new o(e);return t.init(),t}}(window,jQuery),function(e,t,i){var o=[['<img emotions="true" name="faceIco" src="/any800/style/images/mobileImages/newImages/face01.png" data-name="/::)" id="/::)">',"/::)","/::\\)"],['<img emotions="true" name="faceIco" src="/any800/style/images/mobileImages/newImages/face02.png" id="/::P" data-name="/::P">',"/::P","/::P"],['<img emotions="true" name="faceIco" src="/any800/style/images/mobileImages/newImages/face03.png" id="/::$" data-name="/::$">',"/::$","/::\\$"],['<img emotions="true" name="faceIco" src="/any800/style/images/mobileImages/newImages/face04.png" id="/::D" data-name="/::D">',"/::D","/::D"],['<img emotions="true" name="faceIco" src="/any800/style/images/mobileImages/newImages/face05.png" id="/::-|" data-name="/::-|">',"/::-|","/::\\-\\|"],['<img emotions="true" name="faceIco" src="/any800/style/images/mobileImages/newImages/face06.png" id="/::+" data-name="/::+">',"/::+","/::\\+"],['<img emotions="true" name="faceIco" src="/any800/style/images/mobileImages/newImages/face07.png" id="/:,@-D"  data-name="/:,@-D">',"/:,@-D","/:,@\\-D"],['<img emotions="true" name="faceIco" src="/any800/style/images/mobileImages/newImages/face08.png" id="/::>" data-name="/::&gt;">',"/::&gt;","/::&gt;","/::>"],['<img emotions="true" name="faceIco" src="/any800/style/images/mobileImages/newImages/face09.png" id="/:,@f" data-name="/:,@f">',"/:,@f","/:,@f"],['<img emotions="true" name="faceIco" src="/any800/style/images/mobileImages/newImages/face10.png" id="/:?" data-name="/:?">',"/:?","/:\\?"],['<img emotions="true" name="faceIco" src="/any800/style/images/mobileImages/newImages/face11.png" id="/:bye" data-name="/:bye">',"/:bye","/:bye"],['<img emotions="true" name="faceIco" src="/any800/style/images/mobileImages/newImages/face12.png" id="/:handclap" data-name="/:handclap">',"/:handclap","/:handclap"],['<img emotions="true" name="faceIco" src="/any800/style/images/mobileImages/newImages/face13.png" id="/::*" data-name="/::*">',"/::*","/::\\*"],['<img emotions="true" name="faceIco" src="/any800/style/images/mobileImages/newImages/face14.png" id="/:strong" data-name="/:strong">',"/:strong","/:strong"],['<img emotions="true" name="faceIco" src="/any800/style/images/mobileImages/newImages/face15.png" id="/:P-(" data-name="/:P-(">',"/:P-(","/:P\\-\\("],['<img emotions="true" name="faceIco" src="/any800/style/images/mobileImages/newImages/face16.png" id="/:rose" data-name="/:rose">',"/:rose","/:rose"],['<img emotions="true" name="faceIco" src="/any800/style/images/mobileImages/newImages/face17.png" id="/:share" data-name="/:share">',"/:share","/:share"],['<img emotions="true" name="faceIco" src="/any800/style/images/mobileImages/newImages/face18.png" id="/:ok" data-name="/:ok">',"/:ok","/:ok"],['<img emotions="true" name="faceIco" src="/any800/style/images/mobileImages/newImages/face19.png" id="/:sun"  data-name="/:sun">',"/:sun","/:sun"],['<img emotions="true" name="faceIco" src="/any800/style/images/mobileImages/newImages/face20.png" id="/:heart" data-name="/:heart">',"/:heart","/:heart"],['<img emotions="true" name="faceIco" src="/any800/style/images/mobileImages/newImages/face21.png" id="/:hug" data-name="/:hug">',"/:hug","/:hug"]],n=function(e){this.defaults={imgIco:[],after:function(){}},this.options=t.extend({},this.defaults,e)};n.prototype={init:function(){this.options.imgIco=o,this.options.after()},getItems:function(){return o},imgToIco:function(e){var i=e;if(!i||"string"!=typeof e)return i;var n=t("<div>"+e+"</div>");for(var a in o)n.find("img[data-name='"+o[a][1]+"']").each(function(e){t(this).replaceWith(o[a][1])});return i=n.html()},icoToImg:function(e){var t=e;if(!t||"string"!=typeof e)return t;for(var i in o)t.indexOf(o[i][1])!=-1&&(t.indexOf(o[i][1])!=-1?t=t.replace(new RegExp(o[i][2],"gm"),o[i][0]):o[i][3]&&t.indexOf(o[i][3])!=-1&&(t=t.replace(new RegExp(o[i][3],"gm"),o[i][0])));return t}},t.changeFace=function(e){var t=new n(e);return t.init(),t}}(window,jQuery),function(e,t,i){var o,n=function(e){this.defaults={companyPk:""},this.options=t.extend({},this.defaults,e)};n.prototype={init:function(){e.localStorage&&(o=e.localStorage),this.setVersion()},setVersion:function(){var e=this,t=e.get("version"),i=e.get("jsonStr"),n=e.get("visitor"),a=e.get("localHis");t&&"8.0.1"==t||(o&&o.clear(),i&&e.set("jsonStr",i),n&&e.set("visitor",n),a&&e.set("localHis",a),e.set("version","8.0.1"))},get:function(e){var i=null;"version"!=e&&(e="c"+this.options.companyPk+"-"+e),o?(i=o[e],i&&(i=decodeURIComponent(o[e]))):t.cookie&&(i=decodeURIComponent(t.cookie(e)));try{i=JSON.parse(i)}catch(n){}return i},set:function(e,i){"version"!=e&&(e="c"+this.options.companyPk+"-"+e),o?("object"==typeof i&&(i=JSON.stringify(i)),o[e]=encodeURIComponent(i)):t.cookie&&t.cookie(e,encodeURIComponent(i))},clear:function(e){"version"!=e&&(e="c"+this.options.companyPk+"-"+e),o?o.removeItem(e):t.cookie&&t.cookie(e,null)}},t.storage=function(e){var t=new n(e);return t.init(),t}}(window,jQuery),function(e,t,i){var o=function(e){this.defaults={vocabulary:{}},this.options=t.extend({},this.defaults,e)};o.prototype={get:function(e){var t=e,i=this.options.vocabulary;if(i&&i.content&&1==i.isVisable)for(var o=i.content.split(":"),n=0;n<o.length;n++)if(o[n])for(var a=0;a<=t.length;a++)t=t.replace(o[n],"*");return t}},t.sensitive=function(e){var t=new o(e);return t}}(window,jQuery),function(e,t,i){var o=function(e){this.defaults={bgColor:"rgba(0,0,0,0.3)",time:2},this.options=t.extend({},this.defaults,e)};o.prototype={isUse:!1,init:function(){var e=this;t("body").append("<div class='alert'><div class='col'></div></div>"),t(".alert").on("click",function(i){e.isUse=!1,t(".alert").hide()})},show:function(e,i){var o=this;0==o.isUse&&(o.isUse=!0,i&&"error"==i&&t(".alert .col").addClass("error"),t(".alert .col").html(e),t(".alert").show(),t(".alert .col").css({marginLeft:-t(".alert .col").width()/2-20,marginTop:-t(".alert .col").height()-10}),setTimeout(function(){o.isUse=!1,t(".alert").hide(),t(".alert .col").removeClass("error")},1e3*o.options.time))}},t.Alert=function(e){var t=new o(e);return t.init(),t}}(window,jQuery),function(window,$,undefined){var mobile_type_arr=["ipad","ipod","iphone","ios","ios","android","backerry","webos","symbian","windows phone","phone","blackberry"],mobile_pc_browser_json={micromessenger:"微信浏览器",ucbrowser:"UC浏览器",qqbrowser:"QQ浏览器",opera:"Opera浏览器",baidubrowser:"百度浏览器",firefox:"火狐浏览器",maxthon:"傲游浏览器",xiaomi:"小米手机浏览器",chrome:"Chrome浏览器",android:"android内置浏览器",iphone:"iphone内置浏览器",ipod:"opod内置浏览器",ipad:"ipad内置浏览器"},pc_browser_json={qqbrowser:"QQ浏览器",opera:"Opera浏览器",maxthon:"傲游浏览器",tencenttraveler:"TT浏览器",theworld:"天天浏览器",lbbrowser:"猎豹浏览器",chrome:"Chrome浏览器",firefox:"Firefox浏览器",msie:"IE浏览器",safari:"Safari浏览器",metasr:"搜狗浏览器"},DATAS=function(e){this.defaults={param:null,storage:null,storageVisitor:"visitor",storageIpStr:"ipStr",storageChatNum:"chatNum",companyPk:"",aDset:null,chatID:"",businessId:"",businessName:"",storageOldService:"",opShow:""},this.options=$.extend({},this.defaults,e)};DATAS.prototype={hasGetJson:!1,hasGetVisitor:!1,hasIpStr:!1,getJsonStr:function(){var e=this,t={};e.hasGetJson&&(e.options.param.mn="");var i=this.getVisitorInfo(),o=this.options.aDset,n=this.getIpStr();if(e.options.param&&e.options.param.mn){var a=JSON.parse(decodeURIComponent(e.options.param.mn));t={companyPk:e.options.companyPk,visitorId:i.visitorId,visitorName:i.visitorName,businessId:e.options.businessId,businessName:e.options.businessName,chatID:e.options.chatID,browsingNum:a.browsingNum,fromPage:a.fromPage?a.fromPage:document.referrer.replace(/[&]/g,"%26")?document.referrer.replace(/[&]/g,"%26"):"",title:"",ip:n.cip,ipName:n.cname,usersource:o?o.scheme_Name:"",codeKey:this.options?this.options.param.codeKey:"",opShow:e.options.opShow,oldService:e.options.storageOldService,keyword:a.keyword,searchEngine:a.searchEngine,lastTime:Number(a.lastTime)?a.lastTime:"Invalid Date"==new Date(a.lastTime)?"":new Date(a.lastTime),firstTime:Number(a.firstTime)?a.firstTime:"Invalid Date"==new Date(a.firstTime)?"":new Date(a.firstTime),chatNum:e.getChatNum(),operatingSystem:e.getOperatingSystem(),visitor:i,commodity:{shopImgUrl:"",shopName:"",shopNum:"",shopPrice:"",shopUrl:""}}}else{var s=e.options.storage.get("jsonStr");t={visitorId:i.visitorId,companyPk:e.options.companyPk,visitorName:i.visitorName,businessId:e.options.businessId,businessName:e.options.businessName,chatID:e.options.chatID,browsingNum:s&&s.browsingNum?s.browsingNum:"",fromPage:s&&s.fromPage?s.fromPage:document.referrer.replace(/[&]/g,"%26")?document.referrer.replace(/[&]/g,"%26"):"",title:s&&s.title?s.title:"",usersource:o?o.scheme_Name:"",codeKey:this.options?this.options.param.codeKey:"",opShow:e.options.opShow,oldService:e.options.storageOldService,ip:n.cip,ipName:n.cname,keyword:s&&s.keyword?s.keyword:"",searchEngine:s&&s.searchEngine?s.searchEngine:"",lastTime:s&&s.lastTime?s.lastTime:"",firstTime:s&&s.firstTime?s.firstTime:"",chatNum:e.getChatNum(),operatingSystem:e.getOperatingSystem(),visitor:i,commodity:{shopImgUrl:"",shopName:"",shopNum:"",shopPrice:"",shopUrl:""}}}if(e.options.param.pageInfo&&e.options.param.isuse&&"true"==e.options.param.isuse){var r=decodeURIComponent(e.options.param.pageInfo),c=r.split("|"),l="",d="";1==c.length?(d=c[0].trim(),"null"==d&&(d="")):c.length>=2&&(d=c[0].trim(),l=c[1].trim(),"null"==d&&(d=""),"null"==l&&(l="")),t.title=encodeURIComponent(d),t.fromPage=encodeURIComponent(l)}else t.title="",t.fromPage="";if(e.options.param.defineParamsJson){var u=decodeURIComponent(e.options.param.defineParamsJson);t.defineParamsJson=u?u:""}return e.hasGetJson=!0,e.options.storage.set("jsonStr",t),t},getChatNum:function(){return this.options.storage.get(this.options.storageChatNum)?this.options.storage.get(this.options.storageChatNum):0},getOperatingSystem:function(){var e=this.options.param,t="pc",i=navigator.userAgent.toLowerCase(),o=/(iPhone|iPod|Android|ios|iOS|iPad|Backerry|WebOS|Symbian|Windows Phone|Phone|BlackBerry)/i;null!=i.match(o)&&(t="mb"),e&&e.qr&&(t="ma");var n=window.screen.width+"×"+window.screen.height,a=navigator.systemLanguage?navigator.systemLanguage:navigator.language?navigator.language:"",s={sysInfo:t,browserName:this.getUserAgent().browser_name,browser:this.getUserAgent().browser_type,operatorSystem:this.getUserAgent().terminal_system,sysResolution:n,language:a};return s},getUserAgent:function(){var e={},t=navigator.userAgent.toLowerCase(),i=/(iPhone|iPod|Android|ios|iOS|iPad|Backerry|WebOS|Symbian|Windows Phone|Phone|BlackBerry)/i;if(null!=t.match(i)){e.terminal_Type="移动终端";for(var o=0;o<mobile_type_arr.length;o++)if(t.indexOf(mobile_type_arr[o])>-1){e.terminal_system=mobile_type_arr[o];break}null!=e.terminal_system&&""!=e.terminal_system||(e.terminal_system="未知");for(var o in mobile_pc_browser_json)if(t.indexOf(o)>-1){e.browser_type=mobile_pc_browser_json[o],e.browser_name=o;break}null!=e.browser_type&&""!=e.browser_type||(e.browser_type="未知",e.browser_name="未知")}else{e.terminal_Type="PC终端";var n="未知",a="Win32"==navigator.platform||"Windows"==navigator.platform,s="Mac68K"==navigator.platform||"MacPPC"==navigator.platform||"Macintosh"==navigator.platform||"MacIntel"==navigator.platform;s&&(n="Mac");var r="X11"==navigator.platform&&!a&&!s;r&&(n="Unix");var c=String(navigator.platform).indexOf("Linux")>-1;if(c&&(n="Linux"),a){var l=t.indexOf("windows nt 5.0")>-1||t.indexOf("windows 2000")>-1;l&&(n="Win2000");var d=t.indexOf("windows nt 5.1")>-1||t.indexOf("windows xp")>-1;d&&(n="WinXP");var u=t.indexOf("windows nt 5.2")>-1||t.indexOf("windows 2003")>-1;u&&(n="Win2003");var m=t.indexOf("windows nt 6.0")>-1||t.indexOf("windows vista")>-1;m&&(n="WinVista");var g=t.indexOf("windows nt 6.1")>-1||t.indexOf("windows 7")>-1;g&&(n="Win7");var p=t.indexOf("windows nt 6.2")>-1||t.indexOf("windows 7")>-1;p&&(n="Win8");var h=t.indexOf("windows nt 10.0")>-1||t.indexOf("windows 10")>-1;h&&(n="Win10");var f=t.indexOf("Edge")>-1;f&&(n="WinEdge")}e.terminal_system=n;for(var o in pc_browser_json)if(t.indexOf(o)>-1){e.browser_type=pc_browser_json[o],e.browser_name=o;break}if(null==e.browser_type||""==e.browser_type){var v="Win10"==n,f="WinEdge"==n;v||f?(e.browser_type=pc_browser_json.msie,e.browser_name="msie"):(e.browser_type="未知",e.browser_name="未知")}}return e.flash_version=this.getFlash_version(),e},getFlash_version:function(){var f="-",n=navigator;if(n.plugins&&n.plugins.length){for(var ii=0;ii<n.plugins.length;ii++)if(n.plugins[ii].name.indexOf("Shockwave Flash")!=-1){f=n.plugins[ii].description.split("Shockwave Flash ")[1];break}}else if(window.ActiveXObject)for(var ii=10;ii>=2;ii--)try{var fl=eval("new ActiveXObject('ShockwaveFlash.ShockwaveFlash."+ii+"');");if(fl){f=ii+".0";break}}catch(e){}return f},getIpStr:function(){var e=this;if(e.hasGetIpStr)return e.options.storage.get(e.options.storageIpStr);var t=null;return e.options.storage.get(e.options.storageIpStr)?t=e.options.storage.get(e.options.storageIpStr):$.ajax({url:"./echatManager.do?method=getIp",dataType:"jsonp",async:!1,complete:function(){t="object"==typeof returnCitySN?returnCitySN:{cip:"0.0.0.0",cid:"0",cname:"未知地区"}}}),e.hasGetIpStr=!0,e.options.storage.set(e.options.storageIpStr,t),t},getVisitorInfo:function(){var e=this,t={};if(!e.hasGetVisitor&&e.options.param&&e.options.param.mn){var i=JSON.parse(decodeURIComponent(e.options.param.mn));if(t.visitorId=i.visitorId,t.visitorName=i.visitorName,e.options.param.hjUserData){var o=decodeURIComponent(e.options.param.hjUserData),n=o.split("|");try{t.sex=n[1],t.realName=n[0],t.phone=n[2],t.mobile=n[3],t.email=n[4],t.QQ=n[8],t.MSN=n[7],t.address=n[5],t.company=n[6],t.visitorId=n[9],t.visitorName=n[0]}catch(a){}}}else if(!e.hasGetVisitor&&e.options.param&&e.options.param.memberPk)t.visitorId=e.options.param.memberPk;else if(e.options.storage.get(e.options.storageVisitor)){var s=e.options.storage.get(e.options.storageVisitor);t.visitorId=s.visitorId?s.visitorId:"",""==t.visitorId&&$.ajax({type:"POST",url:"echatManager.do?method=generationVisitorsID",async:!1,data:{companyPk:e.options.companyPk},dataType:"json"}).done(function(e){e&&(t.visitorId=e.visitorId)}),t.company=s.company?s.company:"",t.visitorName=s.visitorName?s.visitorName:"访客"+Number(t.visitorId.substring(1)),t.sex=isNaN(Number(s.sex))?0:s.sex,t.degree=s.degree?s.degree:"",t.realName=s.realName?s.realName:"",t.phone=s.phone?s.phone:"",t.mobile=s.mobile?s.mobile:"",t.email=s.email?s.email:"",t.QQ=s.QQ?s.QQ:"",t.MSN=s.MSN?s.MSN:"",t.address=s.address?s.address:"",t.extension=s.extension?s.extension:"",t.memberId=s.memberId?s.memberId:""}t.visitorId||$.ajax({type:"POST",url:"echatManager.do?method=generationVisitorsID",async:!1,data:{companyPk:e.options.companyPk},dataType:"json",async:!1}).done(function(e){e&&(t.visitorId=e.visitorId,t.visitorName="访客"+e.showId)});e.updateVisitorName(t,t.visitorId);return e.hasGetVisitor=!0,e.options.storage.set(e.options.storageVisitor,t),t},updateVisitorName:function(e,t){var i=this;return i.hasGetVisitor||$.ajax({type:"POST",url:"echatManager.do?method=getVisitorsName",async:!1,data:{visitorId:t},dataType:"json"}).done(function(t){t.success&&(e.company=t.company||e.company||"",e.visitorName=t.name||e.visitorName||"",e.sex=isNaN(Number(t.sex))?e.sex?e.sex:0:t.sex,e.degree=t.degree||e.degree||"",e.realName=t.realName||e.realName||"",e.phone=t.phone||e.phone||"",e.mobile=t.mobile||e.mobile||"",e.email=t.email||e.email||"",e.QQ=t.QQ||e.QQ||"",e.MSN=t.MSN||e.MSN||"",e.address=t.address||e.address||"",e.extension=t.extension||e.extension||"",e.memberId=t.memberId||e.memberId||"")}),e}},$.userDatas=function(e){var t=new DATAS(e);return t}}(window,jQuery),function(e,t,i){var o=function(){var e=location.href,t=e.indexOf("?")!==-1?e.split("?").pop():"",i={};return t.replace(/(\w+)(?:=([^&]*))?/g,function(e,t,o){i[t]=o}),i};t.getParameter=o}(window,jQuery),function(e,t,i){var o=function(e){this.defaults={open:!1,msgdb:null,storage:null,chatId:"",browserId:"",dialogue:null,data:null,TimeoutList:null,start:function(){},end:function(){}},this.options=t.extend({},this.defaults,e)};o.prototype={isChanged:!1,browserInterval:null,db:{},change:function(){var e=this.options.storage,t=this.options.chatId,i=e.get("currentChat")?e.get("currentChat"):[];i=this.options.msgdb.getAll(),e.get("currentChatId")&&this.options.chatId==e.get("currentChatId")||(i=[]),e.set("currentChatId",t),e.set("currentChat",i)},clear:function(){this.options.chatId},check:function(){var e=this.options.chatId,t=this.options.storage;return!(!t.get("currentChat")||!t.get("currentChatId")||t.get("currentChatId")!=e)&&t.get("currentChat")},setMsgObj:function(e){var t=(this.options.chatId,this.options.storage);t.set("msgObjCurrentChat",e)},getMsgObj:function(){var e=this.options.storage;return e.get("msgObjCurrentChat")},init:function(){var e=this.options.storage,t=this;t.db=this.options.storage.get("currentChat"),t.options.open&&(e.get("browserId")&&e.get("currentChatId")&&t.options.chatId==e.get("currentChatId")&&e.set("browserId",t.options.browserId),t.startcheck(),"over"!=t.browserInterval&&(t.browserInterval=setInterval(function(){t.startcheck()},1e3)))},startcheck:function(){var e=this,t=this.options.storage,i=this.options.dialogue,o=this.options.data,n=this.options.msgdb;if(t.get("browserId")&&e.options.chatId==t.get("currentChatId"))if(1!=t.get("offChat")&&e.options.browserId!=t.get("browserId"))1==i.islive()&&(i.end(),e.options.end());else if(e.options.browserId==t.get("browserId")&&e.getMsgObj()&&0==i.islive()){e.isChanged=!0,t.set("browserId",e.options.browserId),t.set("offChat",e.options.browserId),n.clear(),e.options.start();var a=e.getMsgObj();if(o.set("reconnectData",a),i.setAttr("remoteUrl",a.url),i.setAttr("_workGroupName",a.workgroupName),i.setAttr("operatorName",a.opShow),o.set("opName",a.workgroupName),o.set("_workGroupName",a.workgroupName),i.start(),e.db){var s=e.db;for(var r in s){var c=s[r];!c||"visitor"!=c.type&&"client"!=c.type&&"robot"!=c.type?c&&"system"==c.type&&c.content&&i.showSysMsg(c.content):c.content&&!c.isRevoke&&0==c.status&&2!=c.checkSend&&i.showMsg({msgid:c.msgId,date:c.time,content:c.content,from:c.type,status:c.status,hasChecked:c.hasChecked}),n.id=parseInt(r)+1}e.options.TimeoutList.startALLTimeout(),n.db=e.db}}},stopCheck:function(){var e=this;clearInterval(e.browserInterval),e.browserInterval="over",e.clear()}},t.changeWindow=function(e){var t=new o(e);return t}}(window,jQuery),function(e,t,i){var o=function(e){this.defaults={chatID:"",companyPk:"",langPk:0,message:{},IpStr:"",always:function(e){},success:function(e){},fail:function(e){},leave:function(){},continueque:function(){}},this.options=t.extend({},this.defaults,e)};o.prototype={businessId:"",businessName:"",isTimeOut:!1,index:1,start:function(e,i){var o=this;t.ajax({type:"POST",url:"./queue.do",dataType:"json",data:{method:"inQueue",chatID:o.options.chatID,companyPk:o.options.companyPk,langPk:o.options.langPk,message:o.options.message,IpStr:o.options.IpStr}}).done(function(t){t&&(1==t.success?o.options.success(t):1==t.locked?o.start(e,i):1==t.inqueue?(o.getInfo(e,0,!1),o.options.always(t)):0==t.errorCode?o.getInfo(e,0,!1):0==t.server?o.options.fail(t):o.options.leave(t)),o.failTime=0}).fail(function(){o.failTime=o.failTime||(new Date).getTime(),(new Date).getTime()-o.failTime>9e3?o.options.fail({msg:"网络问题,您已离开"}):setTimeout(function(){o.start(e,i)},1e3)})},getInfo:function(e,i,o){var n=this;t.ajax({type:"POST",url:"./queue.do",dataType:"json",data:{method:"getBusinessQueue",chatID:n.options.chatID,companyPk:n.options.companyPk,langPk:n.options.langPk,message:n.options.message,businessId:e,index:i,isouttimes:o}}).done(function(t){t&&(1==t.success?(n.index!=t.index&&(n.index=t.index,n.options.always(t)),t.workgroupName?t.url&&n.options.success(t):1==t.inqueue?setTimeout(function(){n.options.always(t),n.getInfo(e,t.index,!1)},1e3):setTimeout(function(){n.getInfo(e,t.index,!1)},2e3)):1==t.locked?n.getInfo(e,n.index,!1):0==t.over?(n.isTimeOut=!0,n.options.fail(t),setTimeout(function(){1==n.isTimeOut&&n.getInfo(e,t.index,!0)},1e4)):0==t.server?n.options.fail(t):n.options.fail(t)),n.failTime=0}).fail(function(){n.failTime=n.failTime||(new Date).getTime(),(new Date).getTime()-n.failTime>9e3?n.options.fail({msg:"网络问题,您已离开"}):setTimeout(function(){n.getInfo(e,n.index,!1)},1e3)})},continueque:function(e,i,o){var n=this;t.ajax({type:"POST",url:"./queue.do",dataType:"json",data:{method:"continueBusinessQueue",chatID:n.options.chatID,companyPk:e,langPk:i,businessId:o}}).done(function(e){n.istimeout=!1,n.getInfo(o,0,!1),n.options.continueque(e)})}},t.queueManager=function(e){var t=new o(e);return t}}(window,jQuery),function(e,t,i){var o=function(e){this.defaults={chatId:"",storage:null},this.options=t.extend({},this.defaults,e)};o.prototype={list:{},get:function(e){var t=this.options.storage;if(t){var i=t.get("data");return i?i[e]:i}var o=this.options.chatId+e;return this.list[o]?this.list[o]:null},set:function(e,t){var i=this.options.storage;if(i){var o=i.get("data");o=o?o:{},o[e]=t,i.set("data",o)}else{var n=this.options.chatId+e;this.list[n]=t}}},t.db=function(e){var t=new o(e);return t}}(window,jQuery),function(e,t,i){var o=function(e){this.defaults={webSocket:null,timeStr:'<p class="dialogue-date">$1</p>',resendStr:'<div class="msg_sending" ><img src="style/images/sending.gif"></div>',callbackStr:'<div class="msg_repeat" ><img style="vertical-align: bottom;margin-right:5px;" src="style/images/repeat.png"></div>',msgEle:"#message",visitorId:"",historyEle:"#historyChat",textEle:".dialogue-area-write",storage:null,browserId:"",limitReceiveTime:60,changeFaceFun:null,chatId:"",detectWeb:null,userDatas:null,msgList:{reconnectSuc:"重连服务器成功！",reconnectFail:"网络异常，系统正尝试重连服务器！"},closeStrList:[["对话出现异常，对话结束.","對話出現異常，對話結束.","Dialogue is abnormal, the dialogue."],["对话结束，客服离开对话.","對話結束，客服離開對話。","End of the conversation, customer service left the conversation."],["对话超时，对话结束。","對話超時，對話結束。","Dialogue timeout, the end of the conversation.Dialogue timeout, the end of the conversation."],["您好，为了保证服务质量，我们已经结束了对话，期待再次为您服务。","對話關閉，客服結束對話","dialog closes, end customer dialogue."],["响应超时，对话结束。","響應超時，對話結束。","Response timeout, end of the conversation."],["您结束了对话。","您結束了對話。","You end the conversation."],["网络中断，如需继续对话，请<a href='javascript:void(0)' class='reconnectID'>点击此处</a>重新发起对话","網絡斷開，對話結束。","Network disconnection,end of the conversation."],["客服网络中断，当前对话结束，如需继续对话，请<a href='javascript:void(0)' onclick=''  class='reconnectID'>点击此处</a>重新接入。","客服网络中断，当前对话结束，如需继续对话，请重新接入。","Customer's Network has bean interrupted ,end of the conversation."],["网络异常，当前对话结束，如需继续对话，<a href='javascript:void(0)' onclick=''  class='reconnectID'>请重新接入</a>。","客服网络中断，当前对话结束，如需继续对话，请重新接入。","Network has bean interrupted ,end of the conversation."]],showSysMsgFun:function(e){},getReceivedFun:function(e){},msgReplace:function(e){},startChat:function(){},endChat:function(){},sendMessageFun:function(e,t){},msgFun:function(e){},closeTool:function(){},openTool:function(){},confirmSend:function(e,t){},specialFun:function(e,t){},endChatFun:function(){}},this.options=t.extend({},this.defaults,e)};o.prototype={msgPair:{},diaCount:0,isSpeech:!1,lastSend:"",diaList:new Object,readMessageTimeout:null,readMessageInterval:null,prevTextInterval:null,time:(new Date).getTime(),attr:{langType:0,islive:!1,operatorName:"",remoteUrl:"",_workGroupName:""},getAttr:function(e){return"undefined"!=typeof e?this.attr[e]:""},setAttr:function(e,t){this.attr[e]=t},islive:function(){return this.getAttr("islive")},showMsg:function(e){var i=e.msgid?e.msgid:"",o=e.date?e.date:"",n=e.content,a=e.from?e.from:"client",s=e.status?e.status:0,r=this.options.userDatas,c=this.options.msgReplace(a),l="client"==a,d=l?this.getAttr("operatorName"):"robot"==a?this.islive()?this.getAttr("operatorName"):"客服":r.getJsonStr().visitorName?r.getJsonStr().visitorName:"访客";if(n&&"null"!=n){var u=/^((ht|f)tps?):\/\/[\w\-]+(\.[\w\-]+)+([\w\-\.,@?^=%&:\/~\+#]*[\w\-\@?^=%&\/~\+#])?$/,m=t("<div>"+n+"</div>").text();if("client"==a&&u.test(m)&&n.indexOf("audio")<0){var g="<a href="+m+" target='_blank'>"+m+"</a>";n=g,this.options.specialFun("openWin",g)}if(n=this.messageChange(n),n=this.options.changeFaceFun.imgToIco(n),n=this.options.changeFaceFun.icoToImg(n),c=c.replace(/\$name/g,d).replace(/\$content/g,n).replace(/\$msgid/g,i).replace(/\$msgResend/g,"visitor"==a?this.options.resendStr+this.options.callbackStr:""),0!=s&&s){o||(o=(new Date).getTime());var p=this.options.timeStr.replace(/\$1/g,new Date(o).Format("yyyy-MM-dd hh:mm:ss"));t(this.options.historyEle).prepend(c),t(this.options.historyEle).prepend(p)}else{o||(o=(new Date).getTime());var p=this.options.timeStr.replace(/\$1/g,new Date(o).Format("hh:mm:ss"));t(this.options.msgEle).append(p),t(this.options.msgEle).append(c)}this.options.msgFun(e)}},messageChange:function(e){var i=e;try{if(i=JSON.parse(t("<div>"+e+"</div>").text()),"news"==i.msgType){var o={title:i.articles[0].title,summary:i.articles[0].summary,url:i.articles[0].url,img:i.articles[0].picUrl};i='<div class="message_news" data-url="'+o.url+'" ><div class="title">'+o.title+'</div><div class="content"><div class="summary">'+o.summary+'</div><div class="img"><img src="'+o.img+'"/></div></div></div>'}else if("IDCard"==i.type){var o={title:i.nickname,summary:i.summaryStr,url:i.detailURL,img:i.headURL?i.headURL:"./bootstrapUI/any800/images/client.png"};i='<div class="message_news IDCard" data-url="'+o.url+'" ><div class="img"><img src="'+o.img+'"/></div><div class="content"><div class="title">'+o.title+'</div><div class="summary">'+o.summary+"</div></div></div>"}else if("knowledgeCard"==i.type){var o={title:i.title,summary:i.description,url:i.url,img:i.coverUrl?i.coverUrl:"./bootstrapUI/any800/images/client.png"};i='<div class="message_news knowledgeCard" data-url="'+o.url+'" ><div class="content"><div class="title">'+o.title+'</div><div class="summary">'+o.summary+'</div><div class="img"><img src="'+o.img+'"/></div></div></div>'}else i=e}catch(n){}return i},showSysMsg:function(e,t){e&&"undefined"!=e&&"null"!=e&&this.options.showSysMsgFun(e,t)},start:function(){var t=this;t.setAttr("islive",!0),t.options.storage.set("browserId",t.options.browserId),t.options.webSocket&&t.options.webSocket.isWork?t.prevTextInterval=e.setInterval(function(){t.preVstText()},2e3):(t.startReadMessageTimeout(),clearInterval(t.prevTextInterval),clearInterval(t.readMessageInterval),t.readMessageInterval=e.setInterval(function(){(new Date).getTime()-t.time>1e4&&t.startReadMessageTimeout()},1e4),t.prevTextInterval=e.setInterval(function(){t.preVstText()},2e3)),t.toolFun(!0),t.options.startChat()},startReadMessageTimeout:function(){var t=this;t.time=(new Date).getTime(),t.readMessageTimeout&&clearTimeout(t.readMessageTimeout),t.readMessageTimeout=e.setTimeout(function(){t.readMessage()},1e3)},end:function(e){var t=this;t.islive()&&(t.setAttr("islive",!1),t.options.webSocket&&t.options.webSocket.isWork||(t.readMessageTimeout&&clearTimeout(t.readMessageTimeout),t.readMessageTimeout=null,clearInterval(t.readMessageInterval),t.readMessageInterval=null,clearInterval(t.prevTextInterval),t.prevTextInterval=null),t.toolFun(!1),"number"==typeof e&&(t.options.storage.set("browserId",""),t.showSysMsg(this.options.closeStrList[e],!0),t.options.endChat()),t.options.endChatFun())},readMessage:function(){var e=this,i=e.options.detectWeb;e.getAttr("remoteUrl")&&t.ajax({type:"POST",url:"./echat.do",dataType:"json",async:!1,cache:!1,data:{method:"readMessage",chatID:e.options.chatId,url:e.getAttr("remoteUrl")}}).done(function(t){e.startReadMessageTimeout();try{i.getIsInitiate()&&e.showSysMsg(e.options.msgList.reconnectSuc),e.messageDeal(t),i.getIsInitiate()&&(e.toolFun(!0),i.checkedSuccess())}catch(o){}}).fail(function(t){e.startReadMessageTimeout(),i.getIsInitiate()||(e.toolFun(!1),e.showSysMsg(e.options.msgList.reconnectFail),i.checkedFail())})},messageDeal:function(e){var t=this,i=t.options.detectWeb;if(e&&e.root){if(0==e.root.length)return!1;for(var o=0;o<e.root.length;o++){var n=e.root[o].type.text;if("200"==n){if(e.root[o].from&&""!=e.root[o].date)if(e.root[o].langType>0&&e.root[o].langKey>0);else{var a=JSON.parse(e.root[o].text);t.addDiaList(a.messageId,(new Date).getTime(),a.content,0,"client"),"object"==typeof a.content&&(a.content=JSON.stringify(a.content)),a.content=a.content.replace(/\n/gi,"<br>"),t.showMsg({msgid:a.messageId,date:(new Date).getTime(),content:a.content,from:"client",status:0}),t.options.specialFun("200",{msgid:a.messageId,content:a.content,time:(new Date).getTime()}),i.msgPush("customer",a.content)}}else if("700"==n)t.options.specialFun("700",e.root[o]);else if("900"==n)i.getIsInitiate()?t.end(6):t.end(2),t.options.specialFun("900","");else if("901"==n)t.end(3),t.options.specialFun("901","");else if("110"==n)t.end(7),t.options.specialFun("110","");else if("111"==n){if(t.toolFun(!0),t.showMsg({msgid:"",date:(new Date).getTime(),content:JSON.parse(e.root[o].text).content,from:"client",status:0,saveIn:1}),i.getIsReconnection()){var s="["+i.getMsgs(5).join(",")+"]";t.sendMessage(s,"offLineMessage")}t.options.specialFun("111",e.root[o])}else"112"==n?(t.showMsg({msgid:"",date:(new Date).getTime(),content:JSON.parse(e.root[o].text).content,from:"client",status:0}),t.end(0),t.options.specialFun("112",e.root[o])):"113"==n?t.options.specialFun("113",e.root[o].text):"114"==n?t.options.specialFun("114",e.root[o].text):"902"==n&&t.islive()&&(t.options.specialFun("902",e.root[o].text),t.end(2))}}},addDiaList:function(e,t,i,o,n){return e||(e="Other"+(new Date).getTime(),this.diaCount++),this.diaList[e]={time:t,from:n,content:i,status:o,isReceived:"client"==n?1:0,receivedTime:0},e},getReceived:function(){var e=this,i=this.diaList,o=[];for(var n in i)0==i[n].isReceived&&o.push(n);for(var a in o)isNaN(Number(a))||t.ajax({type:"post",url:"echat.do?method=getReceivedMID",async:!1,data:{messageId:e.msgPair[o[a]],workGroupName:this.getAttr("_workGroupName")},dataType:"json",success:function(t){e.options.getReceivedFun(o[a]),e.diaList[o[a]].isReceived=1,e.options.confirmSend(o[a]),t.success||(e.diaList[o[a]].receivedTime>=e.options.limitReceiveTime?e.diaList[o[a]].isReceived=2:e.diaList[o[a]].receivedTime++)}})},preVstText:function(){var e=(this.lastSend,t(this.options.textEle).text().replace(/\s+/g,""));this.lastSend!=e&&(this.lastSend=e,e?this.sendMessage(e,"foreknowledge"):this.sendMessage(" ","foreknowledge"))},sendMessage:function(e,i,o){var n=this;"acceptRq"==i&&(this.isSpeech=!0),"offLineMessage"==i||"send_file"!=i||(i=""),e=e.replace(/<a/g,"<a target='_blank'");var a=n.addDiaList("",(new Date).getTime(),e,0,"visitor"),s=(new Date).getTime();return i||o||(n.showMsg({msgid:a,date:s,content:e,from:"visitor",status:0}),n.options.sendMessageFun(a,e)),n.options.webSocket&&n.options.webSocket.isWork&&!i?void n.options.webSocket.send({date:s,message:e,chatID:n.options.chatId}):void t.ajax({type:"POST",url:"./echat.do",dataType:"json",async:!1,cache:!1,data:{method:"sendMessage",
chatID:n.options.chatId,message:e,code:i?i:"",url:n.getAttr("remoteUrl"),visitorId:n.options.visitorId}}).done(function(e){if(1==e.success){var t=e.messageId;"back"==e.message?n.options.confirmSend(t):n.options.confirmSend(t,"add"),n.msgPair[a]=t,n.callbackFun(a,t)}})},callbackFun:function(e,i){var o=this;setTimeout(function(){o.diaList[e].isReceived||t("[name="+e+"] .msg_").html(o.options.callbackStr)},6e4)},toolFun:function(e){e?this.options.openTool():this.options.closeTool()}},t.dialogue=function(e){var t=new o(e);return t}}(window,jQuery),function(e,t,i){var o=function(e){this.defaults={detectWeb:function(){}},this.options=t.extend({},this.defaults,e)};o.prototype={beatInterval:null,beatTimeout:null,json:{},init:function(e){},startBeatTimeout:function(e){},end:function(){}},t.heartBeat=function(e){var t=new o(e);return t}}(window,jQuery),function(e,t,i){var o=function(e){this.defaults={dialogue:null,companyPk:"",langPk:"",chatId:"",title:"满意度调查",top:"您对本次服务满意吗？",bottom:"<div class='bottom'><div class='cancel'>取消</div><div class='submit'>确定</div></div>",generate:function(){}},this.options=t.extend({},this.defaults,e)};o.prototype={hasSat:!1,init:function(){var e=this;t.ajax({type:"POST",url:"./echatManager.do",dataType:"json",async:!1,data:{method:"getSatisfaction",companyPk:e.options.companyPk,langPk:e.options.langPk,chatID:e.options.chatId}}).done(function(t){t&&(e.hasSat=!0,e.createView(t))})},check:function(e){},cancel:function(){this.options.dialogue.sendMessage("访客取消了满意度评价","cancelSatisfaction"),this.hide()},createView:function(e){t(".satisfactionView").length>0&&t(".satisfactionView").remove();var i="<div class='satisfactionView view'><div class='board'></div></div>",o="<div class='fr' data-pk='$1' data-parent='$2' data-name='$3'></div>",n="<div class='sr' data-pk='$1' data-parent='$2' data-name='$3'></div>";t("body").append(i);var a="<div class='title'>"+this.options.title+"<span class='cross'><img src='./style/css/images/shut.png'></span></div>";a+="<div class='body'><div class='top'>"+this.options.top+"</div>";for(var s=0,r=e.length;s<r;s++){var c=e[s];if(a+=o.replace(/\$1/g,c.pk).replace(/\$2/g,c.parentPk).replace(/\$3/g,c.name),c.children.length>0)for(var l=0,d=c.children.length;l<d;l++){var u=c.children[l];a+=n.replace(/\$1/g,u.pk).replace(/\$2/g,u.parentPk).replace(/\$3/g,u.name)}}a+="<div class='mome'><textarea placeholder='请输入详情'></textarea></div></div>",a+=this.options.bottom,t(".satisfactionView .board").html(a),this.hide(),this.options.generate()},getElement:function(e){return t(".satisfactionView .board [data-pk='"+e+"']")},getElementByParent:function(e){return t(".satisfactionView .board [data-parent='"+e+"']")},submit:function(e){var i=this,o=this.options.dialogue;t.ajax({type:"POST",url:"./echatManager.do",dataType:"json",data:{method:"saveSatisfaction",companyPk:i.options.companyPk,chatID:i.options.chatId,satisfactionPk:e.satisfactionPk,optionPk:e.optionPk,satisfactionMemo:e.satisfactionMemo,nextSatisfactionPk:e.nextSatisfactionPk,rndVar:(new Date).getTime()}}).done(function(){var t=i.getElement(e.optionPk).attr("data-name"),n="，原因为：",a="";if(e.nextSatisfactionPk){var s=e.nextSatisfactionPk.split(",");for(var r in s)s[r]&&i.getElement(s[r]).attr("data-name")&&(a+=i.getElement(s[r]).attr("data-name")+",")}a.lastIndexOf(",")==a.length-1&&(a=a.substring(0,a.length-1)),a&&(a=n+a);var c="访客给您的满意度评价是："+t+a;o.sendMessage(c,"",!0),o.showSysMsg("您给客服"+o.getAttr("operatorName")+"的评价："+t+a)}),this.hide()},show:function(){this.hasSat&&(t(".satisfactionView").show(),t(".satisfactionView .board").css({marginTop:"-220px"}),t(".satisfactionView textarea").focus().blur(),t(".satisfactionView input,.satisfactionView textarea").not(".hasplaceholder").placeholder())},hide:function(){t(".satisfactionView").hide()}},t.satisfaction=function(e){var t=new o(e);return t}}(window,jQuery),function(e,t,i){function o(e,t){return function(i,o){return t?~~(i[e]<o[e]):~~(i[e]>o[e])}}var n=function(e){this.defaults={Alert:null,messageDisplay:[],messageContent:"",messageTypeList:[],warn:".warn",title:"请留言",bottom:"<div class='bottom'><div class='cancel'>取消</div><div class='submit'>确定</div></div>",generate:function(e){},reset:function(e){},warn:function(e,t){}},this.options=t.extend({},this.defaults,e)},a=function(e,t){for(var i=e,t=t||function(e,t){return t>e},o=1,n=i.length;o<n;o++){for(var a=i[o],s=o-1;s>=0&&t(i[s],a);)i[s+1]=i[s],s--;i[s+1]=a}return i};n.prototype={hasCreate:!1,init:function(){var e=this;e.options.messageDisplay.length>0&&(e.options.messageDisplay=a(e.options.messageDisplay,o("sort",!1)),e.createView(),e.hasCreate=!0)},check:function(e){var i=this;t(".leaveMessageView .col").removeClass("warn");var o=!0;return t(".leaveMessageView .col").each(function(n,a){var s=t(this);if(0!=o&&(!e||s.data("displayname")==e)){if("company"==s.data("displayname")){if(1==s.data("require")&&""==s.find("input").val())return i.options.warn(s,"公司名称不能为空"),s.addClass("warn"),void(o=!1);if(s.find("input").val().length>30)return i.options.warn(s,"公司名称最大长度为30字符"),s.addClass("warn"),void(o=!1)}if("name"==s.data("displayname")){if(1==s.data("require")&&""==s.find("input").val())return i.options.warn(s,"姓名不能为空"),s.addClass("warn"),void(o=!1);if(s.find("input").val().length>20)return i.options.warn(s,"姓名最大长度为20字符"),s.addClass("warn"),void(o=!1)}if("telephone"==s.data("displayname")){if(1==s.data("require")&&""==s.find("input").val())return i.options.warn(s,"电话不能为空"),s.addClass("warn"),void(o=!1);if(""==s.find("input").val())return;var r=new RegExp(/^[1][0-9]{1}[0-9]{9}$/);if(!r.test(s.find("input").val()))return i.options.warn(s,"请填写正确的电话"),s.addClass("warn"),void(o=!1)}if("email"==s.data("displayname")){if(1==s.data("require")&&""==s.find("input").val())return i.options.warn(s,"电子邮件不能为空"),s.addClass("warn"),void(o=!1);if(""==s.find("input").val())return;var c=new RegExp(/^[\-\._A-Za-z0-9]+@([_A-Za-z0-9\-]+\.)+[A-Za-z0-9]{2,3}$/);if(!c.test(s.find("input").val()))return i.options.warn(s,"请填写正确的电子邮件"),s.addClass("warn"),void(o=!1);if(s.find("input").val().length>50)return i.options.warn(s,"电子邮件最大长度为50字符"),s.addClass("warn"),void(o=!1)}if("title"==s.data("displayname")){if(1==s.data("require")&&""==s.find("input").val())return i.options.warn(s,"主题不能为空"),s.addClass("warn"),void(o=!1);if(s.find("input").val().length>50)return i.options.warn(s,"主题最大长度为50字符"),s.addClass("warn"),void(o=!1)}if("content"==s.data("displayname")){if(1==s.data("require")&&""==s.find("textarea").val())return i.options.warn(s,"内容不能为空"),s.addClass("warn"),void(o=!1);if(s.find("textarea").val().length>1e3)return i.options.warn(s,"内容最大长度为1000字符"),s.addClass("warn"),void(o=!1)}}}),o},cancel:function(){this.hide()},createView:function(){var e=this;t(".leaveMessageView").length>0&&t(".leaveMessageView").remove();var i="<div class='leaveMessageView view'><div class='board'></div></div>";t("body").append(i);var o="<div class='title'>"+e.options.title+"<span class='cross'><img src='./style/css/images/shut.png'></span></div>";o+="<div class='body'>",e.options.messageContent&&(o+="<div class='top'>"+e.options.messageContent+"</div>");var n="<div class='col' data-type='$0' data-require='$1' data-name='$2' data-markedwords='$3' data-displayname='$4' ></div>";for(var a in e.options.messageDisplay){var s=e.options.messageDisplay[a];1==s.display&&"messageTypePk"==s.displayName&&(o+=n.replace(/\$0/g,s.judgeDisplay).replace(/\$1/g,s.required).replace(/\$2/g,s.name).replace(/\$3/g,s.markedWords).replace(/\$4/g,s.displayName))}for(var a in e.options.messageDisplay){var s=e.options.messageDisplay[a];1==s.display&&"messageTypePk"!=s.displayName&&(o+=n.replace(/\$0/g,s.judgeDisplay).replace(/\$1/g,s.required).replace(/\$2/g,s.name).replace(/\$3/g,s.markedWords).replace(/\$4/g,s.displayName))}o+="</div>",o+=this.options.bottom,t(".leaveMessageView .board").html(o),this.hide(),this.options.generate(e.options.messageTypeList)},submit:function(e){var i=this,o=i.options.Alert;if(!i.check())return!1;if(!e.messageTypePk)return i.options.warn(t(".leaveMessageView [data-displayname='messageTypePk']"),"请选择留言分类"),t(".leaveMessageView [data-displayname='messageTypePk']").addClass("warn"),void(can=!1);var n=e.content;try{n=encodeURIComponent(encodeURIComponent(n))}catch(a){}t.ajax({type:"POST",url:"./echatManager.do",dataType:"json",data:{method:"saveMessageBox",messageTypePk:e.messageTypePk,companyPk:i.options.companyPk,name:e.name,telephone:e.telephone,email:e.email,title:e.title,content:e.content,company:e.company,brand:e.brand,contentencode:n}}).done(function(e){1==e.success?(o.show(e.msg),i.reset(),i.hide()):o.show(e.msg)}),i.hide()},reset:function(e){this.options.reset},show:function(){this.hasCreate&&(t(".leaveMessageView").show(),t(".leaveMessageView .board").css({marginTop:-t(".leaveMessageView .board").height()/2}),t(".leaveMessageView input,.leaveMessageView textarea").not(".hasplaceholder").placeholder())},hide:function(){t(".leaveMessageView").hide()}},t.leaveMessage=function(e){var t=new n(e);return t.init(),t}}(window,jQuery),function(e,t,i){var o=function(e){this.defaults={storage:null,Alert:null,title:"请填写以下信息",storageVisitor:"visitor",bottom:"<div class='bottom'><div class='cancel'>取消</div><div class='submit'>确定</div></div>",generate:function(e){},warn:function(e,t){},submitFun:function(){},cancelFun:function(){}},this.options=t.extend({},this.defaults,e)};o.prototype={hasCreate:!1,visitor:{visitorId:"",company:"",visitorName:"",sex:"0",degree:"",realName:"",phone:"",mobile:"",email:"",QQ:"",MSN:"",address:"",extension:"",memberId:""},init:function(){var e=this,t=e.options.storage;t.get(e.options.storageVisitor)&&(e.visitor=t.get(e.options.storageVisitor)),e.createView(),e.hasCreate=!0},check:function(){var e=this;t(".visitorInformationView .col").removeClass("warn");var i=!0;return t(".visitorInformationView .col").each(function(o,n){var a=t(this);if(0!=i){if("visitorName"==a.data("displayname")){var s=new RegExp(/^[a-zA-Z0-9\u4e00-\u9fa5]+(\s[a-zA-Z0-9\u4e00-\u9fa5]+|)$/);if(1==a.data("require")&&""==a.find("input").val())return e.options.warn(a,"昵称不能为空"),a.addClass("warn"),void(i=!1);if(a.find("input").val().length>20)return e.options.warn(a,"昵称最大长度为20字符"),a.addClass("warn"),void(i=!1);if(!s.test(a.find("input").val()))return e.options.warn(a,"请输入中文、英文和数字！"),a.addClass("warn"),void(i=!1)}if("realName"==a.data("displayname")&&a.find("input").val().length>20)return e.options.warn(a,"姓名最大长度为20字符"),a.addClass("warn"),void(i=!1);if("phone"==a.data("displayname")){if(""==a.find("input").val())return;var r=new RegExp(/^[1][0-9]{1}[0-9]{9}$/);if(!r.test(a.find("input").val()))return e.options.warn(a,"请填写正确的手机号码"),a.addClass("warn"),void(i=!1)}if("phone"==a.data("displayname")){if(""==a.find("input").val())return;var r=new RegExp(/^[1][0-9]{1}[0-9]{9}$/);if(!r.test(a.find("input").val()))return e.options.warn(a,"请填写正确的手机号码"),a.addClass("warn"),void(i=!1)}if("QQ"==a.data("displayname")&&a.find("input").val().length>20)return e.options.warn(a,"QQ最大长度为20字符"),a.addClass("warn"),void(i=!1);if("email"==a.data("displayname")){if(""==a.find("input").val())return;var s=new RegExp(/^[\-\._A-Za-z0-9]+@([_A-Za-z0-9\-]+\.)+[A-Za-z0-9]{2,3}$/);if(!s.test(a.find("input").val()))return e.options.warn(a,"请填写正确的邮箱"),a.addClass("warn"),void(i=!1);if(a.find("input").val().length>50)return e.options.warn(a,"邮箱最大长度为50字符"),a.addClass("warn"),void(i=!1)}return"address"==a.data("displayname")&&a.find("input").val().length>50?(e.options.warn(a,"地址最大长度为50字符"),a.addClass("warn"),void(i=!1)):"company"==a.data("displayname")&&a.find("input").val().length>50?(e.options.warn(a,"公司名称最大长度为50字符"),a.addClass("warn"),void(i=!1)):void 0}}),i},cancel:function(){this.options.cancelFun(),this.hide()},createView:function(){var e=this;t(".visitorInformationView").length>0&&t(".visitorInformationView").remove();var i="<div class='visitorInformationView view'><div class='board'></div></div>";t("body").append(i);var o="<div class='title'>"+e.options.title+"<span class='cross'><img src='./style/css/images/shut.png'></span></div>";o+="<div class='body'>",o+="<div class='col' data-type='input' data-require='1' data-name='昵称' data-placeholder='请输入昵称' data-displayname='visitorName' ></div>",o+="<div class='col' data-type='radio' data-require='0' data-name='性别'  data-markedwords='"+(e.visitor.sex?e.visitor.sex:"")+"' data-displayname='sex' ></div>",o+="<div class='col' data-type='input' data-require='0' data-name='姓名' data-placeholder='请输入姓名' data-markedwords='"+(e.visitor.realName?e.visitor.realName:"")+"' data-displayname='realName' ></div>",o+="<div class='col' data-type='input' data-require='0' data-name='手机' data-placeholder='请输入手机号码' data-markedwords='"+(e.visitor.phone?e.visitor.phone:"")+"' data-displayname='phone' ></div>",o+="<div class='col' data-type='input' data-require='0' data-name='QQ' data-placeholder='请输入QQ号码' data-markedwords='"+(e.visitor.QQ?e.visitor.QQ:"")+"' data-displayname='QQ' ></div>",o+="<div class='col' data-type='input' data-require='0' data-name='邮箱' data-placeholder='请输入邮箱地址' data-markedwords='"+(e.visitor.email?e.visitor.email:"")+"' data-displayname='email' ></div>",o+="<div class='col' data-type='input' data-require='0' data-name='地址' data-placeholder='请输入地址' data-markedwords='"+(e.visitor.address?e.visitor.address:"")+"' data-displayname='address' ></div>",o+="<div class='col' data-type='input' data-require='0' data-name='公司' data-placeholder='请输入公司名称' data-markedwords='"+(e.visitor.company?e.visitor.company:"")+"' data-displayname='company' ></div>",o+="</div>",o+=this.options.bottom,t(".visitorInformationView .board").html(o),this.hide(),this.options.generate()},submit:function(e){var i=this,o=i.options.storage;if(i.check()){var n=o.get(i.options.storageVisitor);n=t.extend({},n,e),o.set(i.options.storageVisitor,n),i.visitor=n,o.set("isSave",0),i.options.submitFun(i.visitor),i.hide()}},show:function(){this.hasCreate&&(t(".visitorInformationView").show(),t(".visitorInformationView .board").css({marginTop:-t(".visitorInformationView .board").height()/2}))},hide:function(){t(".visitorInformationView").hide()}},t.visitorInformation=function(e){var t=new o(e);return t.init(),t}}(window,jQuery),function(e,t,i){var o=function(e){this.defaults={show:!0,visitorId:"",companyPk:"",leavePre:"离线消息:",maxDia:5,dialogue:null,generation:function(){},checkFun:function(e){}},this.options=t.extend({},this.defaults,e)};o.prototype={page:1,historyDias:[],leaveDias:[],over:!1,cur:1,num:0,more:!0,showHistoryDia:function(){if(0!=this.options.show){var e=this,t=this.options.dialogue;for(var i in e.historyDias)if(!isNaN(Number(i)))for(var o in e.historyDias[i].content.dia)if(!isNaN(Number(i))){var n=e.historyDias[i].content.dia[o];!n.hasShown&&n.num<e.cur*e.options.maxDia&&(e.historyDias[i].content.dia[o].hasShown=!0,t.showMsg({date:Number(new Date(n.time.replace(/-/g,"/")).getTime()),from:n.from,content:n.content,status:1}))}}},showLeaveChat:function(e){var t=this,i=this.options.dialogue;for(var o in t.leaveDias)isNaN(Number(o))||i.showMsg({from:t.leaveDias[o].from,content:t.leaveDias[o].content,status:1,date:t.leaveDias[o].date})},init:function(){this.options.generation()},check:function(e){this.getSum()<this.cur*this.options.maxDia+1&&!this.over?(this.getHistoryDialogue(),this.check()):(this.showHistoryDia(),this.cur++),this.more=!this.over||!(this.getSum()<this.cur*this.options.maxDia+1),this.options.checkFun()},changeToContent:function(e){for(var i=this,o=0,n=[],a=t("<div>"+e+"</div>").find(".sevice_chat,.me_chat,.robot_chat"),s=a.length-1;s>=0;s--)0==t(a[s]).find(".msg_back_success").length&&(n.push({from:"sevice_chat"==a[s].className?"client":"robot_chat"==a[s].className?"robot":"visitor",content:t(a[s]).find("content").html(),hasShown:!1,num:i.num,time:t(a[s]).find("time").html()}),i.num++,o++);return{sum:o,dia:n}},getSum:function(){var e=this,t=0;for(var i in e.historyDias)isNaN(Number(i))||(t+=e.historyDias[i].content.sum);return t},getHistoryDialogue:function(){var e=this;t.ajax({url:"./historyOperator.do",type:"POST",async:!1,dataType:"json",data:{method:"getHistoryDialogue",page:e.page,visitorId:e.options.visitorId,companyPk:e.options.companyPk}}).done(function(t){if(!t||0==t.length)return void(e.over=!0);for(var i in t)if(!isNaN(Number(i))){var o=e.changeToContent(t[i].content,t[i].from);e.historyDias.push({time:new Date(t[i].leaveTime.replace(/-/g,"/")).getTime(),content:o})}e.page++}).fail(function(){e.over=!0})},getLeaveChat:function(){var e=this;t.ajax({type:"post",async:!1,url:"historyOperator.do",dataType:"json",data:{method:"getLeaveChat",visitorId:e.options.visitorId}}).done(function(t){if(0!=t.length){t=t.reverse();for(var i in t)if(!isNaN(Number(i))){var o=t[i].content;if("string"!=typeof o)try{o=JSON.stringify(o)}catch(n){}o=dialogue.messageChange(o),e.leaveDias.push({content:e.options.leavePre+""+o,from:"client"})}}})}},t.history=function(e){var t=new o(e);return t}}(window,jQuery),function(e,t,i){var o=function(e){this.defaults={visitorName:"",visitorId:"",ecselfList:null,langPk:"",dialogue:null,robotSetting:2,companyPk:"",chatId:"",ywList:"ff80808150db355d0150e12f11a90388",confidence:60,changeToNormal:function(e){}},this.options=t.extend({},this.defaults,e)};o.prototype={isUse:!0,choose:!1,ncRobotTime:0,nc:{number:2,answer:"非常抱歉，不能回答你的问题。如需进一步咨询，请点击这里，转接人工客服。",questions:"投诉".split(";")},recored:[],click:!1,init:function(){var e=this;2==e.options.robotSetting&&(e.isUse=!1);var t=e.options.ecselfList;if(t)for(var i in t){var o=t[i];o.eclangPk&&o.eclangPk==e.options.langPk&&(e.nc={number:o.number||e.nc.number,answer:o.answer||e.nc.answer,questions:o.questions?o.questions.split(";"):""})}4==e.options.robotSetting&&(e.nc.answer=e.nc.answer.replace(e.clientJump,e.clientJumpReplace))},check:function(e){var t=this,i=t.options.dialogue;return!!t.isUse&&(e&&(i.showMsg({date:(new Date).getTime(),content:e,from:"visitor",status:0}),t.recored.push({date:(new Date).getTime(),content:e,from:"visitor",status:0})),3==t.options.robotSetting?t.iRobot(e):(1==t.options.robotSetting||4==t.options.robotSetting)&&t.options.ywList.indexOf(t.options.companyPk)>-1?t.ywRobot(e):4==t.options.robotSetting&&t.nc?t.umpRobot(e):1==t.options.robotSetting&&t.oldNcRobot(e),!0)},clientJump:"请点击这里",clientJumpReplace:'请点击<a style="color:blue;" class="robotResp">这里</a>',multipleRobot:function(e){if(e){var i=this,o=i.options.dialogue;t.ajax({type:"POST",url:"echatManager.do",data:{method:"getAnswer",companyPk:i.options.companyPk,visitorId:i.options.visitorId,chatId:i.options.chatId,channel:"web",question:e},dataType:"json"}).done(function(t){if(i.click=!1,t.response&&t.response.length>0){var n=t.response[0].content;if(t.suggestions&&t.suggestions.length>=1)for(var a=0,s=t.suggestions.length;a<s;a++)n+="<b/><div class='robotSuggsetion'>"+t.suggestions[a]+"</div>";o.showMsg({date:(new Date).getTime(),content:n,from:"robot"}),i.recored.push({date:(new Date).getTime(),content:n,from:"robot"})}else i.multipleFail(e)}).fail(function(){i.isUse&&(i.click=!1,i.multipleFail(e))})}},multipleFail:function(e){var t=robot.nc.questions.indexOf(e);return t==-1?(dialogue.showMsg({date:(new Date).getTime(),content:robot.nc.answer,from:"robot"}),void robot.recored.push({date:(new Date).getTime(),content:robot.nc.answer,from:"robot"})):void(robot.choose||(1==robot.choose,robot.cf||(robot.cf=confirm("不能查找到答案，是否需要转人工服务?"),1==robot.cf?(robot.options.changeToNormal(),robot.choose=!1):(robot.cf=null,dialogue.showMsg({date:(new Date).getTime(),content:robot.nc.answer,from:"robot"}),robot.recored.push({date:(new Date).getTime(),content:robot.nc.answer,from:"robot"}),robot.choose=!1))))},umpRobot:function(e){if(e){var i=this,o=i.options.dialogue;t.ajax({type:"POST",url:"echatManager.do",data:{method:"getAnswer",companyPk:i.options.companyPk,visitorId:i.options.visitorId,chatId:i.options.chatId,codeKey:ucc.codeKey,userName:i.options.visitorName,question:e},dataType:"json"}).done(function(n){if(i.click=!1,n.response){if(1==n.response.length)if(!n.response[0].type||"0"!=n.response[0].type&&"5"!=n.response[0].type){if(n.suggestions&&n.suggestions.length>=1){var a=n.response[0].content;if(n.response[0].content.indexOf("以上答案是否解决了您的问题：")>0&&n.response[0].content.indexOf('"]解决')>0&&n.response[0].content.indexOf("]未解决[/link]")>0){a=n.response[0].content.split("以上答案是否解决了您的问题：")[0],a="<b>"+a+"</b>";var s=n.response[0].content.split("以上答案是否解决了您的问题：")[1],r=new RegExp("\\[/link\\]","g"),c=new RegExp('"\\]未解决',"g"),l=new RegExp('"\\]解决',"g"),d=new RegExp("\\]","g"),u=new RegExp("\\d{0,3}.\\[link submit=","g"),m=new RegExp('\\[link submit="faqvote:',"g");faqVoteID++;var g="unsolved"+faqVoteID,p="solved"+faqVoteID,h="','0','"+faqVoteID+"')\" href='javascript:void(0);' id='"+g+"'>未解决",f="','1','"+faqVoteID+"')\" href='javascript:void(0);' id='"+p+"'>解决";s=s.replace(r,"</a> "),s=s.replace(m,"<a class = 'faqVoted' onClick=\"faqVoted('faqvote:"),s=s.replace(u,'<a onClick="exportMessage('),s=s.replace(c,h),s=s.replace(l,f),s=s.replace(d,")\" href='javascript:void(0);'>"),a=a+"以上答案是否解决了您的问题："+s}else a="<b>"+a+"</b>";if(n.suggestions&&n.suggestions.length>=1){a+="<br>您可能关注以下问题：<br>";for(var v=0,w=n.suggestions.length;v<w;v++)a+="<b/><div class='robotSuggsetion'>"+n.suggestions[v]+"</div>"}a=a.replace(/\r\n/g,"<br>");var b=/[link[^>]*url="([^"]*)"[^>]*]/g;if(null!=b.exec(a))a=a.replace(/\[link[^\]]*\]/g,"<a href='"+RegExp.$1+"'>").replace(/\[\/link\]/g,"</a>");else{for(var y=/[link[^>]*submit=['"]([\s\S]*?)['"]]([\s\S]*?)[\/link]/g,k=new Array,I=new Array;null!=y.exec(a);)k.push(RegExp.$1),I.push(RegExp.$2);a=a.replace(/\[link[^\]]*\]/g,"<a href='javascript:'  class='robotSuggsetion' style='text-decoration:none;'>").replace(/\[\/link\]/g,"</a>")}}else{var T="";if(n.response[0].content.indexOf("assetQuery")>0&&(T=JSON.parse(n.response[0].content)),""!=T&&"00"===T.assetQuery.code)var a="总资产："+T.assetQuery.model.sumAssets+"<br>银宝通："+T.assetQuery.model.lurpak+"<br>私募基金："+T.assetQuery.model.privatePlacement+"<br>公募基金："+T.assetQuery.model.publicPlacement+"<br>";else if(""!=T&&"99"===T.assetQuery.code)var a="查询无结果";else{var a=n.response[0].content;if(n.response[0].content.indexOf("以上答案是否解决了您的问题：")>0&&n.response[0].content.indexOf('"]解决')>0&&n.response[0].content.indexOf("]未解决[/link]")>0){a=n.response[0].content.split("以上答案是否解决了您的问题：")[0],a="<b>"+a+"</b>";var s=n.response[0].content.split("以上答案是否解决了您的问题：")[1],r=new RegExp("\\[/link\\]","g"),c=new RegExp('"\\]未解决',"g"),l=new RegExp('"\\]解决',"g"),d=new RegExp("\\]","g"),u=new RegExp("\\d{0,3}.\\[link submit=","g"),m=new RegExp('\\[link submit="faqvote:',"g");faqVoteID++;var g="unsolved"+faqVoteID,p="solved"+faqVoteID,h="','0','"+faqVoteID+"')\" href='javascript:void(0);' id='"+g+"'>未解决",f="','1','"+faqVoteID+"')\" href='javascript:void(0);' id='"+p+"'>解决";s=s.replace(r,"</a> "),s=s.replace(m,"<a class = 'faqVoted' onClick=\"faqVoted('faqvote:"),s=s.replace(u,'<a onClick="exportMessage('),s=s.replace(c,h),s=s.replace(l,f),s=s.replace(d,")\" href='javascript:void(0);'>"),a=a+"以上答案是否解决了您的问题："+s}a=a.replace(/\r\n/g,"<br>");var b=/[link[^>]*url="([^"]*)"[^>]*]/g;if(null!=b.exec(a))a=a.replace(/\[link[^\]]*\]/g,"<a href='"+RegExp.$1+"'>").replace(/\[\/link\]/g,"</a>");else{for(var y=/[link[^>]*submit=['"]([\s\S]*?)['"]]([\s\S]*?)[\/link]/g,k=new Array,I=new Array;null!=y.exec(a);)k.push(RegExp.$1),I.push(RegExp.$2);a=a.replace(/\[link[^\]]*\]/g,"<a href='javascript:'  class='robotSuggsetion' style='text-decoration:none;'>").replace(/\[\/link\]/g,"</a>")}}}if(n.response[0].content.indexOf("acs")!=-1&&n.response[0].type>100)return i.options.changeToNormal(),void clearInterval(i.iShowAutoTextInit);o.showMsg({date:(new Date).getTime(),content:a,from:"robot"}),t(".cssWriteMsg").click(function(){t(this).unbind();var e=t(this).html();return"转人工"==e?(i.options.changeToNormal(),void clearInterval(i.iShowAutoTextInit)):(t(".dialogue-area-write").html(e),t("#dialogue-footer-text").html(e),t("#autodiv").hide(),uccPcEvent.sendMsg(),void 0)}),i.recored.push({date:(new Date).getTime(),content:a,from:"robot"})}else{var a="您这个问题还真把我难住了，待我再去学习学习，下次见面再告诉您，您可以先咨询其他问题或点击<a  style='color:blue;' class='robotResp'>人工客服</a>哦";o.showMsg({date:(new Date).getTime(),content:a,from:"robot"}),t(".cssWriteMsg").click(function(){t(this).unbind();var e=t(this).html();return"转人工"==e?(i.options.changeToNormal(),void clearInterval(i.iShowAutoTextInit)):(t(".dialogue-area-write").html(e),t("#dialogue-footer-text").html(e),t("#autodiv").hide(),uccPcEvent.sendMsg(),void 0)}),i.recored.push({date:(new Date).getTime(),content:a,from:"robot"})}}else i.answerFail(e)}).fail(function(){i.isUse&&(i.click=!1,i.answerFail(e))})}},answerFail:function(e){if(robot.ncRobotTime++,robot.ncRobotTime>=robot.nc.number){if(robot.choose)return;1==robot.choose,robot.cf||(robot.cf=confirm("不能查找到答案，是否需要转人工服务?"),1==robot.cf?(robot.options.changeToNormal(),robot.choose=!1):(robot.cf=null,dialogue.showMsg({date:(new Date).getTime(),content:robot.nc.answer,from:"robot"}),robot.recored.push({date:(new Date).getTime(),content:robot.nc.answer,from:"robot"}),robot.choose=!1,robot.ncRobotTime=0))}else{var t=0;for(var i in robot.nc.questions){var o=robot.nc.questions[i];if(o==e){if(t=1,robot.choose)return;1==robot.choose,robot.cf||(robot.cf=confirm("不能查找到答案，是否需要转人工服务?"),1==robot.cf?(robot.choose=!1,robot.options.changeToNormal()):(robot.cf=null,t=0,robot.choose=!1,robot.ncRobotTime=0))}}0==t&&(dialogue.showMsg({date:(new Date).getTime(),content:robot.nc.answer,from:"robot"}),robot.recored.push({date:(new Date).getTime(),content:robot.nc.answer,from:"robot"}))}},iRobot:function(e){if(e){var i=this;t.ajax({url:"http://vdev.icontek.com:28080/queryj/x/ROOT->ucctest/"+i.options.companyPk+(new Date).getTime()+"/"+e}).done(function(e){var t="";e.confidence>=i.confidence&&e.answer&&(t+=e.answer.replace(/\+/g," ")+"<br />",i.options.dialogue.showMsg({date:(new Date).getTime(),content:t,from:"robot"}),i.recored.push({date:(new Date).getTime(),content:t,from:"robot"}));var o=confirm("不能查找到答案，是否需要转人工服务?");1==o&&i.options.changeToNormal()})}},cf:null,ncRobot:function(e){if(e){var i=this,o=i.options.dialogue;t.ajax({type:"POST",url:"echatManager.do?method=automaticResponse",data:{companyPk:i.options.companyPk,question:e,chatId:i.options.chatId,visitorName:i.options.visitorName,langPk:i.options.langPk,"true":i.click},dataType:"json"}).done(function(t){if(i.isUse)if(i.click=!1,1==t.reply)i.ncRobotTime=0,o.showMsg({date:(new Date).getTime(),content:t.answer,from:"robot"}),i.recored.push({date:(new Date).getTime(),content:t.answer,from:"robot"});else if(i.ncRobotTime++,i.ncRobotTime>=i.nc.number){if(i.choose)return;1==i.choose,i.cf||(i.cf=confirm("不能查找到答案，是否需要转人工服务?"),1==i.cf?(i.options.changeToNormal(),i.choose=!1):(i.cf=null,o.showMsg({date:(new Date).getTime(),content:i.nc.answer,from:"robot"}),i.recored.push({date:(new Date).getTime(),content:i.nc.answer,from:"robot"}),i.choose=!1,i.ncRobotTime=0))}else{var n=0;for(var a in i.nc.questions){var s=i.nc.questions[a];if(s==e){if(n=1,i.choose)return;1==i.choose,i.cf||(i.cf=confirm("不能查找到答案，是否需要转人工服务?"),1==i.cf?(i.choose=!1,i.options.changeToNormal()):(i.cf=null,n=0,i.choose=!1,i.ncRobotTime=0))}}0==n&&(o.showMsg({date:(new Date).getTime(),content:i.nc.answer,from:"robot"}),i.recored.push({date:(new Date).getTime(),content:i.nc.answer,from:"robot"}))}}).fail(function(){if(i.isUse)if(i.click=!1,i.ncRobotTime++,i.ncRobotTime>=i.nc.number){if(i.choose)return;1==i.choose,i.cf||(i.cf=confirm("不能查找到答案，是否需要转人工服务?"),1==i.cf?(i.choose=!1,i.options.changeToNormal()):(i.cf=null,o.showMsg({date:(new Date).getTime(),content:i.nc.answer,from:"robot"}),i.recored.push({date:(new Date).getTime(),content:i.nc.answer,from:"robot"}),i.choose=!1,i.ncRobotTime=0))}else{var t=0;for(var n in i.nc.questions){var a=i.nc.questions[n];if(a==e){if(t=1,i.choose)return;1==i.choose,i.cf||(i.cf=confirm("不能查找到答案，是否需要转人工服务?"),1==i.cf?(i.choose=!1,i.options.changeToNormal()):(i.cf=null,t=0,i.choose=!1,i.ncRobotTime=0))}}0==t&&(o.showMsg({date:(new Date).getTime(),content:i.nc.answer,from:"robot"}),i.recored.push({date:(new Date).getTime(),content:i.nc.answer,from:"robot"}))}})}},ywRobot:function(e){if(e){var o=this,n=o.options.dialogue;t.ajax({type:"POST",url:"echatManager.do?method=loadSelfService2",data:{chatId:o.options.chatId,companyPk:o.options.companyPk,content:encodeURIComponent(e)},dataType:"json"}).done(function(e){var a="";e&&"Artificial customer service"!=e.answer&&null!=e.answer&&""!=e.answer&&e.answer!=i?(a=e.answer.replace(/\+/g," ")+"<br />",n.showMsg({date:(new Date).getTime(),content:a+"<br />单击<a href='javascript:' class='robo'><span style='color: red;'>转人工</span></a>进行提问。",from:"robot",status:0}),o.recored.push({date:(new Date).getTime(),content:a+"<br />单击<a href='javascript:' class='robo'><span style='color: red;'>转人工</span></a>进行提问。",from:"robot"})):(n.showMsg({date:(new Date).getTime(),content:"<div id='conId'>您好，我正在成长过程中，您的这个问题可能已经超出了我目前的知识范围。单击<a href='javascript:' class='robo'><span style='color: red;'>转人工</span></a>进行提问。</div>",from:"robot",status:0}),o.recored.push({date:(new Date).getTime(),content:"<div id='conId'>您好，我正在成长过程中，您的这个问题可能已经超出了我目前的知识范围。单击<a href='javascript:' class='robo'><span style='color: red;'>转人工</span></a>进行提问。</div>",from:"robot"})),t(".robo").click(function(){o.options.changeToNormal()})})}},oldNcRobot:function(e){if(e){var i=this,o=i.options.dialogue,n="";t.ajax({type:"POST",url:"echatManager.do?method=loadSelfService",data:{chatId:i.options.chatId,companyPk:i.options.companyPk,content:encodeURIComponent(e)},dataType:"json"}).done(function(e){if(e&&e.length>1)t.each(e,function(t){n+=e[t].text.replace(/\+/g," ")+"<br />"}),o.showMsg({msgid:"",date:(new Date).getTime(),content:n,from:"client",status:0});else if(e&&1==e.length)n+="<div>"+e[0].text.replace(/\+/g," ")+"</div>",o.showMsg({msgid:"",date:(new Date).getTime(),content:n,from:"client",status:0});else{var a=confirm("不能查找到答案，是否需要转人工服务?");1==a?i.options.changeToNormal():i.ncRobotTime=0}})}}},t.robot=function(e){var t=new o(e);return t.recored=[],t.init(),t}}(window,jQuery),function(e,t,i){var o=function(e){this.defaults={companyPk:"",defaultLangPk:"",langMap:{},show:function(e){}},this.options=t.extend({},this.defaults,e)};o.prototype={type:{system:1,operator:2},key:{welcome_1:1,welcome_2:2,chat_ad:3,cs_busy:4,no_answer_close:5,no_answer_hint:6,dialog_start:7},langMap:{},init:function(){var e=this;return"{}"!=JSON.stringify(e.options.langMap)?void(e.langMap=e.options.langMap):void t.ajax({type:"POST",url:"echatManager.do?method=getLangList",async:!1,data:{companyPk:e.options.companyPk,langPk:e.options.defaultLangPk},dataType:"json"}).done(function(t){t&&(e.langMap=t)})},show:function(e,i){var o=this;1==e?o.langMap&&o.langMap[i]&&o.options.show(o.langMap[i]):t.ajax({type:"POST",url:"echatManager.do?method=getLangListByPk",async:!1,data:{companyPk:o.options.companyPk,langPk:o.options.defaultLangPk,langType:e,langKey:i},dataType:"json"}).done(function(e){e&&o.options.show(e)})}},t.langTip=function(e){var t=new o(e);return t.init(),t}}(window,jQuery),function(e,t,i){var o=function(e){this.defaults={open:"1",storage:null,time:6e4,num:5,blockTime:5e3,url:"./overLoad.jsp"},this.options=t.extend({},this.defaults,e)};o.prototype={init:function(){if("0"!=this.options.open){var t=this,i=this.options.storage,o=i.get("vLimit"),n=i.get("isLimit"),a=[],s=(new Date).getTime();if(o){if("islimited"==n&&s-o[o.length-1].time<=t.options.blockTime)return void(e.location.href=t.options.url);"islimited"==n&&(o=[]),i.set("isLimit","");for(var r in o)s-o[r].time<t.options.time&&a.push({time:o[r].time});if(a.push({time:s}),i.set("vLimit",a),a.length>t.options.num)return i.set("isLimit","islimited"),void(e.location.href=t.options.url)}else a.push({time:s}),i.set("vLimit",a)}}},t.visitLimit=function(e){var t=new o(e);return t}}(window,jQuery),function(e,t,i){var o=function(e){this.defaults={},this.options=t.extend({},this.defaults,e)};o.prototype={allDB:{},id:0,db:{},add:function(e){var t=this,i={msgId:e.msgId?e.msgId:"",type:e.type,
content:e.content,time:e.date?e.date:(new Date).getTime(),isRevoke:!!e.isRevoke&&e.isRevoke,hasChecked:!!e.hasChecked&&e.hasChecked,status:e.status?e.status:0,saveIn:e.saveIn?e.saveIn:0,received:0,checkSend:0};t.db[t.id]=i,t.allDB[t.id]=i,t.id++},clear:function(){var e=this;e.db={}},last:function(){var e=this,t=0;for(var i in e.db)!isNaN(Number(i))&&Number(t)<=Number(i)&&(t=i);return t},setKey:function(e,t,i){var o=this;for(var n in o.db)e==n&&(o.db[n][t]=i,o.allDB[n][t]=i)},set:function(e,t,i){var o=this;for(var n in o.db)o.db[n].msgId==e&&(o.db[n][t]=i,o.allDB[n][t]=i)},get:function(e){var t=this;for(var i in t.db)if(t.db[i].msgId==e)return t.db[i]},getAll:function(){return this.db}},t.msgdb=function(e){var t=new o(e);return t}}(window,jQuery),function(e,t,i){var o=function(e){this.defaults={userDatas:null,storage:null},this.options=t.extend({},this.defaults,e)};o.prototype={init:function(e){var i=nowtime.getTime(),o=this,n=o.options.storage,a=n.get("ncVisitor")?n.get("ncVisitor"):{},s=o.getTrace(),r=s.result,c=o.getInfo();n.set("visitorId",c.visitorId),n.set("visitorName",c.visitorName),c=o.changeFirstTime(c,r),a.trace=r,a.info=c,n.set("ncVisitor",a);var l=c;i-c.lastTime>6e5||!s.hasVal?l.trace=[s.item]:l.trace=[],t.ajax({url:baseUrl+"/visitorMonitor.do",type:"get",dataType:"jsonp",data:{method:"setVisitorMonitor",monitorInfo:encodeURIComponent(JSON.stringify(l))}})},changeFirstTime:function(e,t){var i,o=e,n=o.firstTime;for(var a in t)(!i||i>t[a].firstInTime)&&(i&&new Date(t[a].firstInTime).Format("yyyy-mm-dd")!=nowtime.Format("yyyy-mm-dd")||(i=t[a].firstInTime));return o.firstTime=i?i:n,new Date(o.firstTime).Format("yyyy-mm-dd")!=nowtime.Format("yyyy-mm-dd")&&(o.firstTime=o.lastTime),o},get:function(){var e=mo.options.storage,t=e.get("route");return t},getInfo:function(){var e=this,t=(e.options.storage,e.options.userDatas),i=t.getJsonStr(),o=e.getAllTime(i);return i.firstTime=o.firstTime,i.lastTime=o.lastTime,i.status="broswer",i},getAllTime:function(e){var t=nowtime.getTime();return{firstTime:e&&e.firstTime?e.firstTime:t,lastTime:t}},getTrace:function(){var e=nowtime.getTime(),i=this,o=i.options.storage,n=o.get("ncVisitor"),a=n?n.trace:null,s=[],r=null,c=!1;if(a){for(var l in a)if(a[l]){var d=a[l];decodeURIComponent(d.url)==location.href&&(c=!0,d.inTime=e,r=d),s.push(d)}c||(r={url:location.href,firstInTime:e,inTime:e,title:t("title").html()},s.push(r))}else r={url:location.href,firstInTime:e,inTime:e,title:t("title").html()},s.push(r);return s.length>10&&(s=s.sort(function(e,t){return e.inTime<t.inTime}),s.pop()),s=s.sort(function(e,t){return e.firstInTime<t.firstInTime}),{item:r,result:s,hasVal:c}}},t.monitor=function(e){var t=new o(e);return t.init(),t}}(window,jQuery),function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery"],e):e("undefined"!=typeof jQuery?jQuery:window.Zepto)}(function(e){"use strict";function t(t){var i=t.data;t.isDefaultPrevented()||(t.preventDefault(),e(t.target).ajaxSubmit(i))}function i(t){var i=t.target,o=e(i);if(!o.is("[type=submit],[type=image]")){var n=o.closest("[type=submit]");if(0===n.length)return;i=n[0]}var a=this;if(a.clk=i,"image"==i.type)if(void 0!==t.offsetX)a.clk_x=t.offsetX,a.clk_y=t.offsetY;else if("function"==typeof e.fn.offset){var s=o.offset();a.clk_x=t.pageX-s.left,a.clk_y=t.pageY-s.top}else a.clk_x=t.pageX-i.offsetLeft,a.clk_y=t.pageY-i.offsetTop;setTimeout(function(){a.clk=a.clk_x=a.clk_y=null},100)}function o(){if(e.fn.ajaxSubmit.debug){var t="[jquery.form] "+Array.prototype.join.call(arguments,"");window.console&&window.console.log?window.console.log(t):window.opera&&window.opera.postError&&window.opera.postError(t)}}var n={};n.fileapi=void 0!==e("<input type='file'/>").get(0).files,n.formdata=void 0!==window.FormData;var a=!!e.fn.prop;e.fn.attr2=function(){if(!a)return this.attr.apply(this,arguments);var e=this.prop.apply(this,arguments);return e&&e.jquery||"string"==typeof e?e:this.attr.apply(this,arguments)},e.fn.ajaxSubmit=function(t){function i(i){var o,n,a=e.param(i,t.traditional).split("&"),s=a.length,r=[];for(o=0;o<s;o++)a[o]=a[o].replace(/\+/g," "),n=a[o].split("="),r.push([decodeURIComponent(n[0]),decodeURIComponent(n[1])]);return r}function s(o){for(var n=new FormData,a=0;a<o.length;a++)n.append(o[a].name,o[a].value);if(t.extraData){var s=i(t.extraData);for(a=0;a<s.length;a++)s[a]&&n.append(s[a][0],s[a][1])}t.data=null;var r=e.extend(!0,{},e.ajaxSettings,t,{contentType:!1,processData:!1,cache:!1,type:c||"POST"});t.uploadProgress&&(r.xhr=function(){var i=e.ajaxSettings.xhr();return i.upload&&i.upload.addEventListener("progress",function(e){var i=0,o=e.loaded||e.position,n=e.total;e.lengthComputable&&(i=Math.ceil(o/n*100)),t.uploadProgress(e,o,n,i)},!1),i}),r.data=null;var l=r.beforeSend;return r.beforeSend=function(e,i){t.formData?i.data=t.formData:i.data=n,l&&l.call(this,e,i)},e.ajax(r)}function r(i){function n(e){var t=null;try{e.contentWindow&&(t=e.contentWindow.document)}catch(i){o("cannot get iframe.contentWindow document: "+i)}if(t)return t;try{t=e.contentDocument?e.contentDocument:e.document}catch(i){o("cannot get iframe.contentDocument: "+i),t=e.document}return t}function s(){function t(){try{var e=n(v).readyState;o("state = "+e),e&&"uninitialized"==e.toLowerCase()&&setTimeout(t,50)}catch(i){o("Server abort: ",i," (",i.name,")"),r(C),I&&clearTimeout(I),I=void 0}}var i=u.attr2("target"),a=u.attr2("action"),s="multipart/form-data",l=u.attr("enctype")||u.attr("encoding")||s;T.setAttribute("target",p),c&&!/post/i.test(c)||T.setAttribute("method","POST"),a!=m.url&&T.setAttribute("action",m.url),m.skipEncodingOverride||c&&!/post/i.test(c)||u.attr({encoding:"multipart/form-data",enctype:"multipart/form-data"}),m.timeout&&(I=setTimeout(function(){k=!0,r(x)},m.timeout));var d=[];try{if(m.extraData)for(var g in m.extraData)m.extraData.hasOwnProperty(g)&&(e.isPlainObject(m.extraData[g])&&m.extraData[g].hasOwnProperty("name")&&m.extraData[g].hasOwnProperty("value")?d.push(e('<input type="hidden" name="'+m.extraData[g].name+'">').val(m.extraData[g].value).appendTo(T)[0]):d.push(e('<input type="hidden" name="'+g+'">').val(m.extraData[g]).appendTo(T)[0]));m.iframeTarget||f.appendTo("body"),v.attachEvent?v.attachEvent("onload",r):v.addEventListener("load",r,!1),setTimeout(t,15);try{T.submit()}catch(h){var w=document.createElement("form").submit;w.apply(T)}}finally{T.setAttribute("action",a),T.setAttribute("enctype",l),i?T.setAttribute("target",i):u.removeAttr("target"),e(d).remove()}}function r(t){if(!w.aborted&&!L){if(P=n(v),P||(o("cannot access response document"),t=C),t===x&&w)return w.abort("timeout"),void S.reject(w,"timeout");if(t==C&&w)return w.abort("server abort"),void S.reject(w,"error","server abort");if(P&&P.location.href!=m.iframeSrc||k){v.detachEvent?v.detachEvent("onload",r):v.removeEventListener("load",r,!1);var i,a="success";try{if(k)throw"timeout";var s="xml"==m.dataType||P.XMLDocument||e.isXMLDoc(P);if(o("isXml="+s),!s&&window.opera&&(null===P.body||!P.body.innerHTML)&&--V)return o("requeing onLoad callback, DOM not available"),void setTimeout(r,250);var c=P.body?P.body:P.documentElement;w.responseText=c?c.innerHTML:null,w.responseXML=P.XMLDocument?P.XMLDocument:P,s&&(m.dataType="xml"),w.getResponseHeader=function(e){var t={"content-type":m.dataType};return t[e.toLowerCase()]},c&&(w.status=Number(c.getAttribute("status"))||w.status,w.statusText=c.getAttribute("statusText")||w.statusText);var l=(m.dataType||"").toLowerCase(),d=/(json|script|text)/.test(l);if(d||m.textarea){var u=P.getElementsByTagName("textarea")[0];if(u)w.responseText=u.value,w.status=Number(u.getAttribute("status"))||w.status,w.statusText=u.getAttribute("statusText")||w.statusText;else if(d){var p=P.getElementsByTagName("pre")[0],h=P.getElementsByTagName("body")[0];p?w.responseText=p.textContent?p.textContent:p.innerText:h&&(w.responseText=h.textContent?h.textContent:h.innerText)}}else"xml"==l&&!w.responseXML&&w.responseText&&(w.responseXML=j(w.responseText));try{N=O(w,l,m)}catch(b){a="parsererror",w.error=i=b||a}}catch(b){o("error caught: ",b),a="error",w.error=i=b||a}w.aborted&&(o("upload aborted"),a=null),w.status&&(a=w.status>=200&&w.status<300||304===w.status?"success":"error"),"success"===a?(m.success&&m.success.call(m.context,N,"success",w),S.resolve(w.responseText,"success",w),g&&e.event.trigger("ajaxSuccess",[w,m])):a&&(void 0===i&&(i=w.statusText),m.error&&m.error.call(m.context,w,a,i),S.reject(w,"error",i),g&&e.event.trigger("ajaxError",[w,m,i])),g&&e.event.trigger("ajaxComplete",[w,m]),g&&!--e.active&&e.event.trigger("ajaxStop"),m.complete&&m.complete.call(m.context,w,a),L=!0,m.timeout&&clearTimeout(I),setTimeout(function(){m.iframeTarget?f.attr("src",m.iframeSrc):f.remove(),w.responseXML=null},100)}}}var l,d,m,g,p,f,v,w,b,y,k,I,T=u[0],S=e.Deferred();if(S.abort=function(e){w.abort(e)},i)for(d=0;d<h.length;d++)l=e(h[d]),a?l.prop("disabled",!1):l.removeAttr("disabled");if(m=e.extend(!0,{},e.ajaxSettings,t),m.context=m.context||m,p="jqFormIO"+(new Date).getTime(),m.iframeTarget?(f=e(m.iframeTarget),y=f.attr2("name"),y?p=y:f.attr2("name",p)):(f=e('<iframe name="'+p+'" src="'+m.iframeSrc+'" />'),f.css({position:"absolute",top:"-1000px",left:"-1000px"})),v=f[0],w={aborted:0,responseText:null,responseXML:null,status:0,statusText:"n/a",getAllResponseHeaders:function(){},getResponseHeader:function(){},setRequestHeader:function(){},abort:function(t){var i="timeout"===t?"timeout":"aborted";o("aborting upload... "+i),this.aborted=1;try{v.contentWindow.document.execCommand&&v.contentWindow.document.execCommand("Stop")}catch(n){}f.attr("src",m.iframeSrc),w.error=i,m.error&&m.error.call(m.context,w,i,t),g&&e.event.trigger("ajaxError",[w,m,i]),m.complete&&m.complete.call(m.context,w,i)}},g=m.global,g&&0===e.active++&&e.event.trigger("ajaxStart"),g&&e.event.trigger("ajaxSend",[w,m]),m.beforeSend&&m.beforeSend.call(m.context,w,m)===!1)return m.global&&e.active--,S.reject(),S;if(w.aborted)return S.reject(),S;b=T.clk,b&&(y=b.name,y&&!b.disabled&&(m.extraData=m.extraData||{},m.extraData[y]=b.value,"image"==b.type&&(m.extraData[y+".x"]=T.clk_x,m.extraData[y+".y"]=T.clk_y)));var x=1,C=2,D=e("meta[name=csrf-token]").attr("content"),M=e("meta[name=csrf-param]").attr("content");M&&D&&(m.extraData=m.extraData||{},m.extraData[M]=D),m.forceSync?s():setTimeout(s,10);var N,P,L,V=50,j=e.parseXML||function(e,t){return window.ActiveXObject?(t=new ActiveXObject("Microsoft.XMLDOM"),t.async="false",t.loadXML(e)):t=(new DOMParser).parseFromString(e,"text/xml"),t&&t.documentElement&&"parsererror"!=t.documentElement.nodeName?t:null},E=e.parseJSON||function(e){return window.eval("("+e+")")},O=function(t,i,o){var n=t.getResponseHeader("content-type")||"",a="xml"===i||!i&&n.indexOf("xml")>=0,s=a?t.responseXML:t.responseText;return a&&"parsererror"===s.documentElement.nodeName&&e.error&&e.error("parsererror"),o&&o.dataFilter&&(s=o.dataFilter(s,i)),"string"==typeof s&&("json"===i||!i&&n.indexOf("json")>=0?s=E(s):("script"===i||!i&&n.indexOf("javascript")>=0)&&e.globalEval(s)),s};return S}if(!this.length)return o("ajaxSubmit: skipping submit process - no element selected"),this;var c,l,d,u=this;"function"==typeof t?t={success:t}:void 0===t&&(t={}),c=t.type||this.attr2("method"),l=t.url||this.attr2("action"),d="string"==typeof l?e.trim(l):"",d=d||window.location.href||"",d&&(d=(d.match(/^([^#]+)/)||[])[1]),t=e.extend(!0,{url:d,success:e.ajaxSettings.success,type:c||e.ajaxSettings.type,iframeSrc:/^https/i.test(window.location.href||"")?"javascript:false":"about:blank"},t);var m={};if(this.trigger("form-pre-serialize",[this,t,m]),m.veto)return o("ajaxSubmit: submit vetoed via form-pre-serialize trigger"),this;if(t.beforeSerialize&&t.beforeSerialize(this,t)===!1)return o("ajaxSubmit: submit aborted via beforeSerialize callback"),this;var g=t.traditional;void 0===g&&(g=e.ajaxSettings.traditional);var p,h=[],f=this.formToArray(t.semantic,h);if(t.data&&(t.extraData=t.data,p=e.param(t.data,g)),t.beforeSubmit&&t.beforeSubmit(f,this,t)===!1)return o("ajaxSubmit: submit aborted via beforeSubmit callback"),this;if(this.trigger("form-submit-validate",[f,this,t,m]),m.veto)return o("ajaxSubmit: submit vetoed via form-submit-validate trigger"),this;var v=e.param(f,g);p&&(v=v?v+"&"+p:p),"GET"==t.type.toUpperCase()?(t.url+=(t.url.indexOf("?")>=0?"&":"?")+v,t.data=null):t.data=v;var w=[];if(t.resetForm&&w.push(function(){u.resetForm()}),t.clearForm&&w.push(function(){u.clearForm(t.includeHidden)}),!t.dataType&&t.target){var b=t.success||function(){};w.push(function(i){var o=t.replaceTarget?"replaceWith":"html";e(t.target)[o](i).each(b,arguments)})}else t.success&&w.push(t.success);if(t.success=function(e,i,o){for(var n=t.context||this,a=0,s=w.length;a<s;a++)w[a].apply(n,[e,i,o||u,u])},t.error){var y=t.error;t.error=function(e,i,o){var n=t.context||this;y.apply(n,[e,i,o,u])}}if(t.complete){var k=t.complete;t.complete=function(e,i){var o=t.context||this;k.apply(o,[e,i,u])}}var I=e("input[type=file]:enabled",this).filter(function(){return""!==e(this).val()}),T=I.length>0,S="multipart/form-data",x=u.attr("enctype")==S||u.attr("encoding")==S,C=n.fileapi&&n.formdata;o("fileAPI :"+C);var D,M=(T||x)&&!C;t.iframe!==!1&&(t.iframe||M)?t.closeKeepAlive?e.get(t.closeKeepAlive,function(){D=r(f)}):D=r(f):D=(T||x)&&C?s(f):e.ajax(t),u.removeData("jqxhr").data("jqxhr",D);for(var N=0;N<h.length;N++)h[N]=null;return this.trigger("form-submit-notify",[this,t]),this},e.fn.ajaxForm=function(n){if(n=n||{},n.delegation=n.delegation&&e.isFunction(e.fn.on),!n.delegation&&0===this.length){var a={s:this.selector,c:this.context};return!e.isReady&&a.s?(o("DOM not ready, queuing ajaxForm"),e(function(){e(a.s,a.c).ajaxForm(n)}),this):(o("terminating; zero elements found by selector"+(e.isReady?"":" (DOM not ready)")),this)}return n.delegation?(e(document).off("submit.form-plugin",this.selector,t).off("click.form-plugin",this.selector,i).on("submit.form-plugin",this.selector,n,t).on("click.form-plugin",this.selector,n,i),this):this.ajaxFormUnbind().bind("submit.form-plugin",n,t).bind("click.form-plugin",n,i)},e.fn.ajaxFormUnbind=function(){return this.unbind("submit.form-plugin click.form-plugin")},e.fn.formToArray=function(t,i){var o=[];if(0===this.length)return o;var a,s=this[0],r=this.attr("id"),c=t?s.getElementsByTagName("*"):s.elements;if(c&&!/MSIE [678]/.test(navigator.userAgent)&&(c=e(c).get()),r&&(a=e(':input[form="'+r+'"]').get(),a.length&&(c=(c||[]).concat(a))),!c||!c.length)return o;var l,d,u,m,g,p,h;for(l=0,p=c.length;l<p;l++)if(g=c[l],u=g.name,u&&!g.disabled)if(t&&s.clk&&"image"==g.type)s.clk==g&&(o.push({name:u,value:e(g).val(),type:g.type}),o.push({name:u+".x",value:s.clk_x},{name:u+".y",value:s.clk_y}));else if(m=e.fieldValue(g,!0),m&&m.constructor==Array)for(i&&i.push(g),d=0,h=m.length;d<h;d++)o.push({name:u,value:m[d]});else if(n.fileapi&&"file"==g.type){i&&i.push(g);var f=g.files;if(f.length)for(d=0;d<f.length;d++)o.push({name:u,value:f[d],type:g.type});else o.push({name:u,value:"",type:g.type})}else null!==m&&"undefined"!=typeof m&&(i&&i.push(g),o.push({name:u,value:m,type:g.type,required:g.required}));if(!t&&s.clk){var v=e(s.clk),w=v[0];u=w.name,u&&!w.disabled&&"image"==w.type&&(o.push({name:u,value:v.val()}),o.push({name:u+".x",value:s.clk_x},{name:u+".y",value:s.clk_y}))}return o},e.fn.formSerialize=function(t){return e.param(this.formToArray(t))},e.fn.fieldSerialize=function(t){var i=[];return this.each(function(){var o=this.name;if(o){var n=e.fieldValue(this,t);if(n&&n.constructor==Array)for(var a=0,s=n.length;a<s;a++)i.push({name:o,value:n[a]});else null!==n&&"undefined"!=typeof n&&i.push({name:this.name,value:n})}}),e.param(i)},e.fn.fieldValue=function(t){for(var i=[],o=0,n=this.length;o<n;o++){var a=this[o],s=e.fieldValue(a,t);null===s||"undefined"==typeof s||s.constructor==Array&&!s.length||(s.constructor==Array?e.merge(i,s):i.push(s))}return i},e.fieldValue=function(t,i){var o=t.name,n=t.type,a=t.tagName.toLowerCase();if(void 0===i&&(i=!0),i&&(!o||t.disabled||"reset"==n||"button"==n||("checkbox"==n||"radio"==n)&&!t.checked||("submit"==n||"image"==n)&&t.form&&t.form.clk!=t||"select"==a&&t.selectedIndex==-1))return null;if("select"==a){var s=t.selectedIndex;if(s<0)return null;for(var r=[],c=t.options,l="select-one"==n,d=l?s+1:c.length,u=l?s:0;u<d;u++){var m=c[u];if(m.selected){var g=m.value;if(g||(g=m.attributes&&m.attributes.value&&!m.attributes.value.specified?m.text:m.value),l)return g;r.push(g)}}return r}return e(t).val()},e.fn.clearForm=function(t){return this.each(function(){e("input,select,textarea",this).clearFields(t)})},e.fn.clearFields=e.fn.clearInputs=function(t){var i=/^(?:color|date|datetime|email|month|number|password|range|search|tel|text|time|url|week)$/i;return this.each(function(){var o=this.type,n=this.tagName.toLowerCase();i.test(o)||"textarea"==n?this.value="":"checkbox"==o||"radio"==o?this.checked=!1:"select"==n?this.selectedIndex=-1:"file"==o?/MSIE/.test(navigator.userAgent)?e(this).replaceWith(e(this).clone(!0)):e(this).val(""):t&&(t===!0&&/hidden/.test(o)||"string"==typeof t&&e(this).is(t))&&(this.value="")})},e.fn.resetForm=function(){return this.each(function(){("function"==typeof this.reset||"object"==typeof this.reset&&!this.reset.nodeType)&&this.reset()})},e.fn.enable=function(e){return void 0===e&&(e=!0),this.each(function(){this.disabled=!e})},e.fn.selected=function(t){return void 0===t&&(t=!0),this.each(function(){var i=this.type;if("checkbox"==i||"radio"==i)this.checked=t;else if("option"==this.tagName.toLowerCase()){var o=e(this).parent("select");t&&o[0]&&"select-one"==o[0].type&&o.find("option").selected(!1),this.selected=t}})},e.fn.ajaxSubmit.debug=!1}),function(e,t,i){"use strict";var o=function(e,i){this.$el=e,this.defaults={other:function(e,t){},uploadType:"all",size:0,inputImage:!1,callback:function(e){},error:function(e){}},this.options=t.extend({},this.defaults,i)};o.prototype={errorCodes:{E001:"身份认证错误",E002:"上传文件类型错误，只允许上传.jpg .jpeg .bmp .png .doc .docx .xls .xlsx .pdf .txt .amr .ppt .pptx .csv",E003:""},init:function(){var e=this;this.options.uploadType,this.options.size;e.create()},create:function(){var e=this,i=this.options.uploadType,o=this.options.size,n=e.$el;e.$el.find(".fileup").length>0&&e.$el.find(".fileup").remove();var a="/any800/echatManager.do?method=uploadFile&fromType=visitor&chatId="+ucc.chatID,s="*/*";e.options.inputImage&&(s="image/*");var r='<form class="fileup" contentType="text/html"   method="post"  enctype="multipart/form-data" action="'+a+'"><input multiple="false" type="file" name="uploadField" accept="'+s+'" /></form>';t(n).append(r);var c=e.$el.find(".fileup").find("input:file");c.on("change",function(){var t=c[0],n=t.value,a=n.substring(n.lastIndexOf(".")).toLowerCase();return e.checkType(a,i)?t.files&&o&&o<t.files[0].size?(e.create(),void e.options.error("size")):void e.options.other(e,t.files?t.files[0].name:n,(new Date).getTime()):(e.create(),void e.options.error("type"))})},submit:function(e,t){var i=this;0!=i.$el.find(".fileup").length&&i.$el.find(".fileup").ajaxSubmit(function(o){var n=JSON.parse(o);n.success?i.options.callback(n.content,e,t):i.options.error("other",e,n.errorMessage,t),i.create()})},checkType:function(e,t){if(e=e.toLowerCase(),"all"==t)return e.match(/.gif|.jpg|.jpeg|.bmp|.png|.doc|.docx|.xls|.xlsx|.pdf|.txt/i);var i=t.split(";");if(i.length>0){for(var o in i)if("image"==i[o]){if(e.match(/.gif|.jpg|.jpeg|.bmp|.png/i))return!0}else if("doc"==i[o]){if(e.match(/.doc|.docx/i))return!0}else if("xls"==i[o]){if(e.match(/.xls|.xlsx/i))return!0}else if("pdf"==i[o]){if(e.match(/.pdf/i))return!0}else if("txt"==i[o]&&e.match(/.txt/i))return!0;return!1}}},t.fn.uploadFile=function(e){var i=new o(t(this),e);return i.init(),i}}(window,jQuery),function(e,t,i){var o=function(e){this.defaults={storage:null,loadMore:function(e){}},this.options=t.extend({},this.defaults,e)};o.prototype={current:[],history:[],time:0,init:function(){this.current=this.options.storage.get("localCur")?this.options.storage.get("localCur"):[],this.history=this.options.storage.get("localHis")?this.options.storage.get("localHis"):[],this.time=this.options.storage.get("localTim")?this.options.storage.get("localTim"):(new Date).getTime(),this.history.length>0&&(this.lastChat=this.history.length-1,this.lastId=this.history[this.lastChat].data.length-1)},setCurrent:function(e){var t=[];for(var i in e)if(!isNaN(Number(i))){var o=e[i];if(0==o.saveIn&&!o.isRevoke&&"system"!=o.type&&1!=o.status&&2!=o.checkSend){var n="client"==o.type?dialogue.getAttr("operatorName"):"visitor"==o.type?userDatas.getVisitorInfo().visitorName:"robot"==o.type?"机器人":"";t.push({from:o.type,content:o.content,time:o.time,opName:n})}}this.options.storage.set("localTim",this.time),this.options.storage.set("localCur",t),this.current=t},saveCurrent:function(){if(this.current.length>0){if(this.history.length>0&&this.time==this.history[this.history.length-1].time)return;this.history.push({data:this.current,time:this.time}),this.current=[],this.save()}this.time=(new Date).getTime(),this.options.storage.set("localTim",this.time)},save:function(){this.options.storage.set("localCur",this.current),this.options.storage.set("localHis",this.history)},lastId:0,lastChat:0,page:5,loadMore:function(){for(var e=[],t=0,i=this.page;t<i;){var o=this.preload(this.lastChat,this.lastId);if(!o)break;e.push(o),"date"!=o.type&&t++}this.options.loadMore(e)},preload:function(e,t){if(e==-1)return"";if(t==-1)return this.lastChat=e-1,this.lastChat==-1?"":(this.lastId=this.history[this.lastChat].data.length-1,{type:"date",time:this.history[this.lastChat].time});var i=this.history[this.lastChat].data[this.lastId];return this.lastId=this.lastId-1,i}},t.localHistory=function(e){var t=new o(e);return t}}(window,jQuery),function(e,t,i){var o=function(e){this.defaults={},this.options=t.extend({},this.defaults,e)};o.prototype={defered:null,init:function(){var e=this;t(".confirmBox").length>0||(t("body").append("<div class='confirmBox'><div class='body'><div class='title'></div><div class='rightBtn'></div><div class='wrongBtn'></div></div></div>"),t(".confirmBox .rightBtn").on("click",function(){e.defered&&e.defered.resolve(!0),t(".confirmBox").hide(),e.defered=null}),t(".confirmBox .wrongBtn").on("click",function(){e.defered&&e.defered.resolve(!1),t(".confirmBox").hide(),e.defered=null}),t(".confirmBox").hide())},create:function(e,i,o){var n=this;return i=i?i:"确定",o=o?o:"取消",t(".confirmBox").show(),n.switchTitle(e,i,o),n.defered&&n.defered.resolve(!1),n.defered=new t.Deferred,n.defered.promise()},switchTitle:function(e,i,o){t(".confirmBox .title").html(e),t(".confirmBox .rightBtn").html(i),t(".confirmBox .wrongBtn").html(o);var n=t(".confirmBox").height()/2-t(".confirmBox .body").height()/2;t(".confirmBox .body").css({marginTop:n})}},t.confirm=function(e){var t=new o(e);return t.init(),t}}(window,jQuery),function(e,t,i){var o=function(e){this.defaults={path:"/any800/UccWebSocket/",visitorId:"",message:function(e,t){},deal:function(e,t,i){},connect:function(e){},confirmSend:function(e){},leaveCover:function(){},open:function(){}},this.options=t.extend({},this.defaults,e)},n={pong:0,sendTime:2,checkTime:3,warnTime:10,reconnectTime:20,connnectNumber:0,connectTime:-1,w:null,init:function(e){var t=this;t.w=e,this.interval&&clearInterval(this.interval),t.check(),this.interval=setInterval(function(){t.check()},1e3*this.checkTime)},setPong:function(){this.pong=(new Date).getTime()},check:function(){return this.w.websocket.isConnect=!0,navigator&&0==navigator.onLine?(this.w.endTimeout(),console.log("navigator offline"),void(this.w.websocket.isConnect=!1)):void(this.w&&this.w.websocket&&this.w.websocket.readyState==this.w.websocket.CLOSED&&(this.w.websocket.isConnect=!1,this.w.endTimeout()))},setRate:function(){if(this.pong){var e=(new Date).getTime(),t=(e-this.pong)/1e3;t=Math.max(t,20),this.reconnectTime=t,this.warnTime=t/2,storage.set("reconnectTime",t)}},sendPing:function(){var e=new a({date:(new Date).getTime(),chatId:"",type:"PING"});this.w.send(JSON.stringify(e)),this.ping=(new Date).getTime()},end:function(){this.interval&&clearInterval(this.interval),this.w.websocket.readyState!=this.w.websocket.CLOSED&&this.w.websocket.close(),this.connnectNumber++},reconnect:function(){var e=!1;return this.connnectNumber<=this.connectTime&&(e=!0,this.w.reconnect()),e}},a=function(e){var t=this;return t.chatId=e.chatID,t.type=e.type?e.type:"VS_CHAT",t.content=JSON.stringify(new c(e.message)),t.messageId="Other"+e.date,t},s=function(e){var t=this;return t.chatId=e.chatID,t.type=e.type?e.type:"VS_CHAT",t.content=e.message,t.messageId="Other"+e.date,t},r=function(e){var t=this;return t.type="RECEIPTS",t.messageId=e,t},c=function(e){var t=this;return t.msg=e,t},l=new t.Deferred;o.prototype={isWork:!1,isConnect:!1,connectTimeout:null,websocket:null,keepAliveModel:!0,init:function(){var t=this;storage.get("webSocketIsWork");return e.WebSocket&&e.WebSocket.prototype.send&&"true"==t.options.isWs&&(t.isWork=!0),t.isWork&&(t.reconnectionFun(),t.connect()),t.isWork?l.promise():l.resolve(!1)},reconnectionFun:function(){var t=this;if(t.isWork)return e.WebSocket||e.MozWebSocket},getWebSocketUri:function(){return("http:"==e.location.protocol?"ws://":"wss://")+(""==document.location.hostname?"localhost":document.location.hostname)+(""==document.location.port?"":":"+document.location.port)+this.options.path+this.options.visitorId},connectType:0,connect:function(){var t=this;if(t.isWork&&(!t.websocket||t.websocket.readyState==WebSocket.CLOSED)){var i=e.WebSocket||e.MozWebSocket;t.websocket=new i(t.getWebSocketUri()),t.websocket.onopen=t.doOpen,t.websocket.onerror=t.doError,t.websocket.onclose=t.doClose,t.websocket.onmessage=t.doMessage,t.connectType=1}},doOpen:function(){var e=this;l.resolve(!0),console.log("Info: WebSocket connection opened."),e.isConnect=!0,webSocket.hasOpend=!0,webSocket.startTimeout(),webSocket.pingTime=0,webSocket.pongTime=0,webSocket.options.open(),webSocket.connectType=2,n.connnectNumber=0,storage.set("webSocketIsWork",!0)},pingTime:0,pongTime:0,sendPing:function(){var e=this;e.pingTime&&e.pongTime&&(e.pingTime-e.pongTime>3e3?e.websocket.isConnect=!1:e.websocket.isConnect=!0),e.pingTime=(new Date).getTime();var t=new a({date:(new Date).getTime(),chatId:"",type:"PING"});e.websocket&&e.websocket.send(JSON.stringify(t))},startTimeout:function(){if(this.isWork){this.keepAliveModel&&n.init(this);var e=this;e.connectTimeout&&clearTimeout(e.connectTimeout),e.connectTimeout=setTimeout(function(){e.options.connect(e.websocket.isConnect),e.websocket.isConnect||3!=e.connectType||e.websocket&&e.websocket.readyState==WebSocket.CLOSED&&e.connect(),e.startTimeout()},1e3)}},endTimeout:function(){this.keepAliveModel&&n.end();var e=this;e.connectTimeout&&clearTimeout(e.connectTimeout),e.connectTimeout=null},startReconnect:function(){var e=this;e.reconnectTimeout&&clearTimeout(e.reconnectTimeout),e.websocket&&e.websocket.isConnect||(e.connect(),e.reconnectTimeout=setTimeout(function(){e.startReconnect()},5e3))},doError:function(e){webSocket.hasOpend||(webSocket.isWork=!1,storage.set("webSocketIsWork",!1),l.resolve(!1)),console.log("Info: WebSocket error. code="+e.code)},doClose:function(e){var t=this;webSocket.hasOpend&&("1004"!=e.code&&"1006"!=e.code||webSocket.options.leaveCover(),"1006"==e.code&&webSocket.startReconnect(),console.log("Info: WebSocket closed. code="+e.code),console.log(e),t.isConnect=!1),webSocket.connectType=3},doMessage:function(e){n.setPong();console.log(e.data);var t=JSON.parse(e.data),i=t.type;if("WELCOME_TIPS"==i){var o=JSON.parse(t.content);webSocket.options.deal("CUTOMER_IS_INVITED",t.chatId,o.msg)}else if("CHAT"==i){var o=JSON.parse(t.content);webSocket.options.message(t.chatId,o.msg,t.messageId)}else if("CLOSE_ROOM"==i){var o=JSON.parse(t.content);"operatorLeaving"==o.msg?webSocket.options.deal("CLOSE",t.chatId,o.msg):webSocket.options.deal("CLOSE_CUSTOMER",t.chatId,o.msg)}else if("LEAVE_ROOM"==i){var o=JSON.parse(t.content);webSocket.options.deal("CLOSE_CUSTOMER",t.chatId,o.msg)}else if("RECEIPTS"==i){var o=JSON.parse(t.content);webSocket.options.deal("RECEIPT",t.chatId,o.targetMsgId)}else if("OPERATION_TIPS"==i){var o=JSON.parse(t.content);webSocket.options.deal(i,t.chatId,{params:o})}else if("REVOKE"==i){var o=JSON.parse(t.content);webSocket.options.deal("CUTOMER_REVOKE",t.chatId,t.messageId)}else if("VS_QUEUE_INDEX"==i){var o=JSON.parse(t.content);webSocket.options.deal("VS_QUEUE_INDEX",t.chatId,o)}else if("PONG"==i)webSocket.pongTime=(new Date).getTime();else if("DISCONNECTED_TIP"==i){var o=JSON.parse(t.content);webSocket.options.deal("CUSTOMER_NETWORK_INTERRUPT",t.chatId,o)}if("PONG"!=i&&"RECEIPTS"!=i&&null!=webSocket.websocket&&t.messageId){var a=new r(t.messageId);webSocket.websocket.send(JSON.stringify(a))}},close:function(e){var t=this;null!=t.websocket},send:function(e){var t=this;if(null!=t.websocket){var i=new a(e);t.options.confirmSend(i.messageId),t.websocket.send(JSON.stringify(i))}},queue:function(e){var t=this;if(null!=t.websocket){var i=new s(e);t.websocket.send(JSON.stringify(i))}}},t.webSocket=function(e){var t=new o(e);return t}}(window,jQuery);