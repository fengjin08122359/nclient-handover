!function(e,t,i){"use strict";var n="<span data-index='$index' data-tab='$tab' >$title<i></i></span>",o="<div data-index='$index' class='iframe'><iframe src='$url' frameborder='0' scrolling='scroll'></iframe></div>",a=function(e,i){this.$el=e,this.defaults={relatedEl:null},this.options=t.extend({},this.defaults,i)};a.prototype={current:0,data:[],init:function(){var i=this;i.resize(),i.$el.find(".tab_title").delegate("span","click",function(){i.current=t(this).data("index"),t(this).addClass("active"),t(this).siblings().removeClass("active");var e=i.$el.find(".tab_main .iframe[data-index='"+i.current+"']");e.addClass("active"),e.siblings().removeClass("active")}),i.$el.find(".tab_title").delegate("span i","click",function(){var e=t(this).parent().data("index");i.remove(e)}),t(e).resize(function(e){i.resize()})},add:function(e,t,i){var a=this,s=a.data.length;0==a.$el.find(".tab_title span[data-tab='"+e+"']").length?(a.data[s]=e,a.$el.find(".tab_title").append(n.replace(/\$title/g,t).replace(/\$index/g,s).replace(/\$tab/g,e)),a.$el.find(".tab_main").append(o.replace(/\$url/g,i).replace(/\$index/g,s)),1!=e&&2!=e||a.$el.find(".tab_title span").last().find("i").remove(),a.current=s,a.$el.find(".tab_title span[data-index='"+s+"']").click()):a.$el.find(".tab_title span[data-tab='"+e+"']").click(),a.resize()},resize:function(){var e=this;0==e.$el.find(".tab_title span").length?(e.$el.css("width",0),e.options.relatedEl.css("right",0)):t("body").width()>900?(e.$el.css("width","486px"),e.options.relatedEl.css("right","486px")):t("body").width()>768?(e.$el.css("width","430px"),e.options.relatedEl.css("right","430px")):(e.$el.css("width",0),e.options.relatedEl.css("right",0))},remove:function(e){var t=this,i=t.$el.find(".tab_title span[data-index='"+e+"']"),n=i.prev().length>0?i.prev():i.next();i.remove(),t.$el.find(".tab_main .iframe[data-index='"+e+"']").remove(),n&&n.length>0&&n.click(),t.resize()}},t.fn.tab=function(e){var i=new a(t(this),e);return i.init(),i}}(window,jQuery),function(e,t,i){"use strict";var n=function(e,i){this.$el=e,this.defaults={},this.options=t.extend({},this.defaults,i)};n.prototype={show:function(e){if(e&&"undefined"!=e&&"null"!=e){var t=this.$el;t.html(""),t.find(".systemInfo").remove(),t.append('<div class="systemInfromBox systemInfo">'+e+"</div>")}},hide:function(){var e=this.$el;e.find(".systemInfo").remove()}},t.fn.systemInfo=function(e){var i=new n(t(this),e);return i}}(window,jQuery),function(e,t,i){var n=function(e,i){this.$el=e,this.defaults={},this.options=t.extend({},this.defaults,i)};n.prototype={init:function(){var e=this;e.$el.each(function(i,n){e.show(t(this))})},show:function(e){e.data("label")&&("static"==e.css("position")&&e.css("position","relative"),e.append('<div class="label">'+e.data("label")+"</div>"),e.find(".label").width(12*e.find(".label").text().length),e.hover(function(){e.find(".label").show()},function(){e.find(".label").hide()}))}},t.fn.showLabel=function(e){var i=new n(t(this),e);return i.init(),i}}(window,jQuery),function(e,t,i){var n=function(e){this.defaults={companyPk:"",after:function(e){},init:function(){},hide:function(){}},this.options=t.extend({},this.defaults,e)};n.prototype={msg:"",ok:!0,init:function(){this.options.init()},check:function(e){this.checkNew(e)},checkNew:function(e){var i=this;i.ok&&e||i.options.hide(),e!=i.msg&&i.ok&&e&&(i.msg=e,t.ajax({type:"POST",url:"echatManager.do",data:{method:"getSimilarQuestions",companyPk:i.options.companyPk,visitorId:i.options.visitorId,chatId:i.options.chatId,channel:"web",question:e,top:3},dataType:"json",async:!1}).done(function(t){t&&i.options.newAfter(t,e)}).fail(function(){i.ok=!1}))},checkOld:function(e){var i=this;i.ok&&e||i.options.hide(),e!=i.msg&&i.ok&&e&&(i.msg=e,t.ajax({type:"post",url:"./qaInterface.do",data:{method:"searchForQuestionByKeywords",companyPk:i.options.companyPk,question:e},dataType:"json",async:!1}).done(function(e){0!=e.success?i.options.after(e):i.ok=!1}).fail(function(){i.ok=!1}))},hide:function(){this.options.hide()}},t.visitorRobot=function(e){var t=new n(e);return t}}(window,jQuery),function(e,t,i){var n=function(e){this.defaults={fs:{fontSize:"14px",color:"#000",fontWeight:"normal",fontStyle:"normal",textDecoration:"none",lineHeight:"14px",fontFamily:lang.front.fonts[0]},storage:null,initFun:function(e){}},this.options=t.extend({},this.defaults,e)};n.prototype={fs:{fontSize:"14px",color:"#000",fontWeight:"normal",fontStyle:"normal",textDecoration:"none",lineHeight:"14px",fontFamily:lang.front.fonts[0]},init:function(){var e=this.options.storage,t=e.get("fs");t&&(this.fs=t),this.options.initFun(t)},isShow:function(){return this.options.fs!=this.fs},set:function(e,t){var i=this.options.storage;this.fs[e]=t,i.set("fs",this.fs)},get:function(e){this.options.storage;return"undefined"!=typeof e?this.fs[e]:""}},t.fontStyle=function(e){var t=new n(e);return t.init(),t}}(window,jQuery),function(e,t,i){var n=function(e){this.defaults={aDset:{vcwTitleZhcn:lang.vcwTitleZhcn,vcwLftAdZhcn:"./style/images/echat/ad.html",vcwLogoZhcn:"./style/css/images/ucc-logo.png"}},this.options={aDset:{vcwTitleZhcn:e.aDset.vcwTitleZhcn?e.aDset.vcwTitleZhcn:this.defaults.aDset.vcwTitleZhcn,vcwLftAdZhcn:e.aDset.vcwLftAdZhcn?e.aDset.vcwLftAdZhcn:this.defaults.aDset.vcwLftAdZhcn,vcwLogoZhcn:e.aDset.vcwLogoZhcn?e.aDset.vcwLogoZhcn:this.defaults.aDset.vcwLogoZhcn}}};n.prototype={setTitle:function(){},setTab:function(){tab.add("2",lang.profile,this.options.aDset.vcwLftAdZhcn),t(".ucc-logo").attr("src",this.options.aDset.vcwLogoZhcn)}},t.setSkin=function(e){var t=new n(e);return t}}(window,jQuery),function(e){function t(e){var t=parseInt(e.substr(1),16);return(t>>>16)+(t>>>8&255)+(255&t)<500}e.fn.colorPicker=function(i){var n={color:new Array("#FFFFFF","#EEEEEE","#FFFF88","#FF7400","#CDEB8B","#6BBA70","#006E2E","#C3D9FF","#4096EE","#356AA0","#FF0096","#B02B2C","#702D86","#000000"),defaultColor:0,columns:0,click:function(e,t){}},o=e.extend({},n,i);return this.each(function(){for(var i=e(this),n=e.meta?e.extend({},o,i.data()):o,a="number"==typeof n.defaultColor?n.defaultColor:-1,s="",r=0;r<n.color.length;r++)s+='<div style="background-color:'+n.color[r]+';"></div>',a==-1&&n.defaultColor==n.color[r]&&(a=r);i.html('<div class="jColorSelect">'+s+"</div>");var c=i.children(".jColorSelect").children("div"),l=(c.width()+2+2)*(n.columns>0?n.columns:n.color.length);i.children(".jColorSelect").css("width",l),c.each(function(i){e(this).click(function(){if(a!=i){if(a>-1){var o=c.eq(a);o.hasClass("check")&&o.removeClass("check").removeClass("checkwht").removeClass("checkblk")}a=i,e(this).addClass("check").addClass(t(n.color[i])?"checkwht":"checkblk"),n.click(n.color[i],i)}})});var d=a;a=-1,c.eq(d).trigger("click")})}}(jQuery),function(e,t,i){var n=function(e){this.defaults={os:{},draw:function(e){},download:function(){}},this.options=t.extend({},this.defaults,e)};n.prototype={outTime:6e4,startTime:0,using:!1,failOp:0,scinterval:null,os:null,title:"",type:1,http:"http://local.any800.com:20201/",https:"https://local.any800.com:20202/",url:"",onClick:!1,init:function(){this.title=t("title").html(),this.os=this.options.os;var e="https:"==document.location.protocol;e?this.url=this.https:this.url=this.http,t(".screenCaptureCheckBox .checked").toggleClass("active",!!datas.get("screenCapture")),this.getBrowserName()},use:function(){if(!this.onClick){this.onClick=!0,this.type=!datas.get("screenCapture");var e=Number(!!this.type),i=this.browserName;t("title").html(this.title+"-"+lang.screenCapturing),t("iframe.screenCapture").remove(),t("html").append("<iframe class='screenCapture' style='position:absolute;visibility:hidden;top: 0;left: 0;'  src='hfxyz:\\\\"+(e?"show":"hidden?pn="+i+"&title="+encodeURIComponent(this.title))+"' frameborder='0'></iframe>"),this.startTime=(new Date).getTime(),this.using=!1,this.failOp=0,this.startCheck()}},getBrowserName:function(){var e=this.os.browserName;switch(e){case"msie":e="iexplore";break;case"metasr":e="SogouExplorer";break;case"qqbrowser":e="QQBrowser";break;case"firefox":e="firefox";break;case"chrome":e="chrome";break;case"msie":e="iexplore"}if("chrome"==e){var t=navigator.mimeTypes["application/vnd.chromium.remoting-viewer"];t&&(e="360se")}this.browserName=e},startCheck:function(){var e=this;this.scinterval&&clearInterval(this.scinterval),(new Date).getTime()-this.startTime>this.outTime||(this.scinterval=setInterval(function(){t.ajax({url:e.url+"index.html",dataType:"jsonp",jsonpCallback:"success_jsonpCallback"}).done(function(t){console.log("time"+(new Date).getTime()),e.failOp=0,1==t.test&&t.data?(e.using=!0,e.options.draw(t.data),e.close()):0==t.test&&e.close()}),e.failOp>10&&e.download(),e.failOp++},500))},close:function(){this.scinterval&&clearInterval(this.scinterval),this.onClick=!1,t("title").html(this.title),t("iframe.screenCapture").remove(),t("html").append("<iframe class='screenCapture' style='position:absolute;visibility:hidden'  src='"+this.url+"close.html' frameborder='0'></iframe>")},download:function(){this.scinterval&&clearInterval(this.scinterval),this.onClick=!1,e.ScreenCapture||this.hasDownload||(this.hasDownload=!0,this.options.download())},checkIE:function(){var e=t(".screenCaptureIframe");e.length<1&&(t("body").append('<div class="screenCaptureIframe" style="height:0px;width:0px;"></div>'),e=t(".screenCaptureIframe")),e.html(""),e.html('<object id="capture" type="application/x-hfxyz2" width="0" height="0"><param name="onerror" value="onerrorHandler" /><param name="onload" value="onloadHandler" /></object>')}},t.screenCapture=function(e){var t=new n(e);return t.init(),t}}(window,$),function(e,t,i){var n=function(e){this.defaults={},this.options=t.extend({},this.defaults,e)};n.prototype={screenCapture:function(){screenCapture=t.screenCapture({os:userDatas.getOperatingSystem(),draw:function(e){uccPcEvent.uploadImgFromPaste("data:image/.png;base64,"+e,"paste",!1)},download:function(){Alert.show(lang.screenCaptureDownload),e.open("/any800/Any800Capture.html","Any800Capture")}})},leaveCover:function(){0==t(".leaveMessage").length&&(t(".dialogue-area").append("<div class='leaveMessage'>"+lang.offlineMessage+"</div>"),t(".leaveMessage").css({position:"absolute",bottom:"130px",left:"13px"}),setInterval(function(){t(".leaveMessage").fadeIn(500).fadeOut(500)},1e3))},openCover:function(){t(".leaveMessage").remove()},repaceImg:function(){var e=t(".contentMessage").last().find("img[originsrc]");e.length>0&&e.attr("src",e.attr("originsrc"))},rightClickOnImg:function(){t(".dialogue-record").delegate(".contentMessage .content img","mousedown",function(e){if(!t(this).attr("emotions")&&3==e.which)return uccPcEvent.rightClick(e.clientX,e.clientY,t(this).attr("originsrc")||t(this).attr("src")),e.preventDefault(),!1}),t(".dialogue-record").delegate(".contentMessage .content img","mouseup",function(e){if(!t(this).attr("emotions"))return e.preventDefault(),!1}),t(".dialogue-record-c").on("scroll",function(){t(".rightClick").remove()}),t(e).resize(function(e){t(".rightClick").remove()})},rightClick:function(i,n,o){0==t(".rightClick").length&&(t("body").append("<div class='rightClick'>"+lang.downloadImg+"</div>"),t(".rightClick")[0].oncontextmenu=function(){return!1}),t(".rightClick").css("top",n-2),t(".rightClick").css("left",i-2),t(".rightClick").unbind().on("click",function(){uccPcEvent.downloadOrigin(o).done(function(t){e.open(t)})})},downloadOrigin:function(e){var i=new t.Deferred,n=e.substring(e.lastIndexOf(".")),o=n.toLowerCase(),a=e.substring(0,e.lastIndexOf("."));if(a.indexOf("origin")>-1)return i.resolve(e);if(".jpg"==o||".jpeg"==o||".png"==o||".bmp"==o){var s=a+"origin"+n,r=new Image;if(r.src=s,r.complete)return i.resolve(s);r.onload=function(){return i.resolve(s)},r.onerror=function(){return i.resolve(e)}}return i.promise()},cacheImg:function(e,t,i){var n=new Image;return n.src=t,n.complete?void i.call(n):void(n.onload=function(){i.call(n)})},unload:function(){t(e).unload(function(){storage.get("offChat")==ucc.browserId&&storage.set("offChat",!0),webSocket.isWork&&webSocket.websocket.close()})},messageChange:function(){t("#message").delegate(".message_news","click",function(){t(this).data("url")&&e.open(t(this).data("url"))})},addEvent:function(){var i=this;t("body").delegate(".fanke-liuyan","click",function(){leaveMessage.show()}),t("#message").delegate(".dialogue-me .dialogue-in-c .content img,.dialogue-in .dialogue-in-c .content img","click",function(){"true"!=t(this).attr("emotions")&&showBigImgFun.showPic(t(this).attr("originsrc")||t(this).attr("src"))}),i.toolsEvnt(ucc.buttonList),i.rightClickOnImg(),t(".send").click(function(){(dialogue.islive()||robot.isUse)&&i.sendMsg()}),t("#close").click(function(){if(dialogue.islive()){var e=confirm(lang.closeChat);1==e&&(i.closeChat(),t("#close").css("cursor",""))}}),t(".ucc-logo-cancel").click(function(){if(dialogue.islive()){var n=confirm(lang.closeChat);1==n&&(i.closeChat(),t("#close").css("cursor",""))}else{var n=confirm(lang.closeWindow);1==n&&e.close()}}),t(document).keydown(function(e){i.glint.clear(),(dialogue.islive()||robot.isUse)&&i.sendKeyDown(e)}),t("body").click(function(){i.glint.clear()})},toolsEvnt:function(i){for(var n=this,o=0;o<i.length;o++)switch(i[o].type){case 1:t(".tool1").show();var a=ucc.aDset,s="echatManager.do?method=showFaq&companyPk="+ucc.companyPk+"&langPk="+ucc.defaultLangPk+"&codeKey="+a.vcwColor;tab.add("1",lang.problem,s),t(".tool1").click(function(){tab.add("1",lang.problem,s)});break;case 2:t(".tool2").show();break;case 3:t(".tool3").show();break;case 4:t(".tool4").show(),t(".tool4 .screenCapture").click(function(){screenCapture.use(),t(".screenCaptureCheckBox").hide()}),t(".tool4 .screenCaptureCheck").click(function(){t(".screenCaptureCheckBox").toggle()}),t(".screenCaptureCheckBox").click(function(e){t(".screenCaptureCheckBox .checked").toggleClass("active"),datas.set("screenCapture",t(".screenCaptureCheckBox .checked").hasClass("active")),t(".screenCaptureCheckBox").hide()}),t(e).click(function(e){var i=t(e.target);0==i.closest(t(".screenCaptureCheckBox")[0]).length&&t(".screenCaptureCheckBox").hide()});break;case 5:t(".tool9").show().click(function(){n.saveDialog()});break;case 6:t(".tool6").show().click(function(){satisfaction.show()});break;case 7:t(".tool5").click(function(){n.createSendFile()});break;case 8:t(".tool7").show().click(function(){n.sendAudioRq()});break;case 12:t(".tool10").show(),n.sendPicture(),t("#picUpload>div").width(26).height(21)}},sendScreen:function(){screenCapture.use()},saveDialog:function(){var i=this.getChatContent();i=encodeURIComponent(i);var n;if(e.frames&&e.frames.downloadFrame);else{try{n=document.createElement('<iframe name="downloadFrame" style="display:none;">')}catch(o){n=document.createElement("iframe"),n.style="display:none;",n.setAttribute("style","display:none;")}n.id="downloadFrame",n.name="downloadFrame",n.width=0,n.height=0,n.marginHeight=0,n.marginWidth=0;var a=document.getElementsByTagName("body").item(0);a.insertBefore(n,a.firstChild)}var s;if(t("#downloadForm").length>0)s=t("#downloadForm")[0];else{s=document.createElement("form");var r="post";s.setAttribute("method",r),s.setAttribute("name","downloadForm"),s.setAttribute("id","downloadForm"),s.setAttribute("action","echat/downloadChat.jsp"),s.setAttribute("target","downloadFrame")}var c;t("#htmlContent").length>0?c=t("#htmlContent")[0]:(c=document.createElement("input"),c.setAttribute("type","hidden"),c.setAttribute("name","htmlContent"),c.setAttribute("id","htmlContent")),c.setAttribute("value",i),s.appendChild(c);var l=document.getElementsByTagName("body").item(0);l.insertBefore(s,l.firstChild),s.submit()},getChatContent:function(){var e='<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>'+lang.recored+"</title>";e+="<link type='text/css' rel='stylesheet' href='"+baseUrl+"/style/css/echat/ucc.css'/></head><body style='overflow:auto;visibility: visible;'>";var i=t("#message").clone();return i.children("#historyChat,#moreHistory").remove(),e+=i.html().replace(/\/any800\/style\/images/g,baseUrl+"/style/images"),e+="</body></html>"},createSendFile:function(){var e=this,i=t(".label-pop .sendFile");if(0==i.length){var n="<div class='sendFile'><div class='name'></div><div class='ok'>"+lang.upload.searchFile+"</div><div class='submit'>"+lang.upload.sendFile+"</div></div>";t(".label-pop").append(n),e.uploader=t(".label-pop .sendFile .ok").uploadFile({size:10485760,uploadType:"all",other:function(e,i,n){t(".label-pop .sendFile .ok").find(".fileup").attr("action","/any800/echatManager.do?method=uploadFile&fromType=visitor&chatId="+ucc.chatID),t(".label-pop .sendFile .name").html(i)},callback:function(e,i,n,o){var a=e,s=lang.upload.sendedFile+'<a class = "download" target="_blank" href="'+a+'">'+lang.upload.downloadFile+"</a>";(a.indexOf(".jpg")>-1||a.indexOf(".bmp")>-1||a.indexOf(".jpeg")>-1||a.indexOf(".gif")>-1||a.indexOf(".png")>-1)&&(s="<img id='img' "+(o?"originsrc='"+o+"'":"")+" data-symbol='"+i+"' src='"+a+"'>"),dialogue.sendMessage(s,""),t(".label-pop .sendFile .name").html(""),t(".sendFile").hide(),t(".tool5").removeClass("click")},error:function(e,t,i,n){i&&Alert.show(i),"type"==e?Alert.show(lang.upload.uploadFileError_1):"size"==e?Alert.show(lang.upload.uploadFileError_2):Alert.show(lang.upload.uploadFileError_3)}}),t(".label-pop .sendFile .submit").on("click",function(){""!=t(".label-pop .sendFile .name").html()?e.uploader.submit(""):Alert.show(lang.upload.uploadFileMsg)})}else t(".sendFile").toggle(),t(".label-pop .sendFile .name").html(""),e.uploader&&e.uploader.create()},sendAudioRq:function(){dialogue.sendMessage("vistorSendRq","vistorSendRq")},sendPicture:function(){t("#picUpload").uploadFile({size:5242880,uploadType:"image",other:function(e,i,n){t("#picUpload").find(".fileup").attr("action","/any800/echatManager.do?method=uploadFile&fromType=visitor&chatId="+ucc.chatID),e.submit(n)},callback:function(e,i,n,o){setTimeout(function(){var i="<img "+(o?"originsrc='"+o+"'":"")+" src='"+e+"'>";t(".dialogue-area-write").append(i)},500)},error:function(e,t,i,n){i&&Alert.show(i),"type"==e?Alert.show(lang.upload.uploadFileError_4):"size"==e?Alert.show(lang.upload.uploadFileError_5):Alert.show(lang.upload.uploadFileError_3)}})},sendMsg:function(){var e=this;if(datas.get("canSend")){datas.set("canSend",!1);var i=e.getMsgStr(t(".dialogue-area-write"));if("unable"==i||""==i)return void datas.set("canSend",!0);var n=new RegExp("<br>","g");if(i.replace(n,"")){var o=/<img\s*src="data:image\/.{0,5};base64,/i;dialogue.islive()?(o.test(i)?t.ajax({type:"POST",async:"false",url:"echatManager.do?method=getScreenshotSrc&chatId="+ucc.chatID,data:{sendMsg:i},dataType:"json"}).done(function(e){if(e.success){var t=e.content;uccPcEvent.storeImg(t).done(function(e){i='<img id="img" src="'+e+'">',dialogue.sendMessage(i),detectWeb.msgPush("visitor",i)})}else e.errorMsg&&Alert.show(e.errorMsg)}):(dialogue.sendMessage(i),detectWeb.msgPush("visitor",i)),datas.set("openSatisfactionAfterCloseChat",!0)):robot.isUse&&robot.check(i.replace(/\&nbsp;/g,"").replace(/\s+/g,"").replace(/\<p><\/p>/g,"").replace(/\<br>/g,""))}setTimeout(function(){e.clearSend(),datas.set("canSend",!0)},10)}},getMsgStr:function(e){var i=e.clone(),n=e.html();n=changeFaceFun.imgToIco(i.html());var o=/<a[^>]*href=['"]([^"]*)['"].*?[^>]*>(.*?)<\/a>/g,a=n.match(o);if(a)for(u=0;u<a.length;u++)n=n.replace(a[u],RegExp.$2);n=sensitive.get(n);try{var s=n.replace(/\&nbsp;/g,"").replace(/\<p><\/p>/g,"");0==s.length&&(n=s)}catch(r){}var c=/<img\s*src="data:image\/.{0,5};base64,/i;n=n.replace(/\r\n/g,"<br>").replace(/\n/g,"<br>");var l=new RegExp("<br>","g");if(n=n.replace(/<div\s*>|<\/div>|<span\s*>|<\/span>|<p\s*>|<\/p>/g,"").replace(/<\/?[p|P][^>]*>/g,""),!c.test(n)&&n.replace(l,"")){if(n.length>1e3)return Alert.show(lang.dialogue.maxLength),"unable";n=n.replace(/<\/?[p|P][^>]*>/g,"")}n.replace(l,"")&&(i.find("p").each(function(){t(this).replaceWith(t(this).html()+"<br/>"),n=i.html()}),i.find("img").each(function(){if("faceIco"==t(this).attr("name")){var e=this.id;t(this).replaceWith(e),n=i.html()}}));var d=n.match(/<img.*?>/g);if(d&&d.length>0){for(var u in d)d[u]&&!isNaN(Number(u))&&(n=n.replace(d[u],"</span>"+d[u]+"<span>"));n="<span>"+n+"</span>"}return i=t("<div>"+n+"</div>"),i.find("span").each(function(){t(this).replaceWith(t(this).html().replace(/ /gi,"&nbsp;").replace(/\n/gi,"<br>")),n=i.html()}),i.html()},clearSend:function(){var i=e.navigator.userAgent;/MSIE 8/g.test(i)?t(".dialogue-area-write")[0].innerHTML="&nbsp;":t(".dialogue-area-write").html(""),t(".dialogue-area-write").focus()},closeChat:function(){dialogue.islive()&&(1==ucc.BasicSetting.jump&&datas.get("openSatisfactionAfterCloseChat")&&!datas.get("hasSatisfaction")&&satisfaction.show(),dialogue.end(5),t("#face_08").css("display","none"),t(".sendFile").hide())},sendKeyDown:function(t){var i=this,t=arguments[0]||e.event||t;t.target||e.event.srcElement;if(88==t.keyCode&&t.ctrlKey&&t.shiftKey)return!1;if(13==t.keyCode&&0==ucc.sendKey){if(!t.ctrlKey&&!t.shiftKey)return i.sendMsg(),!1;try{var n;return n=document.createRange?document.createRange():document.selection.createRange(),n.text="\r\n",n.collapse(!1),n.select(),!1}catch(o){}}else if(13==t.keyCode&&1==ucc.sendKey){if(t.ctrlKey||t.shiftKey)return i.sendMsg(),!1;try{var n;return n=document.createRange?document.createRange():document.selection.createRange(),n.text="\r\n",n.collapse(!1),n.select(),!1}catch(o){}}},glint:{time:0,title:document.title,timer:null,titleGlitterFlag:0,show:function(){var e=this,t=this.title.replace("【　　　】","").replace("【新消息】","");return this.timer=setTimeout(function(){e.time++,e.show(),e.time%2==0?document.title="【"+lang.newMessage+"】"+t:document.title="【　　　】"+t},600),[this.timer,this.title]},clear:function(){clearTimeout(this.timer),document.title=this.title,this.titleGlitterFlag=0}},titleGlitter:function(){0==this.glint.titleGlitterFlag&&this.glint.show(),this.glint.titleGlitterFlag=1},closeChatSatisfaction:function(){1==ucc.BasicSetting.jump&&datas.get("openSatisfactionAfterCloseChat")&&!datas.get("hasSatisfaction")&&satisfaction.show()},scrollTop:function(){t(".dialogue-record-c")[0]&&(t(".dialogue-record-c")[0].scrollTop=t(".dialogue-record-c")[0].scrollHeight)},showAdvertisement:function(){var e=parseInt(ucc.advertisement.isVisable),t=parseInt(ucc.advertisement.accessDisplay),i=parseInt(ucc.advertisement.visitorWaiting),n=parseInt(ucc.advertisement.beforeDisplayTime);if(1==e&&(2==t||1==t)){if(ucc.advertisement.startTime&&ucc.advertisement.endTime){var o=ucc.advertisement.startTime;o.indexOf(":")>-1&&(o=o.replace(":",""));var a=ucc.advertisement.endTime;a.indexOf(":")>-1&&(a=a.replace(":",""));var s=new Date,r=s.getHours()<10?"0"+s.getHours():s.getHours(),c=s.getMinutes()<10?"0"+s.getMinutes():s.getMinutes(),l=r+""+c}var d=new RegExp("&quot;","g");parseInt(o)<=parseInt(l)&&parseInt(l)<=parseInt(a)&&(2==i?setTimeout(function(){dialogue.showMsg({msgid:"",date:(new Date).getTime(),content:ucc.advertisement.content.replace(d,'"'),from:"client",status:0,saveIn:1})},1e3*n):dialogue.showMsg({msgid:"",date:(new Date).getTime(),content:ucc.advertisement.content.replace(d,'"'),from:"client",status:0}))}},showFile:function(e){var i=t(".tool5");if(0!=i.length){if("on"==e){t(".tool5").show(),storage.set("canSendFile",!0);var n=lang.upload.openUploadFile}else{t(".tool5").hide(),t(".sendFile").hide();var n=lang.upload.closeUploadFile;storage.set("canSendFile",!1)}dialogue.showSysMsg(n)}},openWin:function(e){t("<div>"+e+"</div>").find("a").each(function(){var e=t(this).attr("href"),i=t(this).text(),n=lang.openNewWindow.test(i);e&&!n&&tab.add(i,i,e,"1")})},saveTopicType:function(e){t.ajax({type:"POST",url:"echatManager.do",data:{method:"saveTopicType",topicType:e,chatId:ucc.chatID,companyPk:ucc.companyPk},dataType:"json"})},showAudio:function(){t("audio").each(function(e,i){if(!t(i).parent().hasClass("audiojs")){var n=t(this);audiojs.helpers.whenError=function(){var e=t(".dialogue-in-c").find("a[placeholder]");e.html(lang.downloadAudio)},audiojs.create(n)}})},reconnectClick:!1,initFaceJs:function(){function i(e,i){fontStyle;1==e?"weight"==i?(t(".dialogue-area-write").css("fontWeight","bold"),fontStyle.set("fontWeight","bold")):"em"==i?(t(".dialogue-area-write").css("font-style","italic"),fontStyle.set("fontStyle","italic")):"decoration"==i&&(t(".dialogue-area-write").css("text-decoration","underline"),fontStyle.set("textDecoration","underline")):2==e&&("weight"==i?(t(".dialogue-area-write").css("fontWeight","normal"),fontStyle.set("fontWeight","normal")):"em"==i?(t(".dialogue-area-write").css("font-style","normal"),fontStyle.set("fontStyle","normal")):"decoration"==i&&(t(".dialogue-area-write").css("text-decoration","none"),fontStyle.set("textDecoration","none")))}t(".area-top-p span").showLabel(),t("#font1").click(function(){t("#font1-c").is(":hidden")?t("#font1-c").show():t("#font1-c").hide()}),t("#font2").click(function(){t("#font2-c").is(":hidden")?t("#font2-c").show():t("#font2-c").hide()}),t("#font1-c span").click(function(){var e=t(this).text();t("#font1").text(e),t("#font1-c").hide(),t(".dialogue-area-write").css("font-family",e),fontStyle.set("fontFamily",e)}),t("#font2-c span").click(function(){var e=t(this).text();t("#font2").text(e),t("#font2-c").hide(),t(".dialogue-area-write").css("font-size",e+"px"),t(".dialogue-area-write").css("line-height",e+"px"),fontStyle.set("fontSize",e+"px"),fontStyle.set("lineHeight",e+"px")}),t(".dialogue-area-top .font").toggle(function(){t(this).addClass("font-current-click");var e=t(this).attr("id");i(1,e)},function(){t(this).removeClass("font-current-click");var e=t(this).attr("id");i(2,e)}),t("#font-color").click(function(){fontStyle;t("#color_picker").colorPicker({defaultColor:fontStyle.get("defaultColor")?fontStyle.get("defaultColor"):13,columns:14,click:function(e,i){t(".dialogue-area-write").css("color",e),t("#font-color").css("background-color",e),fontStyle.set("color",e),fontStyle.set("defaultColor",i)}}).toggle()}),t("#font-color").click(),t("#color_picker").hide(),t(".tool4").toggle(function(){t(this).addClass("click")},function(){t(this).removeClass("click")}),t(".tool5").toggle(function(){t(this).addClass("click")},function(){t(this).removeClass("click")}),t(".tool7").toggle(function(){t(this).addClass("click")},function(){t(this).removeClass("click")}),t(".send-key-c p").click(function(){t(this).children(".send-ok").addClass("send-ok-ok"),ucc.sendKey=t(this).children(".send-ok").attr("data-send"),storage.set("sendKey",ucc.sendKey),t(this).siblings(".send-key-c p").children(".send-ok").removeClass("send-ok-ok"),t(".send-key").hide()}),t(".send-key-c p .send-ok[data-send='"+storage.get("sendKey")+"']").click(),t(".send-select").click(function(i){var n=e.event||i;n.stopPropagation?n.stopPropagation():n.cancelBubble=!0,t(".send-key").show()}),t(".send-key").click(function(t){var i=e.event||t;i.stopPropagation?i.stopPropagation():i.cancelBubble=!0}),t(".tool3").click(function(i){t(".tool2-c").hide(),t(".tool2").removeClass("click");var n=e.event||i;n.stopPropagation?n.stopPropagation():n.cancelBubble=!0,t(".face-c").is(":hidden")?(t(".face-c").show(),t(this).addClass("click")):(t(".face-c").hide(),t(this).removeClass("click")),t(".lable3").hide()}),t(".tool2").click(function(i){t(".face-c").hide(),t(".tool3").removeClass("click");var n=e.event||i;n.stopPropagation?n.stopPropagation():n.cancelBubble=!0,t(".tool2-c").is(":hidden")?(t(".tool2-c").show(),t(this).addClass("click")):(t(".tool2-c").hide(),t(this).removeClass("click")),t(".lable2").hide()}),t(".face-c").click(function(t){var i=e.event||t;i.stopPropagation?i.stopPropagation():i.cancelBubble=!0}),t(document).click(function(){t(".send-key").hide(),t(".face-c").hide(),t(".tool3").removeClass("click")}),t(".messagerecord").click(function(){var e="historyOperator.do?method=moreHistoryDialogue&visitorId="+userDatas.getVisitorInfo().visitorId+"&companyPk="+ucc.companyPk,t="消息记录";tab.add(t,t,e)}),t("#tab_title li[index=1] a,#tab_title li[index=2] a").remove();var n=this;t("#message").delegate(".reconnectID","click",function(){dialogue.islive()||datas.get("hasInQueue")||n.reconnectClick||(n.reconnectClick=!0,t.ajax({type:"POST",url:"./echat.do",data:{method:"closeEchat",chatID:ucc.chatID,url:dialogue.getAttr("remoteUrl"),opname:dialogue.getAttr("operatroName")?dialogue.getAttr("operatroName"):""},success:function(e){},dataType:"json",async:!1,cache:!1}),t.ajax({url:"./echatManager.do",data:{method:"initChatId",companyPk:ucc.companyPk,vid:userDatas.getVisitorInfo().visitorId,hjUserData:params.hjUserData},dataType:"json",async:!1,cache:!1}).done(function(e){try{ucc.chatID=e.chatID,storage.set("oldChatId",e.chatID),ucc.browserId=(new Date).getTime(),localHistory.saveCurrent(),datas.set("openSatisfactionAfterCloseChat",!1),datas.set("hasSatisfaction",!1),datas.set("adv",!1);userDatas.getJsonStr();uccPcInit.initFunc(),uccPcLogic.addmonitorJs(),detectWeb.setIsReconnection(!0),queue.reqStartQueue(storage.get("businessId"),storage.get("businessName"),detectWeb.getIsReconnection()),n.reconnectClick=!1}catch(e){}}).fail(function(e){n.reconnectClick=!1,dialogue.showSysMsg(lang.errorNetWork)}))}),t("img[defsrc]").each(function(e,i){t(this).attr("src",t(this).attr("defsrc"))})},initPaste:function(){var i=this;t.fn.pasteFun=function(){var e=t(this);try{e.designMode="On"}catch(o){}e.bind({paste:function(o){if(dialogue.islive()){var a=!1;if(o.clipboardData||o.originalEvent){var s=o.clipboardData||o.originalEvent.clipboardData;if(s&&s.items){var r=s.items,c=r.length,l=null;a=!0;for(var d=0;d<c;d++)r[d].type.indexOf("image")!==-1&&(l=r[d].getAsFile());if(null!==l){o.preventDefault();var u=new FileReader;u.onload=function(e){var t=e.target.result;i.uploadImgFromPaste(t,"paste",a)},u.readAsDataURL(l)}}else setTimeout(function(){var n,o=e.find("img"),s=o.length,r="";for(n=0;n<s;n++)"img"!==o[n].id&&o[n].src.length>100&&(r=o[n].src,t(o[n]).remove());i.uploadImgFromPaste(r,"paste",a)},1)}else setTimeout(function(){var n,o=e.find("img"),s=o.length,r="";for(n=0;n<s;n++)"img"!==o[n].id&&o[n].src.length>100&&(r=o[n].src,t(o[n]).remove());i.uploadImgFromPaste(r,"paste",a)},1);setTimeout(function(){var e=t(".dialogue-area-write").html();e=changeFaceFun.imgToIco(e),e=t("<div>"+e+"</div>").text();var i={"<":"&lt;",">":"&gt;"," ":"&nbsp;","&":"&amp;",'"':"&quot;"};e=e.replace(/(<|>| |&|")/gi,function(e,t){return i[t]}),e=changeFaceFun.icoToImg(e),t(".dialogue-area-write").html(e),n(t(".dialogue-area-write")[0])},1)}}})};var n=function(t){if(e.getSelection){t.focus();var i=e.getSelection();i.selectAllChildren(t),i.collapseToEnd()}else if(document.selection){var i=document.selection.createRange();i.moveToElementText(t),i.collapse(!1),i.select()}};navigator.appVersion.split(";")[1]&&"MSIE9.0"==navigator.appVersion.split(";")[1].replace(/[ ]/g,"")||t(".dialogue-area-write").pasteFun()},uploadImgFromPaste:function(e,i,n){var o=this,a=/data:image\/.{0,5};base64,/i;a.test(e)&&t.ajax({type:"POST",async:"false",url:"./echatManager.do?method=getScreenshotSrc&fromType=visitor&chatId="+ucc.chatID,data:{sendMsg:e},dataType:"json"}).done(function(e){if(e.success){var i=t("<div>"+e.content+"</div>").find("img"),n=i.attr("src"),a=i.attr("originsrc")||i.attr("src");o.storeImg(n).done(function(e){var i='<img id="img" src="'+e+'" '+(a?"originsrc='"+a+"'":"")+">";t(".dialogue-area-write").append(i)})}else e.errorMessage&&Alert.show(e.errorMessage)})},storeImg:function(e){var i=new t.Deferred,n=new Image;return n.src=e,n.complete?i.resolve(e):(n.onload=function(){return i.resolve(e)},n.onerror=function(){return i.resolve(e)},i.promise())}},t.uccPcEvent=function(e){var t=new n(e);return t}}(window,jQuery),function(e,t,i){var n=function(e){this.defaults={},this.options=t.extend({},this.defaults,e)};n.prototype={initFront:function(){dialogue.islive()||(robot.isUse?uccPcLogic.checkRobot():(workTime.show(),uccPcLogic.loadScheme()),uccPcLogic.initWelcome())},showBusinessList:function(e){var i=this;if(!dialogue.islive()){var n="";
if(t("#bl").html(""),datas.get("iswork")){var o=bList.generate(e);if(o)if(o.access){if(o.online)return bList.setSelect(o.pk,o.name),storage.set("businessId",o.pk),storage.set("businessName",o.name),void queue.reqStartQueue(o.pk,o.name);if(t("#message").html("<div class='service-info'><div style='line-height:18px;'>"+langTip.langMap[1].content+"<br/><p id='bl'></p>"+langTip.langMap[2].content+"<span class='dialogue-a' id='fangke-liuyan'>"+lang.leaveMessageStr+"</span></div></div>"),t("#fangke-liuyan").click(function(){leaveMessage.show()}),!o.name)return;var a=lang.businessList.offline;n+='<p><a data-online="'+lang.businessList.offline+'" name="'+o.name+'" data-pk="'+o.pk+'">'+o.name+"【"+lang.businessList.offline+"】</a></p>"}else{o.root||(n+='<p><a class="back" >'+lang.businessList.backTo+"</a></p>");for(var s=o.list,r=0;r<s.length;r++){var c=s[r],a="online"==c.type?lang.businessList.online:lang.businessList.offline;n+='<p><a data-online="'+a+'" name="'+c.item.name+'" data-pk="'+c.item.pk+'">'+c.item.name+"【"+a+"】</a></p>"}}t("#bl").html(n),t(".service-info").find(".back").unbind().click(function(){i.showBusinessList(bList.getParentPk(e))}),t(".service-info").find("a[name]").unbind().click(function(){var e=t(this).data("pk"),n=t(this).attr("name");if(bList.hasList(e).length>0)return void i.showBusinessList(e);workTime.show();t(this).html();t(this).data("online")==lang.businessList.online?(bList.setSelect(e,n),queue.reqStartQueue(e,n)):leaveMessage.show()}),t(".service-info").find("a[class='dialogue-a']").click(function(){leaveMessage.show()})}}},loadScheme:function(){var e=this;pageLoad.getDepartment().done(function(){bList=t.businessList({businessList:ucc.businessList,aDset:ucc.aDset}),e.showBusinessList("-1")})},checkRobot:function(){t(".send").removeAttr("disabled"),t(".dialogue-area-write").attr("contentEditable","true")},initWelcome:function(){dialogue.islive()||(robot.isUse?langTip.show("2","1"):(langTip.show("1","1"),langTip.show("1","2")))},toggleV:function(){if(1==ucc.BasicSetting.need){var e=storage.get("isSave");0!=e&&visitorInformation.show()}},initFont:function(){t(".dialogue-area-write").css("color",fontStyle.get("color")),t(".dialogue-area-write").css("font-weight",fontStyle.get("fontWeight")),t(".dialogue-area-write").css("font-style",fontStyle.get("fontStyle")),t(".dialogue-area-write").css("text-decoration",fontStyle.get("textDecoration")),t(".dialogue-area-write").css("font-size",fontStyle.get("fontSize")),t(".dialogue-area-write").css("line-height",fontStyle.get("lineHeight")),t(".dialogue-area-write").css("font-family",fontStyle.get("fontFamily")),t(".tool2-c #font1-c span").each(function(e,i){t(this).text()==fontStyle.get("fontFamily")&&t(this).click()}),t(".tool2-c #font2-c span").each(function(e,i){t(this).text()==fontStyle.get("fontSize")&&t(this).click()}),"normal"!=fontStyle.get("fontWeight")&&t(".tool2-c .tool-font3 #weight").click(),"normal"!=fontStyle.get("fontStyle")&&t(".tool2-c .tool-font3 #em").click(),"none"!=fontStyle.get("textDecoration")&&t(".tool2-c .tool-font3 #decoration").click(),"none"!=fontStyle.get("textDecoration")&&t(".tool2-c .tool-font3 #decoration").click(),"#000000"!=fontStyle.get("color")&&t("#font-color").css("background-color",fontStyle.get("color"))},addmonitorJs:function(){setTimeout(function(){dialogue.islive()||(monitor=t.monitor({storage:storage,companyPk:ucc.companyPk,userDatas:userDatas}))},3e3)}},t.uccPcLogic=function(e){var t=new n(e);return t}}(window,jQuery),function(e,t,i){var n=function(e){this.defaults={},this.options=t.extend({},this.defaults,e)};n.prototype={init:function(){uccPcInit.initLang().done(function(){if("undefined"!=typeof custom&&custom)try{var e=JSON.parse(custom),i="./custom/"+(e.functionType||"")+"/pc.js";t.ajaxJs(i,!1).done(function(){t(".ucc").html(""),t("#pcImpl").tmpl(lang).appendTo(".ucc")}),langControl.addBtn()}catch(n){console.error(n)}uccPcInit.initBasic(),uccPcInit.initData().done(function(){uccPcInit.initFunc(),uccPcLogic.initFront(),uccPcEvent.addEvent(),uccPcEvent.unload(),uccPcEvent.messageChange(),uccPcLogic.toggleV(),skin.setTab(),uccPcEvent.initFaceJs(),uccPcEvent.initPaste(),uccPcEvent.screenCapture(),uccPcLogic.initFont(),uccPcInit.initSatifaction(),uccPcInit.initLocalHistory(),t("input, textarea").placeholder()})})},initLang:function(){var e=new t.Deferred;return storage=t.storage({companyPk:ucc.companyPk}),langControl=t.langControl({langList:ucc.langs,storage:storage,addBtn:function(){t(".dialogue-area .dialogue-area-top").append("<div class='langSwitch'><span>"+("en"==langControl.c?"中":"EN")+"</span></div>"),langControl.insertStyle(".langSwitch{float: left;margin-top: 4px;margin-left: 8px;border: 1px solid #bbafaf;padding: 0;border-radius: 50%;width: 20px;height: 20px;cursor: pointer;}.langSwitch span{display: inline-block;font-size: 12px;width: 20px;text-align: center;color:#bbafaf;line-height: 18px;}")}}),langControl.loadLangJs(langControl.c).done(function(){if(lang=langControl.langs[langControl.c],t("#pcImpl").tmpl(lang).appendTo(".ucc"),langControl.addBtn(),langControl.c){var i=langControl.langList[langControl.c].pk;if(ucc.defaultLangPk==i)return e.resolve();pageLoad.getLangAndMessageSettings(langControl.langList[langControl.c].pk).done(function(){e.resolve()})}}),e.promise()},initBasic:function(){params=t.getParameter(),Alert=t.Alert(),showBigImgFun=t.showBigImg(),showBigImgFun.init(),msgdb=t.msgdb(),datas=t.db({storage:storage}),localHistory=t.localHistory({storage:storage}),localHistory.init(),tab=t(".tab_info").tab({relatedEl:t(".dialogue")}),systemInfo=t("#sysmsg").systemInfo(),userDatas=t.userDatas({param:params,storage:storage,storageVisitor:"visitor",storageIpStr:"ipStr",storageChatNum:"chatNum",companyPk:ucc.companyPk,aDset:ucc.aDset,businessId:"",businessName:"",visitorPre:lang.userDatas.visitorPre}),skin=t.setSkin({aDset:ucc.aDset}),visitLimit=t.visitLimit({open:params.vl?params.vl:1,storage:storage}),visitLimit.init(),fontStyle=t.fontStyle({storage:storage}),workTime=t.workTime({BasicSetting:ucc.BasicSetting,ExtraSetting:ucc.ExtraSetting,workStr:lang.workTime.server+"【$1】<br>"+lang.workTime.clickNotice+"<a href='javascript:void(0)' class='dialogue-a fanke-liuyan'>"+lang.workTime.btn+"</a><br>"+lang.workTime.notice,holidayStr:lang.workTime.holiday+"【$1】<br>"+lang.workTime.clickNotice+"<a href='javascript:void(0)' class='dialogue-a fanke-liuyan'>"+lang.workTime.btn+"</a><br>"+lang.workTime.notice,lang:lang.workTime,show:function(e){if(e&&0==t(".pop_bg").length){var i='<div class="dialogue-in"><p class="dialogue-pic"><img src="./style/css/images/service.png"></p><div class="dialogue-in-r"><p class="in-name">'+lang.operator+'</p><div class="dialogue-in-c"><span class="d-dot1"><img src="./style/css/images/d-dot1.png"></span><p><span>'+e+"</span></p></div></div></div>";t("#message").html(i),datas.set("iswork",!1),setTimeout(function(){t(".pop_msg").slideDown("slow")},300)}}}),sensitive=t.sensitive({vocabulary:ucc.vocabulary}),changeFaceFun=t.changeFace({after:function(){for(var e=this.imgIco,i="",n=0,o=e.length;n<o;n++){var a=e[n][0];i+="<p><span class='face-pic'>"+a+"</span></p>"}t(".face-c").html(i),t(".face-pic").hover(function(){t(this).addClass("hover"),t(this).siblings(".face-text").show()},function(){t(this).removeClass("hover"),t(this).siblings(".face-text").hide()}),t(".face-pic").click(function(){t(".tool3").removeClass("click"),t(".face-c").hide();var e=t(this).find("img").clone();t(".dialogue-area-write").append(e)})}})},initData:function(){var e=new t.Deferred;return datas.set("canSend",!0),datas.set("iswork",!0),datas.set("hasInQueue",!1),ucc.sendKey=storage.get("sendKey")?storage.get("sendKey"):0,t.ajax({type:"POST",url:"./echatManager.do",data:{method:"initChatId",companyPk:ucc.companyPk,vid:userDatas.getVisitorInfo().visitorId,hjUserData:params.hjUserData,visitorInfo:params.visitorInfo},dataType:"json",async:!1,cache:!1}).done(function(e){ucc.chatID=e.chatID,ucc.browserId=(new Date).getTime(),storage.get("oldChatId")!=e.chatID?(storage.get("msgObjCurrentChat")&&t.ajax({type:"POST",url:"./echat.do",async:"false",data:{method:"closeEchat",chatID:storage.get("oldChatId"),url:storage.get("msgObjCurrentChat").url,opname:datas.get("opName")?datas.get("opName"):""},success:function(e){},dataType:"json"}),uccPcLogic.addmonitorJs(),localHistory.saveCurrent(),storage.set("oldChatId",e.chatID),datas.set("openSatisfactionAfterCloseChat",!1),datas.set("hasSatisfaction",!1),datas.set("adv",!1)):"connnected"==e.state&&(storage.set("offChat",ucc.browserId),storage.set("browserId",ucc.browserId))}),webSocket=t.webSocket({path:"/any800/UccWebSocket/",isWs:ucc.isWs,visitorId:userDatas.getVisitorInfo().visitorId,message:function(e,t,i){e==ucc.chatID&&("object"==typeof t&&(t=JSON.stringify(t)),msgdb.get(i)||(dialogue.showMsg({msgid:i,date:(new Date).getTime(),content:t,from:"client"}),detectWeb.msgPush("customer",t),uccPcEvent.titleGlitter(),TimeoutList.startALLTimeout()))},deal:function(e,i,n){if(i==ucc.chatID)if("CUTOMER_IS_INVITED"==e)if(dialogue.islive()){if(dialogue.toolFun(!0),dialogue.showMsg({msgid:"",date:(new Date).getTime(),content:n,from:"client",saveIn:1}),detectWeb.getIsReconnection()){var o="["+detectWeb.getMsgs(5).join(",")+"]";dialogue.sendMessage(o,"offLineMessage")}TimeoutList.startALLTimeout()}else dialogue.setAttr("CUTOMER_IS_INVITED",n);else if("CLOSE"==e)detectWeb.getIsInitiate()?dialogue.end(6):dialogue.end(2),t("#face_08").css("display","none"),t(".sendFile").hide();else if("CLOSE_CUSTOMER"==e)dialogue.end(3),t("#face_08").css("display","none"),t(".sendFile").hide();else if("CLOSE_VISITOR"==e)dialogue.islive()&&(langTip.show(langTip.type.system,langTip.key.no_answer_close),t("#face_08").css("display","none"),t(".sendFile").hide());else if("OPERATION_TIPS"==e)if("pushsatisfaction"==n.params.opType)satisfaction.show();else if("sendFileEntry"==n.params.opType)uccPcEvent.showFile(n.params.flag);else if("getinfo"==n.params.opType)visitorInformation.show();else if("foreknowledge"==n.params.opType){var a=t(".reminder").length;if(0!=a)"1"==n.content?t(".reminder").show():t(".reminder").hide();else{var s='<div class= "reminder"><div class="rp"></div>'+lang.reminder+"</div>";t("body").append(s),t(".reminder").css({position:"absolute",bottom:"164px",left:"5px"})}}else"uploadfile"==n.params.opType&&dialogue.showMsg({msgid:"",date:(new Date).getTime(),content:n.content,from:"client",status:0});else if("CUSTOMER_NETWORK_INTERRUPT"==e)dialogue.end(7),t("#face_08").css("display","none"),t(".sendFile").hide();else if("CUTOMER_ISNOT_INVITED"==e)dialogue.showMsg({msgid:"",date:(new Date).getTime(),content:n,from:"client",status:0}),dialogue.end(0);else if("CUTOMER_REVOKE"==e){msgdb.set(n,"isRevoke",!0),changeWindow&&changeWindow.change(),localHistory.setCurrent(msgdb.db);var r=t("div[name="+n+"]");"none"!=r.css("display")&&(r.hide(),r.after("<div class='msg_back_success'>"+dialogue.getAttr("operatorName")+lang.dialogue.revoke+"</div>"))}else if("RECEIPT"==e)msgdb.set(n,"checkSend",1),t("div[name="+n+"] .msg_sending").hide(),t("div[name="+n+"] .msg_repeat").hide(),changeWindow&&changeWindow.change(),localHistory.setCurrent(msgdb.db);else if("VS_QUEUE_INDEX"==e){var c=n;c&&(1==c.success?queue.options.success(c):1==c.inqueue?queue.options.always(c):0==c.errorCode?queue.options.fail(c):0==c.server?queue.options.fail(c):1==c.inqueue?queue.options.always(n):queue.options.leave(c))}},connect:function(e){dialogue.islive()&&(e?(detectWeb.getIsInitiate()&&dialogue.showSysMsg(dialogue.options.msgList.reconnectSuc,!0),detectWeb.getIsInitiate()&&(dialogue.toolFun(!0),detectWeb.checkedSuccess())):detectWeb.getIsInitiate()||(dialogue.toolFun(!1),dialogue.showSysMsg(dialogue.options.msgList.reconnectFail,!0),detectWeb.checkedFail()))},confirmSend:function(e){setTimeout(function(){var i=msgdb.get(e);i&&0==i.checkSend&&t("div[name="+e+"] .msg_sending").show()},600),setTimeout(function(){var i=msgdb.get(e);i&&0==i.checkSend&&(t("div[name="+e+"] .msg_sending").hide(),t("div[name="+e+"] .msg_repeat").show(),msgdb.set(e,"checkSend",2),changeWindow&&changeWindow.change(),localHistory.setCurrent(msgdb.db))},3e3)},leaveCover:function(){uccPcEvent.leaveCover()},open:function(){uccPcEvent.openCover()}}),t("#message").delegate(".msg_repeat","click",function(){var e=t(this).parents(".contentMessage");if(e.attr("name")&&dialogue.islive()){e.attr("name");e.prev().hasClass("dialogue-date")&&e.prev().hide(),e.hide();var i=uccPcEvent.getMsgStr(e.find("span.content"));dialogue.sendMessage(i)}}),webSocket.init().done(function(){return e.resolve()}),e.promise()},initSatifaction:function(){satisfaction=t.satisfaction({dialogue:dialogue,companyPk:ucc.companyPk,langPk:ucc.defaultLangPk,chatId:ucc.chatID,title:lang.satisfaction.title,bottom:"<div class='bottom'><div class='cancel'>"+lang.cancel+"</div><div class='submit'>"+lang.submit+"</div></div>",lang:lang.satisfaction,top:lang.satisfaction.top,generate:function(){t(".satisfactionView .fr").each(function(e,i){var n=t(this);n.append('<input type="radio" name="fr"><span>'+n.attr("data-name")+"</span>")}),t(".satisfactionView .sr").each(function(e,i){var n=t(this);n.append('<input type="checkbox" class="srCheck" name="'+n.data("parent")+'"><span>'+n.attr("data-name")+"</span>")}),t(".satisfactionView .sr").hide(),t('.satisfactionView .fr input[name = "fr"]').click(function(){var e=t(this);t(".satisfactionView .sr ").hide(),t('.satisfactionView .sr input[name ="'+e.parents(".fr").data("pk")+'"]').parents(".sr").css("display","inline")}),t(".satisfactionView .fr input[type=radio]").first().click(),t(".satisfactionView .title .cross img,.satisfactionView .bottom .cancel").on("click",function(){satisfaction.cancel()}),t(".satisfactionView .bottom .submit").on("click",function(){var e=t('.satisfactionView .fr input[name = "fr"]').filter(":checked");if(0==e.length)return void Alert.show(lang.satisfaction.chooseSatisfaction);var i=e.parents(".fr").data("pk"),n="";if(satisfaction.getElementByParent(i).length>0){if(0==t('.satisfactionView .sr input[name = "'+i+'"]').filter(":checked").length)return void Alert.show(lang.satisfaction.chooseReason);t('.satisfactionView .sr input[name = "'+i+'"]').filter(":checked").each(function(){var e=t(this);n+=e.parents(".sr").data("pk")+","})}datas.set("hasSatisfaction",!0),satisfaction.submit({satisfactionPk:e.parents(".fr").data("parent"),optionPk:e.parents(".fr").data("pk"),satisfactionMemo:t(".satisfactionView .mome textarea").val()?t(".satisfactionView .mome textarea").val():"",nextSatisfactionPk:n})})}}),satisfaction.init(),satisfaction.hasSat||t(".tool6").hide()},initFunc:function(){visitorRobot=t.visitorRobot({companyPk:ucc.companyPk,visitorId:storage.get("visitor").visitorId,chatId:ucc.chatID,newAfter:function(e,i){var n="",o=i.split(""),a=function(e){for(var i=e,n=i.split(""),a=[],s=0,r=o.length;s<r;s++)""!=o[s]&&(a.push(o[s].toLowerCase()),a.push(o[s].toUpperCase()));a=t.unique(a);for(var s=0,r=n.length;s<r;s++){var c=n[s];a.indexOf(c)>-1&&(n[s]="<span>"+c+"</span>")}return n.join("")};for(var s in e)if(!isNaN(Number(s))){var r=e[s];n+='<div class="item" data-question="'+r+'">'+a(r)+"</div>"}n='<div class="visitorRobot">'+n+"</div>",t(".visitorRobot").remove(),t(".dialogue-area").append(n),t(".visitorRobot .item").on("click",function(){robot.click=!0,t(".dialogue-area-write").html(t(this).data("question")),t(".send").click(),t(".visitorRobot").hide()})},after:function(e){var i="";for(var n in e)if(!isNaN(Number(n))){var o=e[n],a=o.question,s=o.highlightedArray;s=s.insertSort(function(e,t){return e<t});for(var r=0,c=s.length;r<c;r++)a=a.substring(0,s[r],c)+"<div class='red'>"+a.charAt(s[r])+"</div>"+a.substring(s[r]+1,a.length);i+='<div class="item" data-question="'+o.question+'">'+a+"</div>"}i='<div class="visitorRobot">'+i+"</div>",t(".visitorRobot").remove(),t(".dialogue-area").append(i),t(".visitorRobot .item").on("click",function(){robot.click=!0,t(".dialogue-area-write").html(t(this).data("question")),t(".send").click(),t(".visitorRobot").hide()})},init:function(){var i=null;t(".dialogue-area-write").on("focus",function(){visitorRobot.ok&&(i&&(e.clearInterval(i),i=null),i=setInterval(function(){visitorRobot.ok?visitorRobot.check(t(".dialogue-area-write").text()):i&&(e.clearInterval(i),i=null)},1e3))}).on("blur",function(){i&&(e.clearInterval(i),i=null)})},hide:function(){t(".visitorRobot").remove()}}),visitorRobot.init(),detectWeb=t.detectWeb({period:30,after:function(){dialogue.end(6),t("#face_08").css("display","none"),t(".sendFile").hide()}}),TimeoutList=t.TimeoutList({msgdb:msgdb,ops:ucc.OperatorBasicSettings,startFun:function(){dialogue.islive()&&(TimeoutList.isVisitorHalfTimeout()&&(langTip.show(langTip.type.system,langTip.key.no_answer_hint),changeWindow&&changeWindow.change()),TimeoutList.isVisitorTimeout()&&langTip.show(langTip.type.system,langTip.key.no_answer_close),TimeoutList.isClientBusy()&&(langTip.show(langTip.type.system,langTip.key.cs_busy),changeWindow&&changeWindow.change()))}}),userDatas.options.chatID=ucc.chatID,userDatas.options.businessId="",userDatas.options.businessName="",queue=t.queueManager({companyPk:ucc.companyPk,chatID:ucc.chatID,langPk:ucc.defaultLangPk,message:JSON.stringify(userDatas.getJsonStr()),IpStr:JSON.stringify(userDatas.getIpStr()),netError:lang.queue.netError,success:function(e){msgdb.clear(),changeWindow.clear(),t(".service-info p:gt(1)").remove(),t("#sysmsg").html(""),datas.set("reconnectData",e),datas.set("opName",e.workgroupName),datas.set("_workGroupName",e.workgroupName),dialogue.setAttr("_workGroupName",e.workgroupName),dialogue.setAttr("remoteUrl",e.url);var i=e.workgroupName.split("-");dialogue.setAttr("operatorName",e.opShow?e.opShow:i[1]),datas.set("hasInQueue",!1);var n=robot.recored,o="";if(n.length>0)for(var a in n)dialogue.showMsg(n[a]),"visitor"==n[a].from?o+="<div class='robotmsg' data-time='"+n[a].date+"' data-from='"+n[a].from+"'  data-content='"+n[a].content+"'  >访客问:<div>"+n[a].content+"</div></div>":"robot"==n[a].from&&(o+="<div class='robotmsg' data-time='"+n[a].date+"' data-from='"+n[a].from+"'  data-content='"+n[a].content+"' >机器人答:<div>"+n[a].content+"</div></div>");robot.recored=[],langTip.show("1","7"),langTip.show("1","9");var s=dialogue.getAttr("CUTOMER_IS_INVITED");if(s){if(dialogue.toolFun(!0),dialogue.showMsg({msgid:"",date:(new Date).getTime(),content:s,from:"client",saveIn:1}),detectWeb.getIsReconnection()){var r="["+detectWeb.getMsgs(5).join(",")+"]";dialogue.sendMessage(r,"offLineMessage")}TimeoutList.startALLTimeout()}return dialogue.setAttr("CUTOMER_IS_INVITED",""),storage.set("canSendFile",!1),storage.set("oldService",e.workgroupName),changeWindow.setMsgObj(e),1==e.success?(dialogue.start(),storage.set("chatNum",Number(userDatas.getJsonStr().chatNum)+1),!0):(langTip.show(data.langType,data.langKey),!1)},fail:function(e){systemInfo.show(decodeURIComponent(decodeURIComponent(e.msg)).replace(/\+/g," ")),t("#liveMessageId").click(function(){leaveMessage.show()}),t("#continueId").click(function(){t.ajax({type:"POST",url:"./queue.do",dataType:"json",data:{method:"continueBusinessQueue",chatID:ucc.chatID,companyPk:ucc.companyPk,langPk:ucc.defaultLangPk,businessId:userDatas.getJsonStr().businessId},async:!1}).done(function(e){0==e.success?(systemInfo.show(e.msg),t("#bl").remove(),t("#liveMessageId").click(function(){leaveMessage.show()})):(queue.index=-1,systemInfo.show(e.msg),queue.isTimeOut=!1,queue.getInfo(userDatas.getJsonStr().businessId,1,!1))}).fail(function(e){systemInfo.show(lang.errorNetWork)})})},leave:function(e){systemInfo.show(e.msg),t("#bl").remove(),t("#liveMessageId").click(function(){leaveMessage.show()})},continueque:function(e){systemInfo.show(e.msg)},always:function(e){systemInfo.show(e.msg)}}),queue.reqStartQueue=function(e,i){datas.get("hasInQueue")||(datas.set("hasInQueue",!0),pageLoad.getDepartment().done(function(){if(bList=t.businessList({businessList:ucc.businessList,aDset:ucc.aDset}),bList.getItemOnline(e)){userDatas.options.businessId=e,userDatas.options.businessName=i,userDatas.options.storageOldService=storage.get("oldService");var n=userDatas.getJsonStr();n.isWs=webSocket.isWork,queue.options.message=JSON.stringify(n),queue.options.IpStr=JSON.stringify(userDatas.getIpStr()),storage.set("businessId",e),storage.set("businessName",i),t(".service-info p:gt(1)").remove(),t("#sysmsg").html(""),queue.start(e,i)}else datas.set("hasInQueue",!1),uccPcLogic.showBusinessList(bList.getParentPk(e)),t(".service-info a[data-pk='"+e+"']").click(),leaveMessage.show()}))},webSocket.connect(),dialogue=t.dialogue({webSocket:webSocket,TimeoutList:TimeoutList,timeStr:'<p class="dialogue-date">$1</p>',msgEle:"#message",visitorId:userDatas.getVisitorInfo().visitorId,historyEle:"#historyChat",textEle:".dialogue-area-write",storage:storage,browserId:ucc.browserId,changeFaceFun:changeFaceFun,limitReceiveTime:60,chatId:ucc.chatID,detectWeb:detectWeb,userDatas:userDatas,lang:lang.dialogue,msgList:{reconnectSuc:lang.dialogue.reconnectSuc,reconnectFail:lang.dialogue.reconnectFail},closeStrList:lang.dialogue.closeChat,showSysMsgFun:function(e,i){var n='<div style="margin:15px 20px"><span class="font">'+e+"</span></div>";t("#message").append(n),i||msgdb.add({type:"system",content:e}),uccPcEvent.scrollTop(),changeWindow&&changeWindow.change(),localHistory.setCurrent(msgdb.db)},getReceivedFun:function(e){},msgReplace:function(e){var t='<div class="$1 contentMessage" name="$msgid"><p class="dialogue-pic"><img src="$2"></p><div class="dialogue-in-r"><p class="in-name">$name</p><div class="dialogue-in-c"><span class="$4"><img src="$3"></span><span class="content">$content</span>$msgResend</div></div></div><div class="clearboth"></div>',i={client:{$1:"dialogue-in",$2:baseUrl+"/style/css/images/service.png",$3:baseUrl+"/style/css/images/d-dot1.png",$4:"d-dot1"},visitor:{$1:"dialogue-me",$2:baseUrl+"/style/css/images/me.png",$3:baseUrl+"/style/css/images/d-dot2.png",$4:"d-dot2"},robot:{$1:"dialogue-in",$2:baseUrl+"/style/css/images/robot.png",$3:baseUrl+"/style/css/images/d-dot1.png",$4:"d-dot1"}};if(fontStyle.isShow()&&"visitor"==e){var n='<span style="font-size:'+fontStyle.get("fontSize")+";color:"+fontStyle.get("color")+";font-weight:"+fontStyle.get("fontWeight")+";font-style:"+fontStyle.get("fontStyle")+";text-decoration:"+fontStyle.get("textDecoration")+";line-height:"+fontStyle.get("lineHeight")+";font-family:"+fontStyle.get("fontFamily")+'">$content</span>';t=t.replace(/\$content/g,n)}var o=i[e];return t.replace(/\$1/g,o.$1).replace(/\$2/g,o.$2).replace(/\$3/g,o.$3).replace(/\$4/g,o.$4)},startChat:function(){visitorRobot.ok=!1,uccPcInit.initSatifaction(),storage.set("offChat",ucc.browserId),datas.set("canSend",!0),storage.set("browserId",ucc.browserId),t(".langSwitch").hide(),t(".tool5").toggle(1==storage.get("canSendFile"));var e=ucc.advertisement.content.replace(/<[^<]+>/g,"");datas.get("adv")||2!=parseInt(ucc.advertisement.accessDisplay)&&1!=parseInt(ucc.advertisement.accessDisplay)||1!=ucc.advertisement.isVisable||"null"==ucc.advertisement.content||""==e||(uccPcEvent.showAdvertisement(),datas.set("adv",!0))},endChat:function(){datas.set("hasInQueue",!1),localHistory.saveCurrent(),uccPcEvent.closeChatSatisfaction(),t(".langSwitch").show(),t.ajax({type:"POST",url:"./echat.do",data:{method:"closeEchat",chatID:ucc.chatID,url:dialogue.getAttr("remoteUrl"),opname:dialogue.getAttr("operatroName")?dialogue.getAttr("operatroName"):""},success:function(e){},dataType:"json"}),dialogue.sendMessage(" ","foreknowledge")},endChatFun:function(){visitorRobot.ok=!0,storage.set("offChat",!0),changeWindow.stopCheck(),t(".tool2-c").hide(),t(".face-c").hide(),t("#face_08").css("display","none"),t(".sendFile").hide(),t(".reminder").hide()},msgFun:function(e){"visitor"!=e.from&&"client"!=e.from||TimeoutList.reset(),msgdb.add({date:e.date,msgId:e.msgid,type:e.from,content:e.content,saveIn:e.saveIn?e.saveIn:0,hasChecked:e.hasChecked}),changeWindow&&changeWindow.change(),visitorRobot&&visitorRobot.hide(),localHistory.setCurrent(msgdb.db),uccPcEvent.showAudio(),uccPcEvent.scrollTop()},sendMessageFun:function(e,t){datas.set("openSatisfactionAfterCloseChat",!0),TimeoutList.startALLTimeout()},closeTool:function(){t(".send").attr("disabled","disabled"),t(".dialogue-area-write").attr("contentEditable","false"),t(".dialogue-area-write").hide(),t("#face_08").hide(),t(".sendFile").hide(),t("#close").hide(),t(".ucc-logo-cancel").hide()},openTool:function(){t(".send").removeAttr("disabled"),t(".dialogue-area-write").attr("contentEditable","true"),t(".dialogue-area-write").show(),t(".dialogue-area-write").focus(),t("#face_08").show(),t("#close").show(),t(".ucc-logo-cancel").show(),t(".tool5").toggle(1==storage.get("canSendFile"))},confirmSend:function(e,i){"add"==i&&e?t(".contentMessage[name='']:last").attr("name",e):e&&t(".contentMessage[name="+e+"] ._msg").hide()},specialFun:function(e,i){if("openWin"==e)uccPcEvent.openWin(i);else if("200"==e)uccPcEvent.titleGlitter(),TimeoutList.startALLTimeout();else if("700"==e)if("pushsatisfaction"==i.code)satisfaction.show();else if("sendFile"==i.code){var n=JSON.parse(i.text);uccPcEvent.showFile(n.content)}else if("getinfo"==i.code)visitorInformation.show();else if("foreknowledge"==i.code){var o=t(".reminder").length;if(0!=o)"1"==JSON.parse(i.text).content?t(".reminder").show():t(".reminder").hide();else{var a='<div class= "reminder"><div class="rp"></div>'+lang.reminder+"</div>";t("body").append(a),t(".reminder").css({position:"absolute",bottom:"164px",left:"5px"})}}else"uploadfile"==i.code?dialogue.showMsg({msgid:"",date:(new Date).getTime(),content:JSON.parse(i.text).content,from:"client",status:0}):"audio"==i.code||("rqAccept"==i.code?(dialogue.showMsg({msgid:"",date:(new Date).getTime(),content:JSON.parse(i.text).content,from:"client",status:0}),clientAccept()):"ringOff"==i.code?(dialogue.showMsg({msgid:"",date:(new Date).getTime(),content:JSON.parse(i.text).content+"<img src='assets/right.png'/>",from:"client",status:0}),dialogue.sendMessage("ringOff","ringOff"),uccPcEvent.saveTopicType("audio")):"rqCancel"==i.code||"rqReject"==i.code||"rqTimeOut"==i.code?dialogue.showMsg({msgid:"",date:(new Date).getTime(),content:JSON.parse(i.text).content,from:"client",status:0}):"micIsOccupy"==i.code&&dialogue.showMsg({msgid:"",date:(new Date).getTime(),content:JSON.parse(i.text).content,from:"client",status:0}));else if("900"==e)t("#face_08").css("display","none"),t(".sendFile").hide();else if("901"==e)t("#face_08").css("display","none"),t(".sendFile").hide();else if("110"==e)t("#face_08").css("display","none"),t(".sendFile").hide();else if("111"==e)TimeoutList.startALLTimeout();else if("112"==e);else if("113"==e){var s=JSON.parse(i);msgdb.set(s.messageId,"isRevoke",!0),changeWindow&&changeWindow.change(),localHistory.setCurrent(msgdb.db);var r=t("div[name="+s.messageId+"]");"none"!=r.css("display")&&(r.hide(),r.prev().hasClass("dialogue-date")&&r.prev().hide(),r.after("<div class='msg_back_success'>"+dialogue.getAttr("operatorName")+lang.dialogue.revoke+"</div>"))}else if("114"==e)var s=JSON.parse(i);else"902"==e&&(langTip.show(langTip.type.system,langTip.key.no_answer_close),t("#face_08").css("display","none"),t(".sendFile").hide())}}),leaveMessage=t.leaveMessage({Alert:Alert,warn:".warning",messageDisplay:ucc.messageDisplay,messageContent:ucc.messageContent,messageTypeList:ucc.messageTypeList,companyPk:ucc.companyPk,title:lang.leaveMessage.boxTitle,bottom:"<div class='bottom'><div class='cancel'>"+lang.cancel+"</div><div class='submit'>"+lang.submit+"</div></div>",lang:lang.leaveMessage,generate:function(e){t(".leaveMessageView .title .cross img,.leaveMessageView .bottom .cancel").on("click",function(){leaveMessage.cancel()}),t(".leaveMessageView .col").each(function(i,n){var o=t(this),a=1==o.data("require")?'<div class="ico">*</div>':"";if(o.append('<span class="name">'+o.data("name")+a+'</span><span class="input"></span><span class="warning"></span>'),"combox"==o.data("type")){var s="<select >";for(var r in e)if(e[r].name){var c=e[r].name;"en"==langControl.c&&e[r].nameEN&&(c=e[r].nameEN),s+='<option value="'+e[r].pk+'" >'+c+"</option>"}s+="</select>",o.find(".input").append(s),o.find(".input select option").first().attr("selected","selected")}else"textarea"==o.data("type")?o.find(".input").append('<textarea  placeholder="'+o.data("markedwords")+'" ></textarea>'):o.find(".input").append('<input type="text" placeholder="'+o.data("markedwords")+'" >')}),t(".leaveMessageView .board [data-displayname='content'] textarea").val(""),t(".leaveMessageView .board .input,.leaveMessageView .board .textarea").focusin(function(e){leaveMessage.check(t(this).parents(".col").data("displayname"))}),t(".leaveMessageView .bottom .submit").on("click",function(){leaveMessage.submit({messageTypePk:t(".leaveMessageView .board [data-displayname='messageTypePk']").length>0?t(".leaveMessageView .board [data-displayname='messageTypePk'] select").val():"",name:t(".leaveMessageView .board [data-displayname='name']").length>0?t(".leaveMessageView .board [data-displayname='name'] input").val():"",telephone:t(".leaveMessageView .board [data-displayname='telephone']").length>0?t(".leaveMessageView .board [data-displayname='telephone'] input").val():"",email:t(".leaveMessageView .board [data-displayname='email']").length>0?t(".leaveMessageView .board [data-displayname='email'] input").val():"",title:t(".leaveMessageView .board [data-displayname='title']").length>0?t(".leaveMessageView .board [data-displayname='title'] input").val():"",content:t(".leaveMessageView .board [data-displayname='content']").length>0?t(".leaveMessageView .board [data-displayname='content'] textarea").val():"",company:t(".leaveMessageView .board [data-displayname='company']").length>0?t(".leaveMessageView .board [data-displayname='company'] input").val():"",brand:t(".leaveMessageView .board [data-displayname='brand']").length>0?t(".leaveMessageView .board [data-displayname='brand'] input").val():""})}),t("input, textarea").placeholder()},reset:function(e){t(".leaveMessageView .board [data-displayname='messageTypePk'] select").val(),t(".leaveMessageView .board [data-displayname='name'] input").val(""),t(".leaveMessageView .board [data-displayname='telephone'] input").val(""),t(".leaveMessageView .board [data-displayname='email'] input").val(""),t(".leaveMessageView .board [data-displayname='title'] input").val(""),t(".leaveMessageView .board [data-displayname='content'] textarea").val(""),t(".leaveMessageView .board [data-displayname='company'] input").val(""),t(".leaveMessageView .board [data-displayname='brand'] input").val("")},warn:function(e,t){e.find(".warning").html(t)}}),leaveMessage.init(),visitorInformation=t.visitorInformation({storage:storage,Alert:Alert,storageVisitor:"visitor",title:lang.visitorInformation.title,bottom:"<div class='bottom'><div class='cancel'>"+lang.cancel+"</div><div class='submit'>"+lang.submit+"</div></div>",lang:lang.visitorInformation,generate:function(e){t(".visitorInformationView .body .col").each(function(e,i){var n=t(this),o=1==n.data("require")?'<div class="ico">*</div>':"";if(n.append('<span class="name">'+n.data("name")+o+'</span><span class="input"></span><span class="warning"></span>'),"radio"==n.data("type")){var a='<span class="radio"><input type="radio" name="sex" value="1" >'+lang.visitorInformation.male+'</span><span class="radio"><input type="radio" name="sex" value="2" checked="checked">'+lang.visitorInformation.female+"</span>";n.find(".input").append(a)}else n.find(".input").append('<input type="text" placeholder="'+(n.data("placeholder")?n.data("placeholder"):"")+'" value="'+(n.data("markedwords")?n.data("markedwords"):"")+'" >')}),t(".visitorInformationView .title .cross img,.visitorInformationView .bottom .cancel").on("click",function(){visitorInformation.cancel()}),t(".visitorInformationView .board .input").focus(function(e){visitorInformation.check()}),t(".visitorInformationView .bottom .submit").on("click",function(e){visitorInformation.submit({
visitorName:t(".visitorInformationView .board [data-displayname='visitorName'] input").val(),sex:t(".visitorInformationView input[name=sex]").filter(":checked").val(),realName:t(".visitorInformationView .board [data-displayname='realName'] input").val(),mobile:t(".visitorInformationView .board [data-displayname='phone'] input").val(),email:t(".visitorInformationView .board [data-displayname='email'] input").val(),QQ:t(".visitorInformationView .board [data-displayname='QQ'] input").val(),address:t(".visitorInformationView .board [data-displayname='address'] input").val(),company:t(".visitorInformationView .board [data-displayname='company'] input").val()})})},warn:function(e,t){e.find(".warning").html(t)},submitFun:function(e){dialogue.sendMessage(JSON.stringify(userDatas.getJsonStr()),"getinfoSubmit"),dialogue.showSysMsg(lang.visitorInformation.submit)},cancelFun:function(){dialogue.islive()&&dialogue.sendMessage(lang.visitorInformation.cancel,"cancelVisitorInformation")}}),robot=t.robot({visitorId:storage.get("visitor").visitorId,visitorName:storage.get("visitor").visitorName,dialogue:dialogue,robotSetting:ucc.BasicSetting.robotSetting,lang:lang.robot,companyPk:ucc.companyPk,chatId:ucc.chatID,ecselfList:ucc.ecselfList,langPk:ucc.defaultLangPk,lang:lang.robot,changeToNormal:function(e){t.ajax({type:"POST",url:"./echatManager.do",data:{method:"keepTenQA",chatId:ucc.chatID},dataType:"json"}).done(function(e){}),t("#message>*").not("#historyChat,#moreHistory,.service-info").remove(),langTip.show("1","1"),langTip.show("1","2"),visitorRobot.ok=!1,robot.isUse=!1,workTime.iswork(),0==workTime.type?uccPcLogic.loadScheme():workTime.show(),dialogue.toolFun(!1),t(".accept").css("display","block"),t("#autoReply").css("display","none"),t(".centerTime").remove()}}),t("body").delegate(".robotResp","click",function(){robot.isUse&&!dialogue.islive()&&robot.options.changeToNormal()}),t("body").delegate(".robotSuggsetion","click",function(){robot.isUse&&!dialogue.islive()&&robot.check(t(this).text())}),robot.check(),robot.isUse?(t(".send").removeAttr("disabled"),t(".dialogue-area-write").attr("contentEditable","true"),t(".dialogue-area-write").show()):visitorRobot.ok=!1,langTip=t.langTip({companyPk:ucc.companyPk,defaultLangPk:ucc.defaultLangPk,langMap:ucc.langMap,show:function(e){var i=new RegExp("&quot;","g");switch(e.langKey){case 1:t("#sysmsg").html(e.content?e.content.replace(i,'"'):"");break;case 2:t("#welcome").html(e.content?e.content.replace(lang.leaveMessageStr,'<a href="javascript:void(0)" class="dialogue-a fanke-liuyan" >'+lang.leaveMessageStr+"</a>").replace(i,'"'):"");break;case 3:dialogue.showMsg({content:e.content?e.content.replace(i,'"'):"",from:"robot",saveIn:1});break;case 4:dialogue.showMsg({content:e.content?e.content.replace(i,'"'):"",from:"robot",saveIn:1});break;case 5:dialogue.showMsg({content:e.content?e.content.replace(i,'"'):"",from:"robot",saveIn:1}),dialogue.end(4);break;case 6:dialogue.showMsg({content:e.content?e.content.replace(i,'"'):"",from:"robot",saveIn:1});break;case 7:dialogue.showSysMsg(e.content?e.content.replace(i,'"'):"",!0);break;case 9:dialogue.showMsg({content:e.content?e.content.replace(i,'"'):"",from:"robot",saveIn:1});break;default:dialogue.showSysMsg(e.content?e.content.replace(i,'"'):e.conntent.replace(i,'"'),!0)}}}),changeWindow&&clearInterval(changeWindow.browserInterval),changeWindow=t.changeWindow({msgdb:msgdb,open:!0,storage:storage,chatId:ucc.chatID,browserId:ucc.browserId,TimeoutList:TimeoutList,dialogue:dialogue,data:datas,start:function(){t("#message").html(""),t(".leaveMessage").remove(),visitorInformation.hide(),ucc.BasicSetting.need=0},end:function(){t(".visitorRobot").hide(),t(".reminder").hide(),uccPcEvent.leaveCover()}}),changeWindow.init()},initHistory:function(){History=t.history({show:!1,leavePre:lang.history.leavePre,visitorId:userDatas.getVisitorInfo().visitorId,companyPk:ucc.companyPk,dialogue:dialogue,generation:function(){dialogue.islive()||(History.getLeaveChat(),History.showLeaveChat(),History.check(),History.getSum()>0&&(t("#moreHistory").length<=0&&t("#message").prepend("<div style='cursor:pointer;text-align:center;color:#666;margin-top:10px;' id='moreHistory'>"+lang.history.btnStr+"</div>"),t("#moreHistory").on("click",function(){var e="historyOperator.do?method=moreHistoryDialogue&visitorId="+userDatas.getVisitorInfo().visitorId+"&companyPk="+ucc.companyPk,t=lang.histroyRecords;tab.add(t,t,e)})))},checkFun:function(){}}),History.init()},initLocalHistory:function(){History=t.history({show:!1,visitorId:userDatas.getVisitorInfo().visitorId,companyPk:ucc.companyPk,dialogue:dialogue,generation:function(){dialogue.islive()||(History.getLeaveChat(),History.showLeaveChat(),localHistory.history.length>0&&(t("#moreHistory").length<=0&&t("#message").prepend("<div style='cursor:pointer;text-align:center;color:#666;margin-top:10px;' id='moreHistory'>"+lang.history.btnStr+"</div>"),t("#moreHistory").on("click",function(){var e="historyOperator.do?method=moreHistoryDialogue&visitorId="+userDatas.getVisitorInfo().visitorId+"&companyPk="+ucc.companyPk,t=lang.histroyRecords;tab.add(t,t,e)})))},checkFun:function(){}}),History.init()}},t.uccPcInit=function(e){var t=new n(e);return t}}(window,jQuery),function(e,t,i){String.prototype.trim=function(){return this.replace(/(^\s*)|(\s*$)/g,"")};var n=function(e){this.defaults={period:30,after:function(){}},this.options=t.extend({},this.defaults,e)};n.prototype={isInitiate:!1,isReconnection:!1,checkeTimeout:null,msgs:[],period:0,getIsInitiate:function(){return this.isInitiate},getIsReconnection:function(){return this.isReconnection},getMsgs:function(e){return this.msgs.length>e?this.msgs.slice(this.msgs.length-e,this.msgs.length):this.msgs},check:function(){this.period--,this.period<=0&&(this.options.after(),clearInterval(this.checkeTimeout),this.checkeTimeout=null,this.isInitiate=!1,this.period=this.options.period)},checkedSuccess:function(){clearInterval(this.checkeTimeout),this.checkeTimeout=null,this.period=this.options.period,this.isInitiate=!1},setInitiate:function(e){this.isInitiate=e},setIsReconnection:function(e){this.isReconnection=e},checkedFail:function(){var e=this;e.checkeTimeout=setInterval(function(){e.check()},1e3),this.isInitiate=!0},msgPush:function(e,t){this.msgs.push('{"'+e+'":"'+t+'"}')}},t.detectWeb=function(e){var t=new n(e);return t.period=t.options.period,t}}(window,jQuery),function(e,t,i){var n=function(e){this.defaults={BasicSetting:{},ExtraSetting:{},workStr:"温馨提示：尊敬的客户，我们的服务时间是【$1】<br>如果有重要的事情，请点击<a href='javascript:void(0)' class='dialogue-a fanke-liuyan'>在线留言</a><br>给您带来的不便，敬请谅解.",holidayStr:"温馨提示：尊敬的客户，我们的节假日时间是【$1】<br>如果有重要的事情，请点击<a href='javascript:void(0)' class='dialogue-a fanke-liuyan'>在线留言</a><br>给您带来的不便，敬请谅解.",show:function(e){}},this.options=t.extend({},this.defaults,e)};n.prototype={timeZone:"",type:0,init:function(){var e=this,t=this.options.BasicSetting,i=this.options.ExtraSetting;if(t&&1==t.open){var n=t.startTime.split(":"),o=t.endTime.split(":");if(n.length<2||o.length<2)return!1;var a=new Date,s=new Date,r=new Date;a.setHours(n[0]),a.setMinutes(n[1]),a.setSeconds("00"),s.setHours(o[0]),s.setMinutes(o[1]),s.setSeconds("00");for(var c,l,d=r.getMonth()+1<10?"0"+(r.getMonth()+1):r.getMonth()+1,u=r.getDate()<10?"0"+r.getDate():r.getDate(),p=r.getFullYear()+"-"+d+"-"+u,g="",m=t.week,f=r.getDay(),h=m.split(","),v=!1,w=0;w<=h.length;w++)switch(h[w]){case"0":g+="星期日&nbsp";break;case"1":g+="星期一&nbsp";break;case"2":g+="星期二&nbsp";break;case"3":g+="星期三&nbsp";break;case"4":g+="星期四&nbsp";break;case"5":g+="星期五&nbsp";break;case"6":g+="星期六&nbsp"}if(13==m.length&&(g=""),m.indexOf(f)>=0){if(r.getTime()>s.getTime()||r.getTime()<a.getTime())return e.type=1,e.timeZone=g+t.startTime+"-"+t.endTime,!1;for(var w=0;w<i.length;w++)if(1==i[w].exceType&&i[w].exceStartTime<=p&&i[w].exceEndTime>=p){c=i[w].exceStartTime,l=i[w].exceEndTime,v=!0;break}if(v)return e.type=2,e.timeZone=c+"-"+l,!1}else if("null"!=m){for(var w=0;w<i.length;w++)if(0==i[w].exceType&&i[w].exceStartTime<=p&&i[w].exceEndTime>=p){c=i[w].exceStartTime,l=i[w].exceEndTime,v=!0;break}if(!v)return e.type=1,e.timeZone=g+t.startTime+"-"+t.endTime,!1}}},iswork:function(){var e=this;e.type=0;var t=e.options.BasicSetting,i=e.options.ExtraSetting;if(t&&1==t.open){var n=t.startTime.split(":"),o=t.endTime.split(":");if(2!=n.length||2!=o.length)return!1;var a=new Date,s=new Date,r=new Date(nowtime);a.setHours(n[0]),a.setMinutes(n[1]),a.setSeconds("00"),s.setHours(o[0]),s.setMinutes(o[1]),s.setSeconds("00");for(var c,l,d=r.getMonth()+1<10?"0"+(r.getMonth()+1):r.getMonth()+1,u=r.getDate()<10?"0"+r.getDate():r.getDate(),p=r.getFullYear()+"-"+d+"-"+u,g="",m=t.week,f=r.getDay(),h=m.split(","),v=!1,w=0;w<=h.length;w++)switch(h[w]){case"0":g+="星期日&nbsp";break;case"1":g+="星期一&nbsp";break;case"2":g+="星期二&nbsp";break;case"3":g+="星期三&nbsp";break;case"4":g+="星期四&nbsp";break;case"5":g+="星期五&nbsp";break;case"6":g+="星期六&nbsp"}if(13==m.length&&(g=""),m.indexOf(f)>=0){if(r.getTime()>s.getTime()||r.getTime()<a.getTime())return e.type=1,e.timeZone=g+t.startTime+"-"+t.endTime,!1;for(var w=0;w<i.length;w++)if(1==i[w].exceType&&i[w].exceStartTime<=p&&i[w].exceEndTime>=p){c=i[w].exceStartTime,l=i[w].exceEndTime,v=!0;break}if(v)return e.type=2,e.timeZone=c+"-"+l,!1}else if("null"!=m){for(var w=0;w<i.length;w++)if(0==i[w].exceType&&i[w].exceStartTime<=p&&i[w].exceEndTime>=p){c=i[w].exceStartTime,l=i[w].exceEndTime,v=!0;break}if(!v)return e.type=1,e.timeZone=g+t.startTime+"-"+t.endTime,!1}}},getMsg:function(){return 1==this.type?this.options.workStr.replace(/\$1/g,this.timeZone):2==this.type&&this.options.holidayStr.replace(/\$1/g,this.timeZone)},show:function(){var e=this.getMsg();this.options.show(e)}},t.workTime=function(e){var t=new n(e);return t.init(),t}}(window,jQuery),function(e,t,i){var n=function(e){this.defaults={businessList:[],aDset:[],root:"-1"},this.options=t.extend({},this.defaults,e)};n.prototype={num:1,basePk:-1,init:function(){var e=this.options.aDset;if(e){this.options.businessList;"0"!=e.joinUpType&&e.joinUpType&&("1"==e.joinUpType||"2"==e.joinUpType),this.reset("-1")}},reset:function(e){for(var t=this,i=this.options.businessList,n=!1,o=0;o<i.length;o++)if(i[o].parentPk==e){var a=t.getList(i[o].pk);if(0==a.length)i[o].operators.length>0&&(n=!0);else{var s=t.reset(i[o].pk);0==s?i[o].operators=[]:1==s&&(n=!0)}}return n},hasList:function(e){for(var t=[],i=this.options.businessList,n=0;n<i.length;n++)i[n].parentPk==e&&(i[n].operators.length>0?t.push({item:i[n],type:"online"}):t.push({item:i[n],type:"offline"}));return t},getList:function(e){for(var t=(this.num,[]),i=this.options.businessList,n=0;n<i.length;n++)i[n].parentPk==e&&(i[n].operators.length>0?(t.push({num:this.num,item:i[n],type:"online"}),this.num++):(t.push({num:this.num,item:i[n],type:"offline"}),this.num++));return t},getAllLength:function(){var e=this.options.businessList;return{listLength:e.length,operatorLength:e.length>0?e[0].operators.length:0,firstItem:e.length>0?e[0]:null}},getParentPk:function(e){for(var t=this.options.businessList,i=0;i<t.length;i++)if(t[i].pk==e)return t[i].parentPk;return null},setSelect:function(e,t){this.select={pk:e,name:t}},getSelect:function(){return this.select},generate:function(e){var t=this.getList(e),i=(this.getParentPk(e),!1);return e==-1&&0==t.length?{access:!0,online:!1}:e==this.basePk&&1==t.length?(this.basePk=t[0].item.pk,this.getList(t[0].item.pk).length>0?this.generate(t[0].item.pk):t[0].item.operators.length>0?{access:!0,online:!0,pk:t[0].item.pk,name:t[0].item.name}:{access:!0,online:!1,pk:t[0].item.pk,name:t[0].item.name}):(this.basePk==e&&(i=!0),{access:!1,list:t,root:i})},getItemOnline:function(e){for(var t=this.options.businessList,i=!1,n=0;n<t.length;n++)t[n].pk==e&&t[n].operators.length>0&&(i=!0);return i}},t.businessList=function(e){var t=new n(e);return t.init(),t}}(window,jQuery),function(e,t,i){var n=0,o=0,a=function(e){this.defaults={picStr:"<img id='showpic' src='$1'/>",bgColor:"rgba(0,0,0,0.5)"},this.options=t.extend({},this.defaults,e)};a.prototype={init:function(){var e=this;e.getScreenRatio(),t(".showPicture").length>0||(t("body").append('<div class="showPicture"></div>'),t(".showPicture").css({position:"fixed",top:"0",bottom:"0",left:"0",right:"0",background:e.options.bgColor,display:"none",zIndex:"1001"}))},showPic:function(e){var i=this;i.init(),t(".showPicture").html("").append(this.options.picStr.replace(/\$1/g,e)),t(".showPicture").show();var o=document.getElementById("showpic");o.complete?(n=t(".showPicture img").width()/t(".showPicture img").height(),i.getShowPic()):o.onload=function(){n=t(".showPicture img").width()/t(".showPicture img").height(),i.getShowPic()},t(".showPicture").unbind().on("click",function(e){t(".showPicture").hide()})},getShowPic:function(){o&&n&&(o>n?t(".showPicture img").height()>=t(e).height()?t(".showPicture img").css({width:"auto",height:"98%",padding:" 1% 0",display:"block",margin:"0 auto",position:"initial",top:"0"}):t(".showPicture img").css({display:"block",margin:"0 auto",position:"relative",top:(t(e).height()-t(".showPicture img").height())/2+"px"}):t(".showPicture img").width()>=t(e).width()?(t(".showPicture img").css({display:"initial",width:"98%",padding:"0 1%",height:"auto",position:"fixed",top:"50%"}),t(".showPicture img").css({marginTop:-t(".showPicture img").height()/2})):(t(".showPicture img").css({display:"initial",left:"50%",position:"fixed",top:"50%",padding:"1% 1%"}),t(".showPicture img").css({marginTop:-t(".showPicture img").height()/2,marginLeft:-t(".showPicture img").width()/2})))},getScreenRatio:function(){o=t(e).width()/t(e).height()}},t.showBigImg=function(e){var t=new a(e);return t.init(),t}}(window,jQuery),function(e,t,i){var n=function(e){this.defaults={msgdb:null,clientEndtime:480,clientBusytime:240,visitorEndTime:240,visitorHalfTime:120,ops:{},startFun:function(){}},this.options=t.extend({},this.defaults,e)};n.prototype={diaList:new Object,timeout:null,hasVisitorHalfTimeout:!1,hasVisitorTimeout:!1,hasClientBusy:!1,hasClientEnd:!1,init:function(){this.setTime()},setTime:function(){var e=this.options.ops;this.options.clientEndtime=e.customerFroVisitors?e.customerFroVisitors:this.options.clientEndtime,this.options.clientBusytime=e.customerBusy?e.customerBusy:this.options.clientBusytime,this.options.visitorEndTime=e.customerFroVisitors?e.customerFroVisitors:this.options.visitorEndTime,this.options.visitorHalfTime=this.options.visitorEndTime<=2*this.options.visitorHalfTime?this.options.visitorEndTime/2:this.options.visitorEndTime-this.options.visitorHalfTime},startALLTimeout:function(){var e=this;clearInterval(this.timeout),this.timeout=setInterval(function(){e.options.startFun()},1e3)},endChat:function(){this.hasVisitorHalfTimeout=!0,this.hasVisitorTimeout=!0,this.hasClientBusy=!0,this.hasClientEnd=!0},reset:function(){this.hasVisitorHalfTimeout=!1,this.hasVisitorTimeout=!1,this.hasClientBusy=!1,this.hasClientEnd=!1},removeDiaList:function(e){delete this.diaList[e]},diaListLast:function(){var e,t=this.options.msgdb;for(var i in t.db)t.db[i]&&"robot"!=t.db[i].type&&"system"!=t.db[i].type&&!t.db[i].isRevoke&&(e&&("visitor"==t.db[i].type&&"visitor"==t.db[e].type||"client"==t.db[i].type&&"client"==t.db[e].type)||(e=i));return e},isVisitorHalfTimeout:function(){var e=this.options.msgdb,t=this,i=e.db[t.diaListLast()];if(!t.hasVisitorHalfTimeout&&i&&"client"==i.type){var n=(new Date).getTime();if(n-i.time>=1e3*t.options.visitorHalfTime&&!i.hasChecked)return e.db[t.diaListLast()].hasChecked=!0,t.hasVisitorHalfTimeout=!0,!0}return!1},isVisitorTimeout:function(){var e=this.options.msgdb,t=this,i=e.db[t.diaListLast()];if(!t.hasVisitorTimeout&&i&&"client"==i.type){var n=(new Date).getTime();if(n-i.time>=1e3*t.options.visitorEndTime)return t.hasVisitorTimeout=!0,!0}return!1},isClientBusy:function(){var e=this.options.msgdb,t=this,i=this.options.ops,n=e.db[t.diaListLast()];if(0==i.customerBusy)return!1;if(!t.hasClientBusy&&n&&"visitor"==n.type){var o=(new Date).getTime();if(o-n.time>=1e3*t.options.clientBusytime&&!n.hasChecked)return e.db[t.diaListLast()].hasChecked=!0,t.hasClientBusy=!0,!0}return!1},isClientEnd:function(){var e=this.options.msgdb,t=this,i=e.db[t.diaListLast()],n=(new Date).getTime();return!!(n-i.time>=1e3*t.options.clientEndtime&&!t.hasClientEnd&&i.hasChecked)&&(e.db[t.diaListLast()].hasChecked=!0,t.hasClientEnd=!0,!0)}},t.TimeoutList=function(e){var t=new n(e);return t.init(),t}}(window,jQuery),function(e,t,i){var n=[['<img emotions="true" name="faceIco" src="/any800/style/images/mobileImages/newImages/face01.png" data-name="/::)" id="/::)">',"/::)","/::\\)"],['<img emotions="true" name="faceIco" src="/any800/style/images/mobileImages/newImages/face02.png" id="/::P" data-name="/::P">',"/::P","/::P"],['<img emotions="true" name="faceIco" src="/any800/style/images/mobileImages/newImages/face03.png" id="/::$" data-name="/::$">',"/::$","/::\\$"],['<img emotions="true" name="faceIco" src="/any800/style/images/mobileImages/newImages/face04.png" id="/::D" data-name="/::D">',"/::D","/::D"],['<img emotions="true" name="faceIco" src="/any800/style/images/mobileImages/newImages/face05.png" id="/::-|" data-name="/::-|">',"/::-|","/::\\-\\|"],['<img emotions="true" name="faceIco" src="/any800/style/images/mobileImages/newImages/face06.png" id="/::+" data-name="/::+">',"/::+","/::\\+"],['<img emotions="true" name="faceIco" src="/any800/style/images/mobileImages/newImages/face07.png" id="/:,@-D"  data-name="/:,@-D">',"/:,@-D","/:,@\\-D"],['<img emotions="true" name="faceIco" src="/any800/style/images/mobileImages/newImages/face08.png" id="/::>" data-name="/::&gt;">',"/::&gt;","/::&gt;","/::>"],['<img emotions="true" name="faceIco" src="/any800/style/images/mobileImages/newImages/face09.png" id="/:,@f" data-name="/:,@f">',"/:,@f","/:,@f"],['<img emotions="true" name="faceIco" src="/any800/style/images/mobileImages/newImages/face10.png" id="/:?" data-name="/:?">',"/:?","/:\\?"],['<img emotions="true" name="faceIco" src="/any800/style/images/mobileImages/newImages/face11.png" id="/:bye" data-name="/:bye">',"/:bye","/:bye"],['<img emotions="true" name="faceIco" src="/any800/style/images/mobileImages/newImages/face12.png" id="/:handclap" data-name="/:handclap">',"/:handclap","/:handclap"],['<img emotions="true" name="faceIco" src="/any800/style/images/mobileImages/newImages/face13.png" id="/::*" data-name="/::*">',"/::*","/::\\*"],['<img emotions="true" name="faceIco" src="/any800/style/images/mobileImages/newImages/face14.png" id="/:strong" data-name="/:strong">',"/:strong","/:strong"],['<img emotions="true" name="faceIco" src="/any800/style/images/mobileImages/newImages/face15.png" id="/:P-(" data-name="/:P-(">',"/:P-(","/:P\\-\\("],['<img emotions="true" name="faceIco" src="/any800/style/images/mobileImages/newImages/face16.png" id="/:rose" data-name="/:rose">',"/:rose","/:rose"],['<img emotions="true" name="faceIco" src="/any800/style/images/mobileImages/newImages/face17.png" id="/:share" data-name="/:share">',"/:share","/:share"],['<img emotions="true" name="faceIco" src="/any800/style/images/mobileImages/newImages/face18.png" id="/:ok" data-name="/:ok">',"/:ok","/:ok"],['<img emotions="true" name="faceIco" src="/any800/style/images/mobileImages/newImages/face19.png" id="/:sun"  data-name="/:sun">',"/:sun","/:sun"],['<img emotions="true" name="faceIco" src="/any800/style/images/mobileImages/newImages/face20.png" id="/:heart" data-name="/:heart">',"/:heart","/:heart"],['<img emotions="true" name="faceIco" src="/any800/style/images/mobileImages/newImages/face21.png" id="/:hug" data-name="/:hug">',"/:hug","/:hug"]],o=function(e){this.defaults={imgIco:[],after:function(){}},this.options=t.extend({},this.defaults,e)};o.prototype={init:function(){this.options.imgIco=n,this.options.after()},getItems:function(){return n},imgToIco:function(e){var i=e;if(!i||"string"!=typeof e)return i;var o=t("<div>"+e+"</div>");for(var a in n)o.find("img[data-name='"+n[a][1]+"']").each(function(e){t(this).replaceWith(n[a][1])});return i=o.html()},icoToImg:function(e){var t=e;if(!t||"string"!=typeof e)return t;for(var i in n)t.indexOf(n[i][1])!=-1&&(t.indexOf(n[i][1])!=-1?t=t.replace(new RegExp(n[i][2],"gm"),n[i][0]):n[i][3]&&t.indexOf(n[i][3])!=-1&&(t=t.replace(new RegExp(n[i][3],"gm"),n[i][0])));return t}},t.changeFace=function(e){var t=new o(e);return t.init(),t}}(window,jQuery),function(e,t,i){var n,o=function(e){this.defaults={companyPk:""},this.options=t.extend({},this.defaults,e)};o.prototype={init:function(){e.localStorage&&(n=e.localStorage),this.setVersion()},setVersion:function(){var e=this,t=e.get("version"),i=e.get("jsonStr"),o=e.get("visitor"),a=e.get("localHis");t&&"8.0.1"==t||(n&&n.clear(),i&&e.set("jsonStr",i),o&&e.set("visitor",o),a&&e.set("localHis",a),e.set("version","8.0.1"))},get:function(e){var i=null;"version"!=e&&(e="c"+this.options.companyPk+"-"+e),n?(i=n[e],i&&(i=decodeURIComponent(n[e]))):t.cookie&&(i=decodeURIComponent(t.cookie(e)));try{i=JSON.parse(i)}catch(o){}return i},set:function(e,i){"version"!=e&&(e="c"+this.options.companyPk+"-"+e),n?("object"==typeof i&&(i=JSON.stringify(i)),n[e]=encodeURIComponent(i)):t.cookie&&t.cookie(e,encodeURIComponent(i))},clear:function(e){"version"!=e&&(e="c"+this.options.companyPk+"-"+e),n?n.removeItem(e):t.cookie&&t.cookie(e,null)}},t.storage=function(e){var t=new o(e);return t.init(),t}}(window,jQuery),function(e,t,i){var n=function(e){this.defaults={vocabulary:{}},this.options=t.extend({},this.defaults,e)};n.prototype={get:function(e){var t=e,i=this.options.vocabulary;if(i&&i.content&&1==i.isVisable)for(var n=i.content.split(":"),o=0;o<n.length;o++)if(n[o])for(var a=0;a<=t.length;a++)t=t.replace(n[o],"*");return t}},t.sensitive=function(e){var t=new n(e);return t}}(window,jQuery),function(e,t,i){var n=function(e){this.defaults={bgColor:"rgba(0,0,0,0.3)",time:2},this.options=t.extend({},this.defaults,e)};n.prototype={isUse:!1,init:function(){var e=this;t("body").append("<div class='alert'><div class='col'></div></div>"),t(".alert").on("click",function(i){e.isUse=!1,t(".alert").hide()})},show:function(e,i){var n=this;0==n.isUse&&(n.isUse=!0,i&&"error"==i&&t(".alert .col").addClass("error"),t(".alert .col").html(e),t(".alert").show(),t(".alert .col").css({marginLeft:-t(".alert .col").width()/2-20,marginTop:-t(".alert .col").height()-10}),setTimeout(function(){n.isUse=!1,t(".alert").hide(),t(".alert .col").removeClass("error")},1e3*n.options.time))}},t.Alert=function(e){var t=new n(e);return t.init(),t}}(window,jQuery),function(window,$,undefined){var mobile_type_arr=["ipad","ipod","iphone","ios","ios","android","backerry","webos","symbian","windows phone","phone","blackberry"],mobile_pc_browser_json={micromessenger:"微信浏览器",ucbrowser:"UC浏览器",qqbrowser:"QQ浏览器",opera:"Opera浏览器",baidubrowser:"百度浏览器",firefox:"火狐浏览器",maxthon:"傲游浏览器",xiaomi:"小米手机浏览器",chrome:"Chrome浏览器",android:"android内置浏览器",iphone:"iphone内置浏览器",ipod:"opod内置浏览器",ipad:"ipad内置浏览器"},pc_browser_json={qqbrowser:"QQ浏览器",opera:"Opera浏览器",maxthon:"傲游浏览器",tencenttraveler:"TT浏览器",theworld:"天天浏览器",lbbrowser:"猎豹浏览器",chrome:"Chrome浏览器",firefox:"Firefox浏览器",msie:"IE浏览器",safari:"Safari浏览器",metasr:"搜狗浏览器"},DATAS=function(e){this.defaults={param:null,storage:null,storageVisitor:"visitor",storageIpStr:"ipStr",storageChatNum:"chatNum",companyPk:"",aDset:null,chatID:"",businessId:"",businessName:"",storageOldService:"",opShow:""},this.options=$.extend({},this.defaults,e)};DATAS.prototype={hasGetJson:!1,hasGetVisitor:!1,hasIpStr:!1,getJsonStr:function(){var e=this,t={};e.hasGetJson&&(e.options.param.mn="");var i=this.getVisitorInfo(),n=this.options.aDset,o=this.getIpStr();if(e.options.param&&e.options.param.mn){var a=JSON.parse(decodeURIComponent(e.options.param.mn));t={companyPk:e.options.companyPk,visitorId:i.visitorId,visitorName:i.visitorName,businessId:e.options.businessId,businessName:e.options.businessName,chatID:e.options.chatID,browsingNum:a.browsingNum,fromPage:a.fromPage?a.fromPage:document.referrer.replace(/[&]/g,"%26")?document.referrer.replace(/[&]/g,"%26"):"",title:"",ip:o.cip,ipName:o.cname,usersource:n?n.scheme_Name:"",codeKey:this.options?this.options.param.codeKey:"",opShow:e.options.opShow,oldService:e.options.storageOldService,keyword:a.keyword,searchEngine:a.searchEngine,lastTime:Number(a.lastTime)?a.lastTime:"Invalid Date"==new Date(a.lastTime)?"":new Date(a.lastTime),firstTime:Number(a.firstTime)?a.firstTime:"Invalid Date"==new Date(a.firstTime)?"":new Date(a.firstTime),chatNum:e.getChatNum(),operatingSystem:e.getOperatingSystem(),visitor:i,commodity:{shopImgUrl:"",shopName:"",shopNum:"",shopPrice:"",shopUrl:""}}}else{var s=e.options.storage.get("jsonStr");t={visitorId:i.visitorId,companyPk:e.options.companyPk,visitorName:i.visitorName,businessId:e.options.businessId,businessName:e.options.businessName,chatID:e.options.chatID,browsingNum:s&&s.browsingNum?s.browsingNum:"",fromPage:s&&s.fromPage?s.fromPage:document.referrer.replace(/[&]/g,"%26")?document.referrer.replace(/[&]/g,"%26"):"",title:s&&s.title?s.title:"",usersource:n?n.scheme_Name:"",codeKey:this.options?this.options.param.codeKey:"",opShow:e.options.opShow,oldService:e.options.storageOldService,ip:o.cip,ipName:o.cname,keyword:s&&s.keyword?s.keyword:"",searchEngine:s&&s.searchEngine?s.searchEngine:"",lastTime:s&&s.lastTime?s.lastTime:"",firstTime:s&&s.firstTime?s.firstTime:"",chatNum:e.getChatNum(),operatingSystem:e.getOperatingSystem(),visitor:i,commodity:{shopImgUrl:"",shopName:"",shopNum:"",shopPrice:"",shopUrl:""}}}if(e.options.param.pageInfo&&e.options.param.isuse&&"true"==e.options.param.isuse){var r=decodeURIComponent(e.options.param.pageInfo),c=r.split("|"),l="",d="";1==c.length?(d=c[0].trim(),"null"==d&&(d="")):c.length>=2&&(d=c[0].trim(),l=c[1].trim(),"null"==d&&(d=""),"null"==l&&(l="")),t.title=encodeURIComponent(d),t.fromPage=encodeURIComponent(l)}else t.title="",t.fromPage="";if(e.options.param.defineParamsJson){var u=decodeURIComponent(e.options.param.defineParamsJson);t.defineParamsJson=u?u:""}return e.hasGetJson=!0,e.options.storage.set("jsonStr",t),t},getChatNum:function(){return this.options.storage.get(this.options.storageChatNum)?this.options.storage.get(this.options.storageChatNum):0},getOperatingSystem:function(){var e=this.options.param,t="pc",i=navigator.userAgent.toLowerCase(),n=/(iPhone|iPod|Android|ios|iOS|iPad|Backerry|WebOS|Symbian|Windows Phone|Phone|BlackBerry)/i;null!=i.match(n)&&(t="mb"),e&&e.qr&&(t="ma");var o=window.screen.width+"×"+window.screen.height,a=navigator.systemLanguage?navigator.systemLanguage:navigator.language?navigator.language:"",s={sysInfo:t,browserName:this.getUserAgent().browser_name,browser:this.getUserAgent().browser_type,operatorSystem:this.getUserAgent().terminal_system,sysResolution:o,language:a};return s},getUserAgent:function(){var e={},t=navigator.userAgent.toLowerCase(),i=/(iPhone|iPod|Android|ios|iOS|iPad|Backerry|WebOS|Symbian|Windows Phone|Phone|BlackBerry)/i;if(null!=t.match(i)){e.terminal_Type="移动终端";for(var n=0;n<mobile_type_arr.length;n++)if(t.indexOf(mobile_type_arr[n])>-1){e.terminal_system=mobile_type_arr[n];break}null!=e.terminal_system&&""!=e.terminal_system||(e.terminal_system="未知");for(var n in mobile_pc_browser_json)if(t.indexOf(n)>-1){e.browser_type=mobile_pc_browser_json[n],e.browser_name=n;break}null!=e.browser_type&&""!=e.browser_type||(e.browser_type="未知",e.browser_name="未知")}else{e.terminal_Type="PC终端";var o="未知",a="Win32"==navigator.platform||"Windows"==navigator.platform,s="Mac68K"==navigator.platform||"MacPPC"==navigator.platform||"Macintosh"==navigator.platform||"MacIntel"==navigator.platform;s&&(o="Mac");var r="X11"==navigator.platform&&!a&&!s;r&&(o="Unix");var c=String(navigator.platform).indexOf("Linux")>-1;if(c&&(o="Linux"),a){var l=t.indexOf("windows nt 5.0")>-1||t.indexOf("windows 2000")>-1;l&&(o="Win2000");var d=t.indexOf("windows nt 5.1")>-1||t.indexOf("windows xp")>-1;d&&(o="WinXP");var u=t.indexOf("windows nt 5.2")>-1||t.indexOf("windows 2003")>-1;u&&(o="Win2003");var p=t.indexOf("windows nt 6.0")>-1||t.indexOf("windows vista")>-1;p&&(o="WinVista");var g=t.indexOf("windows nt 6.1")>-1||t.indexOf("windows 7")>-1;g&&(o="Win7");var m=t.indexOf("windows nt 6.2")>-1||t.indexOf("windows 7")>-1;m&&(o="Win8");var f=t.indexOf("windows nt 10.0")>-1||t.indexOf("windows 10")>-1;f&&(o="Win10");var h=t.indexOf("Edge")>-1;h&&(o="WinEdge")}e.terminal_system=o;for(var n in pc_browser_json)if(t.indexOf(n)>-1){e.browser_type=pc_browser_json[n],e.browser_name=n;break}if(null==e.browser_type||""==e.browser_type){var v="Win10"==o,h="WinEdge"==o;v||h?(e.browser_type=pc_browser_json.msie,e.browser_name="msie"):(e.browser_type="未知",e.browser_name="未知")}}return e.flash_version=this.getFlash_version(),e},getFlash_version:function(){var f="-",n=navigator;if(n.plugins&&n.plugins.length){for(var ii=0;ii<n.plugins.length;ii++)if(n.plugins[ii].name.indexOf("Shockwave Flash")!=-1){f=n.plugins[ii].description.split("Shockwave Flash ")[1];break}}else if(window.ActiveXObject)for(var ii=10;ii>=2;ii--)try{var fl=eval("new ActiveXObject('ShockwaveFlash.ShockwaveFlash."+ii+"');");if(fl){f=ii+".0";break}}catch(e){}return f},getIpStr:function(){var e=this;if(e.hasGetIpStr)return e.options.storage.get(e.options.storageIpStr);var t=null;return e.options.storage.get(e.options.storageIpStr)?t=e.options.storage.get(e.options.storageIpStr):$.ajax({url:"./echatManager.do?method=getIp",dataType:"jsonp",async:!1,complete:function(){t="object"==typeof returnCitySN?returnCitySN:{cip:"0.0.0.0",cid:"0",cname:"未知地区"}}}),e.hasGetIpStr=!0,e.options.storage.set(e.options.storageIpStr,t),t},getVisitorInfo:function(){var e=this,t={};if(!e.hasGetVisitor&&e.options.param&&e.options.param.mn){var i=JSON.parse(decodeURIComponent(e.options.param.mn));if(t.visitorId=i.visitorId,t.visitorName=i.visitorName,e.options.param.hjUserData){var n=decodeURIComponent(e.options.param.hjUserData),o=n.split("|");try{t.sex=o[1],t.realName=o[0],t.phone=o[2],t.mobile=o[3],t.email=o[4],t.QQ=o[8],t.MSN=o[7],t.address=o[5],t.company=o[6],t.visitorId=o[9],t.visitorName=o[0]}catch(a){}}}else if(!e.hasGetVisitor&&e.options.param&&e.options.param.memberPk)t.visitorId=e.options.param.memberPk;else if(e.options.storage.get(e.options.storageVisitor)){var s=e.options.storage.get(e.options.storageVisitor);t.visitorId=s.visitorId?s.visitorId:"",""==t.visitorId&&$.ajax({type:"POST",url:"echatManager.do?method=generationVisitorsID",async:!1,data:{companyPk:e.options.companyPk},dataType:"json"}).done(function(e){e&&(t.visitorId=e.visitorId)}),t.company=s.company?s.company:"",t.visitorName=s.visitorName?s.visitorName:"访客"+Number(t.visitorId.substring(1)),t.sex=isNaN(Number(s.sex))?0:s.sex,t.degree=s.degree?s.degree:"",t.realName=s.realName?s.realName:"",t.phone=s.phone?s.phone:"",t.mobile=s.mobile?s.mobile:"",t.email=s.email?s.email:"",t.QQ=s.QQ?s.QQ:"",t.MSN=s.MSN?s.MSN:"",t.address=s.address?s.address:"",t.extension=s.extension?s.extension:"",t.memberId=s.memberId?s.memberId:""}t.visitorId||$.ajax({type:"POST",url:"echatManager.do?method=generationVisitorsID",async:!1,data:{companyPk:e.options.companyPk},dataType:"json",async:!1}).done(function(e){e&&(t.visitorId=e.visitorId,t.visitorName="访客"+e.showId)});e.updateVisitorName(t,t.visitorId);return e.hasGetVisitor=!0,e.options.storage.set(e.options.storageVisitor,t),t},updateVisitorName:function(e,t){var i=this;return i.hasGetVisitor||$.ajax({type:"POST",url:"echatManager.do?method=getVisitorsName",async:!1,data:{visitorId:t},dataType:"json"}).done(function(t){t.success&&(e.company=t.company||e.company||"",e.visitorName=t.name||e.visitorName||"",e.sex=isNaN(Number(t.sex))?e.sex?e.sex:0:t.sex,e.degree=t.degree||e.degree||"",e.realName=t.realName||e.realName||"",e.phone=t.phone||e.phone||"",e.mobile=t.mobile||e.mobile||"",e.email=t.email||e.email||"",e.QQ=t.QQ||e.QQ||"",e.MSN=t.MSN||e.MSN||"",e.address=t.address||e.address||"",e.extension=t.extension||e.extension||"",e.memberId=t.memberId||e.memberId||"")}),e}},$.userDatas=function(e){var t=new DATAS(e);return t;
}}(window,jQuery),function(e,t,i){var n=function(){var e=location.href,t=e.indexOf("?")!==-1?e.split("?").pop():"",i={};return t.replace(/(\w+)(?:=([^&]*))?/g,function(e,t,n){i[t]=n}),i};t.getParameter=n}(window,jQuery),function(e,t,i){var n=function(e){this.defaults={open:!1,msgdb:null,storage:null,chatId:"",browserId:"",dialogue:null,data:null,TimeoutList:null,start:function(){},end:function(){}},this.options=t.extend({},this.defaults,e)};n.prototype={isChanged:!1,browserInterval:null,db:{},change:function(){var e=this.options.storage,t=this.options.chatId,i=e.get("currentChat")?e.get("currentChat"):[];i=this.options.msgdb.getAll(),e.get("currentChatId")&&this.options.chatId==e.get("currentChatId")||(i=[]),e.set("currentChatId",t),e.set("currentChat",i)},clear:function(){this.options.chatId},check:function(){var e=this.options.chatId,t=this.options.storage;return!(!t.get("currentChat")||!t.get("currentChatId")||t.get("currentChatId")!=e)&&t.get("currentChat")},setMsgObj:function(e){var t=(this.options.chatId,this.options.storage);t.set("msgObjCurrentChat",e)},getMsgObj:function(){var e=this.options.storage;return e.get("msgObjCurrentChat")},init:function(){var e=this.options.storage,t=this;t.db=this.options.storage.get("currentChat"),t.options.open&&(e.get("browserId")&&e.get("currentChatId")&&t.options.chatId==e.get("currentChatId")&&e.set("browserId",t.options.browserId),t.startcheck(),"over"!=t.browserInterval&&(t.browserInterval=setInterval(function(){t.startcheck()},1e3)))},startcheck:function(){var e=this,t=this.options.storage,i=this.options.dialogue,n=this.options.data,o=this.options.msgdb;if(t.get("browserId")&&e.options.chatId==t.get("currentChatId"))if(1!=t.get("offChat")&&e.options.browserId!=t.get("browserId"))1==i.islive()&&(i.end(),e.options.end());else if(e.options.browserId==t.get("browserId")&&e.getMsgObj()&&0==i.islive()){e.isChanged=!0,t.set("browserId",e.options.browserId),t.set("offChat",e.options.browserId),o.clear(),e.options.start();var a=e.getMsgObj();if(n.set("reconnectData",a),i.setAttr("remoteUrl",a.url),i.setAttr("_workGroupName",a.workgroupName),i.setAttr("operatorName",a.opShow),n.set("opName",a.workgroupName),n.set("_workGroupName",a.workgroupName),i.start(),e.db){var s=e.db;for(var r in s){var c=s[r];!c||"visitor"!=c.type&&"client"!=c.type&&"robot"!=c.type?c&&"system"==c.type&&c.content&&i.showSysMsg(c.content):c.content&&!c.isRevoke&&0==c.status&&2!=c.checkSend&&i.showMsg({msgid:c.msgId,date:c.time,content:c.content,from:c.type,status:c.status,hasChecked:c.hasChecked}),o.id=parseInt(r)+1}e.options.TimeoutList.startALLTimeout(),o.db=e.db}}},stopCheck:function(){var e=this;clearInterval(e.browserInterval),e.browserInterval="over",e.clear()}},t.changeWindow=function(e){var t=new n(e);return t}}(window,jQuery),function(e,t,i){var n=function(e){this.defaults={chatID:"",companyPk:"",langPk:0,message:{},IpStr:"",always:function(e){},success:function(e){},fail:function(e){},leave:function(){},continueque:function(){}},this.options=t.extend({},this.defaults,e)};n.prototype={businessId:"",businessName:"",isTimeOut:!1,index:1,start:function(e,i){var n=this;t.ajax({type:"POST",url:"./queue.do",dataType:"json",data:{method:"inQueue",chatID:n.options.chatID,companyPk:n.options.companyPk,langPk:n.options.langPk,message:n.options.message,IpStr:n.options.IpStr}}).done(function(t){t&&(1==t.success?n.options.success(t):1==t.locked?n.start(e,i):1==t.inqueue?(n.getInfo(e,0,!1),n.options.always(t)):0==t.errorCode?n.getInfo(e,0,!1):0==t.server?n.options.fail(t):n.options.leave(t)),n.failTime=0}).fail(function(){n.failTime=n.failTime||(new Date).getTime(),(new Date).getTime()-n.failTime>9e3?n.options.fail({msg:"网络问题,您已离开"}):setTimeout(function(){n.start(e,i)},1e3)})},getInfo:function(e,i,n){var o=this;t.ajax({type:"POST",url:"./queue.do",dataType:"json",data:{method:"getBusinessQueue",chatID:o.options.chatID,companyPk:o.options.companyPk,langPk:o.options.langPk,message:o.options.message,businessId:e,index:i,isouttimes:n}}).done(function(t){t&&(1==t.success?(o.index!=t.index&&(o.index=t.index,o.options.always(t)),t.workgroupName?t.url&&o.options.success(t):1==t.inqueue?setTimeout(function(){o.options.always(t),o.getInfo(e,t.index,!1)},1e3):setTimeout(function(){o.getInfo(e,t.index,!1)},2e3)):1==t.locked?o.getInfo(e,o.index,!1):0==t.over?(o.isTimeOut=!0,o.options.fail(t),setTimeout(function(){1==o.isTimeOut&&o.getInfo(e,t.index,!0)},1e4)):0==t.server?o.options.fail(t):o.options.fail(t)),o.failTime=0}).fail(function(){o.failTime=o.failTime||(new Date).getTime(),(new Date).getTime()-o.failTime>9e3?o.options.fail({msg:"网络问题,您已离开"}):setTimeout(function(){o.getInfo(e,o.index,!1)},1e3)})},continueque:function(e,i,n){var o=this;t.ajax({type:"POST",url:"./queue.do",dataType:"json",data:{method:"continueBusinessQueue",chatID:o.options.chatID,companyPk:e,langPk:i,businessId:n}}).done(function(e){o.istimeout=!1,o.getInfo(n,0,!1),o.options.continueque(e)})}},t.queueManager=function(e){var t=new n(e);return t}}(window,jQuery),function(e,t,i){var n=function(e){this.defaults={chatId:"",storage:null},this.options=t.extend({},this.defaults,e)};n.prototype={list:{},get:function(e){var t=this.options.storage;if(t){var i=t.get("data");return i?i[e]:i}var n=this.options.chatId+e;return this.list[n]?this.list[n]:null},set:function(e,t){var i=this.options.storage;if(i){var n=i.get("data");n=n?n:{},n[e]=t,i.set("data",n)}else{var o=this.options.chatId+e;this.list[o]=t}}},t.db=function(e){var t=new n(e);return t}}(window,jQuery),function(e,t,i){var n=function(e){this.defaults={webSocket:null,timeStr:'<p class="dialogue-date">$1</p>',resendStr:'<div class="msg_sending" ><img src="style/images/sending.gif"></div>',callbackStr:'<div class="msg_repeat" ><img style="vertical-align: bottom;margin-right:5px;" src="style/images/repeat.png"></div>',msgEle:"#message",visitorId:"",historyEle:"#historyChat",textEle:".dialogue-area-write",storage:null,browserId:"",limitReceiveTime:60,changeFaceFun:null,chatId:"",detectWeb:null,userDatas:null,msgList:{reconnectSuc:"重连服务器成功！",reconnectFail:"网络异常，系统正尝试重连服务器！"},closeStrList:[["对话出现异常，对话结束.","對話出現異常，對話結束.","Dialogue is abnormal, the dialogue."],["对话结束，客服离开对话.","對話結束，客服離開對話。","End of the conversation, customer service left the conversation."],["对话超时，对话结束。","對話超時，對話結束。","Dialogue timeout, the end of the conversation.Dialogue timeout, the end of the conversation."],["您好，为了保证服务质量，我们已经结束了对话，期待再次为您服务。","對話關閉，客服結束對話","dialog closes, end customer dialogue."],["响应超时，对话结束。","響應超時，對話結束。","Response timeout, end of the conversation."],["您结束了对话。","您結束了對話。","You end the conversation."],["网络中断，如需继续对话，请<a href='javascript:void(0)' class='reconnectID'>点击此处</a>重新发起对话","網絡斷開，對話結束。","Network disconnection,end of the conversation."],["客服网络中断，当前对话结束，如需继续对话，请<a href='javascript:void(0)' onclick=''  class='reconnectID'>点击此处</a>重新接入。","客服网络中断，当前对话结束，如需继续对话，请重新接入。","Customer's Network has bean interrupted ,end of the conversation."],["网络异常，当前对话结束，如需继续对话，<a href='javascript:void(0)' onclick=''  class='reconnectID'>请重新接入</a>。","客服网络中断，当前对话结束，如需继续对话，请重新接入。","Network has bean interrupted ,end of the conversation."]],showSysMsgFun:function(e){},getReceivedFun:function(e){},msgReplace:function(e){},startChat:function(){},endChat:function(){},sendMessageFun:function(e,t){},msgFun:function(e){},closeTool:function(){},openTool:function(){},confirmSend:function(e,t){},specialFun:function(e,t){},endChatFun:function(){}},this.options=t.extend({},this.defaults,e)};n.prototype={msgPair:{},diaCount:0,isSpeech:!1,lastSend:"",diaList:new Object,readMessageTimeout:null,readMessageInterval:null,prevTextInterval:null,time:(new Date).getTime(),attr:{langType:0,islive:!1,operatorName:"",remoteUrl:"",_workGroupName:""},getAttr:function(e){return"undefined"!=typeof e?this.attr[e]:""},setAttr:function(e,t){this.attr[e]=t},islive:function(){return this.getAttr("islive")},showMsg:function(e){var i=e.msgid?e.msgid:"",n=e.date?e.date:"",o=e.content,a=e.from?e.from:"client",s=e.status?e.status:0,r=this.options.userDatas,c=this.options.msgReplace(a),l="client"==a,d=l?this.getAttr("operatorName"):"robot"==a?this.islive()?this.getAttr("operatorName"):"客服":r.getJsonStr().visitorName?r.getJsonStr().visitorName:"访客";if(o&&"null"!=o){var u=/^((ht|f)tps?):\/\/[\w\-]+(\.[\w\-]+)+([\w\-\.,@?^=%&:\/~\+#]*[\w\-\@?^=%&\/~\+#])?$/,p=t("<div>"+o+"</div>").text();if("client"==a&&u.test(p)&&o.indexOf("audio")<0){var g="<a href="+p+" target='_blank'>"+p+"</a>";o=g,this.options.specialFun("openWin",g)}if(o=this.messageChange(o),o=this.options.changeFaceFun.imgToIco(o),o=this.options.changeFaceFun.icoToImg(o),c=c.replace(/\$name/g,d).replace(/\$content/g,o).replace(/\$msgid/g,i).replace(/\$msgResend/g,"visitor"==a?this.options.resendStr+this.options.callbackStr:""),0!=s&&s){n||(n=(new Date).getTime());var m=this.options.timeStr.replace(/\$1/g,new Date(n).Format("yyyy-MM-dd hh:mm:ss"));t(this.options.historyEle).prepend(c),t(this.options.historyEle).prepend(m)}else{n||(n=(new Date).getTime());var m=this.options.timeStr.replace(/\$1/g,new Date(n).Format("hh:mm:ss"));t(this.options.msgEle).append(m),t(this.options.msgEle).append(c)}this.options.msgFun(e)}},messageChange:function(e){var i=e;try{if(i=JSON.parse(t("<div>"+e+"</div>").text()),"news"==i.msgType){var n={title:i.articles[0].title,summary:i.articles[0].summary,url:i.articles[0].url,img:i.articles[0].picUrl};i='<div class="message_news" data-url="'+n.url+'" ><div class="title">'+n.title+'</div><div class="content"><div class="summary">'+n.summary+'</div><div class="img"><img src="'+n.img+'"/></div></div></div>'}else if("IDCard"==i.type){var n={title:i.nickname,summary:i.summaryStr,url:i.detailURL,img:i.headURL?i.headURL:"./bootstrapUI/any800/images/client.png"};i='<div class="message_news IDCard" data-url="'+n.url+'" ><div class="img"><img src="'+n.img+'"/></div><div class="content"><div class="title">'+n.title+'</div><div class="summary">'+n.summary+"</div></div></div>"}else if("knowledgeCard"==i.type){var n={title:i.title,summary:i.description,url:i.url,img:i.coverUrl?i.coverUrl:"./bootstrapUI/any800/images/client.png"};i='<div class="message_news knowledgeCard" data-url="'+n.url+'" ><div class="content"><div class="title">'+n.title+'</div><div class="summary">'+n.summary+'</div><div class="img"><img src="'+n.img+'"/></div></div></div>'}else i=e}catch(o){}return i},showSysMsg:function(e,t){e&&"undefined"!=e&&"null"!=e&&this.options.showSysMsgFun(e,t)},start:function(){var t=this;t.setAttr("islive",!0),t.options.storage.set("browserId",t.options.browserId),t.options.webSocket&&t.options.webSocket.isWork?t.prevTextInterval=e.setInterval(function(){t.preVstText()},2e3):(t.startReadMessageTimeout(),clearInterval(t.prevTextInterval),clearInterval(t.readMessageInterval),t.readMessageInterval=e.setInterval(function(){(new Date).getTime()-t.time>1e4&&t.startReadMessageTimeout()},1e4),t.prevTextInterval=e.setInterval(function(){t.preVstText()},2e3)),t.toolFun(!0),t.options.startChat()},startReadMessageTimeout:function(){var t=this;t.time=(new Date).getTime(),t.readMessageTimeout&&clearTimeout(t.readMessageTimeout),t.readMessageTimeout=e.setTimeout(function(){t.readMessage()},1e3)},end:function(e){var t=this;t.islive()&&(t.setAttr("islive",!1),t.options.webSocket&&t.options.webSocket.isWork||(t.readMessageTimeout&&clearTimeout(t.readMessageTimeout),t.readMessageTimeout=null,clearInterval(t.readMessageInterval),t.readMessageInterval=null,clearInterval(t.prevTextInterval),t.prevTextInterval=null),t.toolFun(!1),"number"==typeof e&&(t.options.storage.set("browserId",""),t.showSysMsg(this.options.closeStrList[e],!0),t.options.endChat()),t.options.endChatFun())},readMessage:function(){var e=this,i=e.options.detectWeb;e.getAttr("remoteUrl")&&t.ajax({type:"POST",url:"./echat.do",dataType:"json",async:!1,cache:!1,data:{method:"readMessage",chatID:e.options.chatId,url:e.getAttr("remoteUrl")}}).done(function(t){e.startReadMessageTimeout();try{i.getIsInitiate()&&e.showSysMsg(e.options.msgList.reconnectSuc),e.messageDeal(t),i.getIsInitiate()&&(e.toolFun(!0),i.checkedSuccess())}catch(n){}}).fail(function(t){e.startReadMessageTimeout(),i.getIsInitiate()||(e.toolFun(!1),e.showSysMsg(e.options.msgList.reconnectFail),i.checkedFail())})},messageDeal:function(e){var t=this,i=t.options.detectWeb;if(e&&e.root){if(0==e.root.length)return!1;for(var n=0;n<e.root.length;n++){var o=e.root[n].type.text;if("200"==o){if(e.root[n].from&&""!=e.root[n].date)if(e.root[n].langType>0&&e.root[n].langKey>0);else{var a=JSON.parse(e.root[n].text);t.addDiaList(a.messageId,(new Date).getTime(),a.content,0,"client"),"object"==typeof a.content&&(a.content=JSON.stringify(a.content)),a.content=a.content.replace(/\n/gi,"<br>"),t.showMsg({msgid:a.messageId,date:(new Date).getTime(),content:a.content,from:"client",status:0}),t.options.specialFun("200",{msgid:a.messageId,content:a.content,time:(new Date).getTime()}),i.msgPush("customer",a.content)}}else if("700"==o)t.options.specialFun("700",e.root[n]);else if("900"==o)i.getIsInitiate()?t.end(6):t.end(2),t.options.specialFun("900","");else if("901"==o)t.end(3),t.options.specialFun("901","");else if("110"==o)t.end(7),t.options.specialFun("110","");else if("111"==o){if(t.toolFun(!0),t.showMsg({msgid:"",date:(new Date).getTime(),content:JSON.parse(e.root[n].text).content,from:"client",status:0,saveIn:1}),i.getIsReconnection()){var s="["+i.getMsgs(5).join(",")+"]";t.sendMessage(s,"offLineMessage")}t.options.specialFun("111",e.root[n])}else"112"==o?(t.showMsg({msgid:"",date:(new Date).getTime(),content:JSON.parse(e.root[n].text).content,from:"client",status:0}),t.end(0),t.options.specialFun("112",e.root[n])):"113"==o?t.options.specialFun("113",e.root[n].text):"114"==o?t.options.specialFun("114",e.root[n].text):"902"==o&&t.islive()&&(t.options.specialFun("902",e.root[n].text),t.end(2))}}},addDiaList:function(e,t,i,n,o){return e||(e="Other"+(new Date).getTime(),this.diaCount++),this.diaList[e]={time:t,from:o,content:i,status:n,isReceived:"client"==o?1:0,receivedTime:0},e},getReceived:function(){var e=this,i=this.diaList,n=[];for(var o in i)0==i[o].isReceived&&n.push(o);for(var a in n)isNaN(Number(a))||t.ajax({type:"post",url:"echat.do?method=getReceivedMID",async:!1,data:{messageId:e.msgPair[n[a]],workGroupName:this.getAttr("_workGroupName")},dataType:"json",success:function(t){e.options.getReceivedFun(n[a]),e.diaList[n[a]].isReceived=1,e.options.confirmSend(n[a]),t.success||(e.diaList[n[a]].receivedTime>=e.options.limitReceiveTime?e.diaList[n[a]].isReceived=2:e.diaList[n[a]].receivedTime++)}})},preVstText:function(){var e=(this.lastSend,t(this.options.textEle).text().replace(/\s+/g,""));this.lastSend!=e&&(this.lastSend=e,e?this.sendMessage(e,"foreknowledge"):this.sendMessage(" ","foreknowledge"))},sendMessage:function(e,i,n){var o=this;"acceptRq"==i&&(this.isSpeech=!0),"offLineMessage"==i||"send_file"!=i||(i=""),e=e.replace(/<a/g,"<a target='_blank'");var a=o.addDiaList("",(new Date).getTime(),e,0,"visitor"),s=(new Date).getTime();return i||n||(o.showMsg({msgid:a,date:s,content:e,from:"visitor",status:0}),o.options.sendMessageFun(a,e)),o.options.webSocket&&o.options.webSocket.isWork&&!i?void o.options.webSocket.send({date:s,message:e,chatID:o.options.chatId}):void t.ajax({type:"POST",url:"./echat.do",dataType:"json",async:!1,cache:!1,data:{method:"sendMessage",chatID:o.options.chatId,message:e,code:i?i:"",url:o.getAttr("remoteUrl"),visitorId:o.options.visitorId}}).done(function(e){if(1==e.success){var t=e.messageId;"back"==e.message?o.options.confirmSend(t):o.options.confirmSend(t,"add"),o.msgPair[a]=t,o.callbackFun(a,t)}})},callbackFun:function(e,i){var n=this;setTimeout(function(){n.diaList[e].isReceived||t("[name="+e+"] .msg_").html(n.options.callbackStr)},6e4)},toolFun:function(e){e?this.options.openTool():this.options.closeTool()}},t.dialogue=function(e){var t=new n(e);return t}}(window,jQuery),function(e,t,i){var n=function(e){this.defaults={detectWeb:function(){}},this.options=t.extend({},this.defaults,e)};n.prototype={beatInterval:null,beatTimeout:null,json:{},init:function(e){},startBeatTimeout:function(e){},end:function(){}},t.heartBeat=function(e){var t=new n(e);return t}}(window,jQuery),function(e,t,i){var n=function(e){this.defaults={dialogue:null,companyPk:"",langPk:"",chatId:"",title:"满意度调查",top:"您对本次服务满意吗？",bottom:"<div class='bottom'><div class='cancel'>取消</div><div class='submit'>确定</div></div>",generate:function(){}},this.options=t.extend({},this.defaults,e)};n.prototype={hasSat:!1,init:function(){var e=this;t.ajax({type:"POST",url:"./echatManager.do",dataType:"json",async:!1,data:{method:"getSatisfaction",companyPk:e.options.companyPk,langPk:e.options.langPk,chatID:e.options.chatId}}).done(function(t){t&&(e.hasSat=!0,e.createView(t))})},check:function(e){},cancel:function(){this.options.dialogue.sendMessage("访客取消了满意度评价","cancelSatisfaction"),this.hide()},createView:function(e){t(".satisfactionView").length>0&&t(".satisfactionView").remove();var i="<div class='satisfactionView view'><div class='board'></div></div>",n="<div class='fr' data-pk='$1' data-parent='$2' data-name='$3'></div>",o="<div class='sr' data-pk='$1' data-parent='$2' data-name='$3'></div>";t("body").append(i);var a="<div class='title'>"+this.options.title+"<span class='cross'><img src='./style/css/images/shut.png'></span></div>";a+="<div class='body'><div class='top'>"+this.options.top+"</div>";for(var s=0,r=e.length;s<r;s++){var c=e[s];if(a+=n.replace(/\$1/g,c.pk).replace(/\$2/g,c.parentPk).replace(/\$3/g,c.name),c.children.length>0)for(var l=0,d=c.children.length;l<d;l++){var u=c.children[l];a+=o.replace(/\$1/g,u.pk).replace(/\$2/g,u.parentPk).replace(/\$3/g,u.name)}}a+="<div class='mome'><textarea placeholder='请输入详情'></textarea></div></div>",a+=this.options.bottom,t(".satisfactionView .board").html(a),this.hide(),this.options.generate()},getElement:function(e){return t(".satisfactionView .board [data-pk='"+e+"']")},getElementByParent:function(e){return t(".satisfactionView .board [data-parent='"+e+"']")},submit:function(e){var i=this,n=this.options.dialogue;t.ajax({type:"POST",url:"./echatManager.do",dataType:"json",data:{method:"saveSatisfaction",companyPk:i.options.companyPk,chatID:i.options.chatId,satisfactionPk:e.satisfactionPk,optionPk:e.optionPk,satisfactionMemo:e.satisfactionMemo,nextSatisfactionPk:e.nextSatisfactionPk,rndVar:(new Date).getTime()}}).done(function(){var t=i.getElement(e.optionPk).attr("data-name"),o="，原因为：",a="";if(e.nextSatisfactionPk){var s=e.nextSatisfactionPk.split(",");for(var r in s)s[r]&&i.getElement(s[r]).attr("data-name")&&(a+=i.getElement(s[r]).attr("data-name")+",")}a.lastIndexOf(",")==a.length-1&&(a=a.substring(0,a.length-1)),a&&(a=o+a);var c="访客给您的满意度评价是："+t+a;n.sendMessage(c,"",!0),n.showSysMsg("您给客服"+n.getAttr("operatorName")+"的评价："+t+a)}),this.hide()},show:function(){this.hasSat&&(t(".satisfactionView").show(),t(".satisfactionView .board").css({marginTop:"-220px"}),t(".satisfactionView textarea").focus().blur(),t(".satisfactionView input,.satisfactionView textarea").not(".hasplaceholder").placeholder())},hide:function(){t(".satisfactionView").hide()}},t.satisfaction=function(e){var t=new n(e);return t}}(window,jQuery),function(e,t,i){function n(e,t){return function(i,n){return t?~~(i[e]<n[e]):~~(i[e]>n[e])}}var o=function(e){this.defaults={Alert:null,messageDisplay:[],messageContent:"",messageTypeList:[],warn:".warn",title:"请留言",bottom:"<div class='bottom'><div class='cancel'>取消</div><div class='submit'>确定</div></div>",generate:function(e){},reset:function(e){},warn:function(e,t){}},this.options=t.extend({},this.defaults,e)},a=function(e,t){for(var i=e,t=t||function(e,t){return t>e},n=1,o=i.length;n<o;n++){for(var a=i[n],s=n-1;s>=0&&t(i[s],a);)i[s+1]=i[s],s--;i[s+1]=a}return i};o.prototype={hasCreate:!1,init:function(){var e=this;e.options.messageDisplay.length>0&&(e.options.messageDisplay=a(e.options.messageDisplay,n("sort",!1)),e.createView(),e.hasCreate=!0)},check:function(e){var i=this;t(".leaveMessageView .col").removeClass("warn");var n=!0;return t(".leaveMessageView .col").each(function(o,a){var s=t(this);if(0!=n&&(!e||s.data("displayname")==e)){if("company"==s.data("displayname")){if(1==s.data("require")&&""==s.find("input").val())return i.options.warn(s,"公司名称不能为空"),s.addClass("warn"),void(n=!1);if(s.find("input").val().length>30)return i.options.warn(s,"公司名称最大长度为30字符"),s.addClass("warn"),void(n=!1)}if("name"==s.data("displayname")){if(1==s.data("require")&&""==s.find("input").val())return i.options.warn(s,"姓名不能为空"),s.addClass("warn"),void(n=!1);if(s.find("input").val().length>20)return i.options.warn(s,"姓名最大长度为20字符"),s.addClass("warn"),void(n=!1)}if("telephone"==s.data("displayname")){if(1==s.data("require")&&""==s.find("input").val())return i.options.warn(s,"电话不能为空"),s.addClass("warn"),void(n=!1);if(""==s.find("input").val())return;var r=new RegExp(/^[1][0-9]{1}[0-9]{9}$/);if(!r.test(s.find("input").val()))return i.options.warn(s,"请填写正确的电话"),s.addClass("warn"),void(n=!1)}if("email"==s.data("displayname")){if(1==s.data("require")&&""==s.find("input").val())return i.options.warn(s,"电子邮件不能为空"),s.addClass("warn"),void(n=!1);if(""==s.find("input").val())return;var c=new RegExp(/^[\-\._A-Za-z0-9]+@([_A-Za-z0-9\-]+\.)+[A-Za-z0-9]{2,3}$/);if(!c.test(s.find("input").val()))return i.options.warn(s,"请填写正确的电子邮件"),s.addClass("warn"),void(n=!1);if(s.find("input").val().length>50)return i.options.warn(s,"电子邮件最大长度为50字符"),s.addClass("warn"),void(n=!1)}if("title"==s.data("displayname")){if(1==s.data("require")&&""==s.find("input").val())return i.options.warn(s,"主题不能为空"),s.addClass("warn"),void(n=!1);if(s.find("input").val().length>50)return i.options.warn(s,"主题最大长度为50字符"),s.addClass("warn"),void(n=!1)}if("content"==s.data("displayname")){if(1==s.data("require")&&""==s.find("textarea").val())return i.options.warn(s,"内容不能为空"),s.addClass("warn"),void(n=!1);if(s.find("textarea").val().length>1e3)return i.options.warn(s,"内容最大长度为1000字符"),s.addClass("warn"),void(n=!1)}}}),n},cancel:function(){this.hide()},createView:function(){var e=this;t(".leaveMessageView").length>0&&t(".leaveMessageView").remove();var i="<div class='leaveMessageView view'><div class='board'></div></div>";t("body").append(i);var n="<div class='title'>"+e.options.title+"<span class='cross'><img src='./style/css/images/shut.png'></span></div>";n+="<div class='body'>",e.options.messageContent&&(n+="<div class='top'>"+e.options.messageContent+"</div>");var o="<div class='col' data-type='$0' data-require='$1' data-name='$2' data-markedwords='$3' data-displayname='$4' ></div>";for(var a in e.options.messageDisplay){var s=e.options.messageDisplay[a];1==s.display&&"messageTypePk"==s.displayName&&(n+=o.replace(/\$0/g,s.judgeDisplay).replace(/\$1/g,s.required).replace(/\$2/g,s.name).replace(/\$3/g,s.markedWords).replace(/\$4/g,s.displayName))}for(var a in e.options.messageDisplay){var s=e.options.messageDisplay[a];1==s.display&&"messageTypePk"!=s.displayName&&(n+=o.replace(/\$0/g,s.judgeDisplay).replace(/\$1/g,s.required).replace(/\$2/g,s.name).replace(/\$3/g,s.markedWords).replace(/\$4/g,s.displayName))}n+="</div>",n+=this.options.bottom,t(".leaveMessageView .board").html(n),this.hide(),this.options.generate(e.options.messageTypeList)},submit:function(e){var i=this,n=i.options.Alert;if(!i.check())return!1;if(!e.messageTypePk)return i.options.warn(t(".leaveMessageView [data-displayname='messageTypePk']"),"请选择留言分类"),t(".leaveMessageView [data-displayname='messageTypePk']").addClass("warn"),void(can=!1);var o=e.content;try{o=encodeURIComponent(encodeURIComponent(o))}catch(a){}t.ajax({type:"POST",url:"./echatManager.do",dataType:"json",data:{method:"saveMessageBox",messageTypePk:e.messageTypePk,companyPk:i.options.companyPk,name:e.name,telephone:e.telephone,email:e.email,title:e.title,content:e.content,company:e.company,brand:e.brand,contentencode:o}}).done(function(e){1==e.success?(n.show(e.msg),i.reset(),i.hide()):n.show(e.msg)}),i.hide()},reset:function(e){this.options.reset},show:function(){this.hasCreate&&(t(".leaveMessageView").show(),t(".leaveMessageView .board").css({marginTop:-t(".leaveMessageView .board").height()/2}),t(".leaveMessageView input,.leaveMessageView textarea").not(".hasplaceholder").placeholder())},hide:function(){t(".leaveMessageView").hide()}},t.leaveMessage=function(e){var t=new o(e);return t.init(),t}}(window,jQuery),function(e,t,i){var n=function(e){this.defaults={storage:null,Alert:null,title:"请填写以下信息",storageVisitor:"visitor",bottom:"<div class='bottom'><div class='cancel'>取消</div><div class='submit'>确定</div></div>",generate:function(e){},warn:function(e,t){},submitFun:function(){},cancelFun:function(){}},this.options=t.extend({},this.defaults,e)};n.prototype={hasCreate:!1,visitor:{visitorId:"",company:"",visitorName:"",sex:"0",degree:"",realName:"",phone:"",mobile:"",email:"",QQ:"",MSN:"",address:"",extension:"",memberId:""},init:function(){var e=this,t=e.options.storage;t.get(e.options.storageVisitor)&&(e.visitor=t.get(e.options.storageVisitor)),e.createView(),e.hasCreate=!0},check:function(){var e=this;t(".visitorInformationView .col").removeClass("warn");var i=!0;return t(".visitorInformationView .col").each(function(n,o){var a=t(this);if(0!=i){if("visitorName"==a.data("displayname")){var s=new RegExp(/^[a-zA-Z0-9\u4e00-\u9fa5]+(\s[a-zA-Z0-9\u4e00-\u9fa5]+|)$/);if(1==a.data("require")&&""==a.find("input").val())return e.options.warn(a,"昵称不能为空"),a.addClass("warn"),void(i=!1);if(a.find("input").val().length>20)return e.options.warn(a,"昵称最大长度为20字符"),a.addClass("warn"),void(i=!1);if(!s.test(a.find("input").val()))return e.options.warn(a,"请输入中文、英文和数字！"),a.addClass("warn"),void(i=!1)}if("realName"==a.data("displayname")&&a.find("input").val().length>20)return e.options.warn(a,"姓名最大长度为20字符"),a.addClass("warn"),void(i=!1);if("phone"==a.data("displayname")){if(""==a.find("input").val())return;var r=new RegExp(/^[1][0-9]{1}[0-9]{9}$/);if(!r.test(a.find("input").val()))return e.options.warn(a,"请填写正确的手机号码"),a.addClass("warn"),void(i=!1)}if("phone"==a.data("displayname")){if(""==a.find("input").val())return;var r=new RegExp(/^[1][0-9]{1}[0-9]{9}$/);if(!r.test(a.find("input").val()))return e.options.warn(a,"请填写正确的手机号码"),a.addClass("warn"),void(i=!1)}if("QQ"==a.data("displayname")&&a.find("input").val().length>20)return e.options.warn(a,"QQ最大长度为20字符"),a.addClass("warn"),void(i=!1);if("email"==a.data("displayname")){if(""==a.find("input").val())return;var s=new RegExp(/^[\-\._A-Za-z0-9]+@([_A-Za-z0-9\-]+\.)+[A-Za-z0-9]{2,3}$/);if(!s.test(a.find("input").val()))return e.options.warn(a,"请填写正确的邮箱"),a.addClass("warn"),void(i=!1);if(a.find("input").val().length>50)return e.options.warn(a,"邮箱最大长度为50字符"),a.addClass("warn"),void(i=!1)}return"address"==a.data("displayname")&&a.find("input").val().length>50?(e.options.warn(a,"地址最大长度为50字符"),a.addClass("warn"),void(i=!1)):"company"==a.data("displayname")&&a.find("input").val().length>50?(e.options.warn(a,"公司名称最大长度为50字符"),a.addClass("warn"),void(i=!1)):void 0}}),i},cancel:function(){this.options.cancelFun(),this.hide()},createView:function(){var e=this;t(".visitorInformationView").length>0&&t(".visitorInformationView").remove();var i="<div class='visitorInformationView view'><div class='board'></div></div>";t("body").append(i);var n="<div class='title'>"+e.options.title+"<span class='cross'><img src='./style/css/images/shut.png'></span></div>";n+="<div class='body'>",n+="<div class='col' data-type='input' data-require='1' data-name='昵称' data-placeholder='请输入昵称' data-displayname='visitorName' ></div>",n+="<div class='col' data-type='radio' data-require='0' data-name='性别'  data-markedwords='"+(e.visitor.sex?e.visitor.sex:"")+"' data-displayname='sex' ></div>",n+="<div class='col' data-type='input' data-require='0' data-name='姓名' data-placeholder='请输入姓名' data-markedwords='"+(e.visitor.realName?e.visitor.realName:"")+"' data-displayname='realName' ></div>",n+="<div class='col' data-type='input' data-require='0' data-name='手机' data-placeholder='请输入手机号码' data-markedwords='"+(e.visitor.phone?e.visitor.phone:"")+"' data-displayname='phone' ></div>",n+="<div class='col' data-type='input' data-require='0' data-name='QQ' data-placeholder='请输入QQ号码' data-markedwords='"+(e.visitor.QQ?e.visitor.QQ:"")+"' data-displayname='QQ' ></div>",n+="<div class='col' data-type='input' data-require='0' data-name='邮箱' data-placeholder='请输入邮箱地址' data-markedwords='"+(e.visitor.email?e.visitor.email:"")+"' data-displayname='email' ></div>",n+="<div class='col' data-type='input' data-require='0' data-name='地址' data-placeholder='请输入地址' data-markedwords='"+(e.visitor.address?e.visitor.address:"")+"' data-displayname='address' ></div>",n+="<div class='col' data-type='input' data-require='0' data-name='公司' data-placeholder='请输入公司名称' data-markedwords='"+(e.visitor.company?e.visitor.company:"")+"' data-displayname='company' ></div>",n+="</div>",n+=this.options.bottom,t(".visitorInformationView .board").html(n),this.hide(),this.options.generate()},submit:function(e){var i=this,n=i.options.storage;if(i.check()){var o=n.get(i.options.storageVisitor);o=t.extend({},o,e),n.set(i.options.storageVisitor,o),i.visitor=o,n.set("isSave",0),i.options.submitFun(i.visitor),i.hide()}},show:function(){this.hasCreate&&(t(".visitorInformationView").show(),t(".visitorInformationView .board").css({marginTop:-t(".visitorInformationView .board").height()/2}))},hide:function(){t(".visitorInformationView").hide()}},t.visitorInformation=function(e){var t=new n(e);return t.init(),t}}(window,jQuery),function(e,t,i){var n=function(e){this.defaults={show:!0,visitorId:"",companyPk:"",leavePre:"离线消息:",maxDia:5,dialogue:null,generation:function(){},checkFun:function(e){}},this.options=t.extend({},this.defaults,e)};n.prototype={page:1,historyDias:[],leaveDias:[],over:!1,cur:1,num:0,more:!0,showHistoryDia:function(){if(0!=this.options.show){var e=this,t=this.options.dialogue;for(var i in e.historyDias)if(!isNaN(Number(i)))for(var n in e.historyDias[i].content.dia)if(!isNaN(Number(i))){var o=e.historyDias[i].content.dia[n];!o.hasShown&&o.num<e.cur*e.options.maxDia&&(e.historyDias[i].content.dia[n].hasShown=!0,t.showMsg({date:Number(new Date(o.time.replace(/-/g,"/")).getTime()),from:o.from,content:o.content,status:1}))}}},showLeaveChat:function(e){var t=this,i=this.options.dialogue;for(var n in t.leaveDias)isNaN(Number(n))||i.showMsg({from:t.leaveDias[n].from,content:t.leaveDias[n].content,status:1,date:t.leaveDias[n].date})},init:function(){this.options.generation()},check:function(e){this.getSum()<this.cur*this.options.maxDia+1&&!this.over?(this.getHistoryDialogue(),this.check()):(this.showHistoryDia(),this.cur++),this.more=!this.over||!(this.getSum()<this.cur*this.options.maxDia+1),this.options.checkFun()},changeToContent:function(e){for(var i=this,n=0,o=[],a=t("<div>"+e+"</div>").find(".sevice_chat,.me_chat,.robot_chat"),s=a.length-1;s>=0;s--)0==t(a[s]).find(".msg_back_success").length&&(o.push({from:"sevice_chat"==a[s].className?"client":"robot_chat"==a[s].className?"robot":"visitor",content:t(a[s]).find("content").html(),hasShown:!1,num:i.num,time:t(a[s]).find("time").html()}),i.num++,n++);return{sum:n,dia:o}},getSum:function(){var e=this,t=0;for(var i in e.historyDias)isNaN(Number(i))||(t+=e.historyDias[i].content.sum);return t},getHistoryDialogue:function(){var e=this;t.ajax({url:"./historyOperator.do",type:"POST",async:!1,dataType:"json",data:{method:"getHistoryDialogue",page:e.page,visitorId:e.options.visitorId,companyPk:e.options.companyPk}}).done(function(t){if(!t||0==t.length)return void(e.over=!0);for(var i in t)if(!isNaN(Number(i))){var n=e.changeToContent(t[i].content,t[i].from);e.historyDias.push({time:new Date(t[i].leaveTime.replace(/-/g,"/")).getTime(),content:n})}e.page++}).fail(function(){e.over=!0})},getLeaveChat:function(){var e=this;t.ajax({type:"post",async:!1,url:"historyOperator.do",dataType:"json",data:{method:"getLeaveChat",visitorId:e.options.visitorId}}).done(function(t){if(0!=t.length){t=t.reverse();for(var i in t)if(!isNaN(Number(i))){
var n=t[i].content;if("string"!=typeof n)try{n=JSON.stringify(n)}catch(o){}n=dialogue.messageChange(n),e.leaveDias.push({content:e.options.leavePre+""+n,from:"client"})}}})}},t.history=function(e){var t=new n(e);return t}}(window,jQuery),function(e,t,i){var n=function(e){this.defaults={visitorName:"",visitorId:"",ecselfList:null,langPk:"",dialogue:null,robotSetting:2,companyPk:"",chatId:"",ywList:"ff80808150db355d0150e12f11a90388",confidence:60,changeToNormal:function(e){}},this.options=t.extend({},this.defaults,e)};n.prototype={isUse:!0,choose:!1,ncRobotTime:0,nc:{number:2,answer:"非常抱歉，不能回答你的问题。如需进一步咨询，请点击这里，转接人工客服。",questions:"投诉".split(";")},recored:[],click:!1,init:function(){var e=this;2==e.options.robotSetting&&(e.isUse=!1);var t=e.options.ecselfList;if(t)for(var i in t){var n=t[i];n.eclangPk&&n.eclangPk==e.options.langPk&&(e.nc={number:n.number||e.nc.number,answer:n.answer||e.nc.answer,questions:n.questions?n.questions.split(";"):""})}4==e.options.robotSetting&&(e.nc.answer=e.nc.answer.replace(e.clientJump,e.clientJumpReplace))},check:function(e){var t=this,i=t.options.dialogue;return!!t.isUse&&(e&&(i.showMsg({date:(new Date).getTime(),content:e,from:"visitor",status:0}),t.recored.push({date:(new Date).getTime(),content:e,from:"visitor",status:0})),3==t.options.robotSetting?t.iRobot(e):(1==t.options.robotSetting||4==t.options.robotSetting)&&t.options.ywList.indexOf(t.options.companyPk)>-1?t.ywRobot(e):4==t.options.robotSetting&&t.nc?t.umpRobot(e):1==t.options.robotSetting&&t.oldNcRobot(e),!0)},clientJump:"请点击这里",clientJumpReplace:'请点击<a style="color:blue;" class="robotResp">这里</a>',multipleRobot:function(e){if(e){var i=this,n=i.options.dialogue;t.ajax({type:"POST",url:"echatManager.do",data:{method:"getAnswer",companyPk:i.options.companyPk,visitorId:i.options.visitorId,chatId:i.options.chatId,channel:"web",question:e},dataType:"json"}).done(function(t){if(i.click=!1,t.response&&t.response.length>0){var o=t.response[0].content;if(t.suggestions&&t.suggestions.length>=1)for(var a=0,s=t.suggestions.length;a<s;a++)o+="<b/><div class='robotSuggsetion'>"+t.suggestions[a]+"</div>";n.showMsg({date:(new Date).getTime(),content:o,from:"robot"}),i.recored.push({date:(new Date).getTime(),content:o,from:"robot"})}else i.multipleFail(e)}).fail(function(){i.isUse&&(i.click=!1,i.multipleFail(e))})}},multipleFail:function(e){var t=robot.nc.questions.indexOf(e);return t==-1?(dialogue.showMsg({date:(new Date).getTime(),content:robot.nc.answer,from:"robot"}),void robot.recored.push({date:(new Date).getTime(),content:robot.nc.answer,from:"robot"})):void(robot.choose||(1==robot.choose,robot.cf||(robot.cf=confirm("不能查找到答案，是否需要转人工服务?"),1==robot.cf?(robot.options.changeToNormal(),robot.choose=!1):(robot.cf=null,dialogue.showMsg({date:(new Date).getTime(),content:robot.nc.answer,from:"robot"}),robot.recored.push({date:(new Date).getTime(),content:robot.nc.answer,from:"robot"}),robot.choose=!1))))},umpRobot:function(e){if(e){var i=this,n=i.options.dialogue;t.ajax({type:"POST",url:"echatManager.do",data:{method:"getAnswer",companyPk:i.options.companyPk,visitorId:i.options.visitorId,chatId:i.options.chatId,codeKey:ucc.codeKey,userName:i.options.visitorName,question:e},dataType:"json"}).done(function(o){if(i.click=!1,o.response){if(1==o.response.length)if(!o.response[0].type||"0"!=o.response[0].type&&"5"!=o.response[0].type){if(o.suggestions&&o.suggestions.length>=1){var a=o.response[0].content;if(o.response[0].content.indexOf("以上答案是否解决了您的问题：")>0&&o.response[0].content.indexOf('"]解决')>0&&o.response[0].content.indexOf("]未解决[/link]")>0){a=o.response[0].content.split("以上答案是否解决了您的问题：")[0],a="<b>"+a+"</b>";var s=o.response[0].content.split("以上答案是否解决了您的问题：")[1],r=new RegExp("\\[/link\\]","g"),c=new RegExp('"\\]未解决',"g"),l=new RegExp('"\\]解决',"g"),d=new RegExp("\\]","g"),u=new RegExp("\\d{0,3}.\\[link submit=","g"),p=new RegExp('\\[link submit="faqvote:',"g");faqVoteID++;var g="unsolved"+faqVoteID,m="solved"+faqVoteID,f="','0','"+faqVoteID+"')\" href='javascript:void(0);' id='"+g+"'>未解决",h="','1','"+faqVoteID+"')\" href='javascript:void(0);' id='"+m+"'>解决";s=s.replace(r,"</a> "),s=s.replace(p,"<a class = 'faqVoted' onClick=\"faqVoted('faqvote:"),s=s.replace(u,'<a onClick="exportMessage('),s=s.replace(c,f),s=s.replace(l,h),s=s.replace(d,")\" href='javascript:void(0);'>"),a=a+"以上答案是否解决了您的问题："+s}else a="<b>"+a+"</b>";if(o.suggestions&&o.suggestions.length>=1){a+="<br>您可能关注以下问题：<br>";for(var v=0,w=o.suggestions.length;v<w;v++)a+="<b/><div class='robotSuggsetion'>"+o.suggestions[v]+"</div>"}a=a.replace(/\r\n/g,"<br>");var y=/[link[^>]*url="([^"]*)"[^>]*]/g;if(null!=y.exec(a))a=a.replace(/\[link[^\]]*\]/g,"<a href='"+RegExp.$1+"'>").replace(/\[\/link\]/g,"</a>");else{for(var b=/[link[^>]*submit=['"]([\s\S]*?)['"]]([\s\S]*?)[\/link]/g,k=new Array,I=new Array;null!=b.exec(a);)k.push(RegExp.$1),I.push(RegExp.$2);a=a.replace(/\[link[^\]]*\]/g,"<a href='javascript:'  class='robotSuggsetion' style='text-decoration:none;'>").replace(/\[\/link\]/g,"</a>")}}else{var T="";if(o.response[0].content.indexOf("assetQuery")>0&&(T=JSON.parse(o.response[0].content)),""!=T&&"00"===T.assetQuery.code)var a="总资产："+T.assetQuery.model.sumAssets+"<br>银宝通："+T.assetQuery.model.lurpak+"<br>私募基金："+T.assetQuery.model.privatePlacement+"<br>公募基金："+T.assetQuery.model.publicPlacement+"<br>";else if(""!=T&&"99"===T.assetQuery.code)var a="查询无结果";else{var a=o.response[0].content;if(o.response[0].content.indexOf("以上答案是否解决了您的问题：")>0&&o.response[0].content.indexOf('"]解决')>0&&o.response[0].content.indexOf("]未解决[/link]")>0){a=o.response[0].content.split("以上答案是否解决了您的问题：")[0],a="<b>"+a+"</b>";var s=o.response[0].content.split("以上答案是否解决了您的问题：")[1],r=new RegExp("\\[/link\\]","g"),c=new RegExp('"\\]未解决',"g"),l=new RegExp('"\\]解决',"g"),d=new RegExp("\\]","g"),u=new RegExp("\\d{0,3}.\\[link submit=","g"),p=new RegExp('\\[link submit="faqvote:',"g");faqVoteID++;var g="unsolved"+faqVoteID,m="solved"+faqVoteID,f="','0','"+faqVoteID+"')\" href='javascript:void(0);' id='"+g+"'>未解决",h="','1','"+faqVoteID+"')\" href='javascript:void(0);' id='"+m+"'>解决";s=s.replace(r,"</a> "),s=s.replace(p,"<a class = 'faqVoted' onClick=\"faqVoted('faqvote:"),s=s.replace(u,'<a onClick="exportMessage('),s=s.replace(c,f),s=s.replace(l,h),s=s.replace(d,")\" href='javascript:void(0);'>"),a=a+"以上答案是否解决了您的问题："+s}a=a.replace(/\r\n/g,"<br>");var y=/[link[^>]*url="([^"]*)"[^>]*]/g;if(null!=y.exec(a))a=a.replace(/\[link[^\]]*\]/g,"<a href='"+RegExp.$1+"'>").replace(/\[\/link\]/g,"</a>");else{for(var b=/[link[^>]*submit=['"]([\s\S]*?)['"]]([\s\S]*?)[\/link]/g,k=new Array,I=new Array;null!=b.exec(a);)k.push(RegExp.$1),I.push(RegExp.$2);a=a.replace(/\[link[^\]]*\]/g,"<a href='javascript:'  class='robotSuggsetion' style='text-decoration:none;'>").replace(/\[\/link\]/g,"</a>")}}}if(o.response[0].content.indexOf("acs")!=-1&&o.response[0].type>100)return i.options.changeToNormal(),void clearInterval(i.iShowAutoTextInit);n.showMsg({date:(new Date).getTime(),content:a,from:"robot"}),t(".cssWriteMsg").click(function(){t(this).unbind();var e=t(this).html();return"转人工"==e?(i.options.changeToNormal(),void clearInterval(i.iShowAutoTextInit)):(t(".dialogue-area-write").html(e),t("#dialogue-footer-text").html(e),t("#autodiv").hide(),uccPcEvent.sendMsg(),void 0)}),i.recored.push({date:(new Date).getTime(),content:a,from:"robot"})}else{var a="您这个问题还真把我难住了，待我再去学习学习，下次见面再告诉您，您可以先咨询其他问题或点击<a  style='color:blue;' class='robotResp'>人工客服</a>哦";n.showMsg({date:(new Date).getTime(),content:a,from:"robot"}),t(".cssWriteMsg").click(function(){t(this).unbind();var e=t(this).html();return"转人工"==e?(i.options.changeToNormal(),void clearInterval(i.iShowAutoTextInit)):(t(".dialogue-area-write").html(e),t("#dialogue-footer-text").html(e),t("#autodiv").hide(),uccPcEvent.sendMsg(),void 0)}),i.recored.push({date:(new Date).getTime(),content:a,from:"robot"})}}else i.answerFail(e)}).fail(function(){i.isUse&&(i.click=!1,i.answerFail(e))})}},answerFail:function(e){if(robot.ncRobotTime++,robot.ncRobotTime>=robot.nc.number){if(robot.choose)return;1==robot.choose,robot.cf||(robot.cf=confirm("不能查找到答案，是否需要转人工服务?"),1==robot.cf?(robot.options.changeToNormal(),robot.choose=!1):(robot.cf=null,dialogue.showMsg({date:(new Date).getTime(),content:robot.nc.answer,from:"robot"}),robot.recored.push({date:(new Date).getTime(),content:robot.nc.answer,from:"robot"}),robot.choose=!1,robot.ncRobotTime=0))}else{var t=0;for(var i in robot.nc.questions){var n=robot.nc.questions[i];if(n==e){if(t=1,robot.choose)return;1==robot.choose,robot.cf||(robot.cf=confirm("不能查找到答案，是否需要转人工服务?"),1==robot.cf?(robot.choose=!1,robot.options.changeToNormal()):(robot.cf=null,t=0,robot.choose=!1,robot.ncRobotTime=0))}}0==t&&(dialogue.showMsg({date:(new Date).getTime(),content:robot.nc.answer,from:"robot"}),robot.recored.push({date:(new Date).getTime(),content:robot.nc.answer,from:"robot"}))}},iRobot:function(e){if(e){var i=this;t.ajax({url:"http://vdev.icontek.com:28080/queryj/x/ROOT->ucctest/"+i.options.companyPk+(new Date).getTime()+"/"+e}).done(function(e){var t="";e.confidence>=i.confidence&&e.answer&&(t+=e.answer.replace(/\+/g," ")+"<br />",i.options.dialogue.showMsg({date:(new Date).getTime(),content:t,from:"robot"}),i.recored.push({date:(new Date).getTime(),content:t,from:"robot"}));var n=confirm("不能查找到答案，是否需要转人工服务?");1==n&&i.options.changeToNormal()})}},cf:null,ncRobot:function(e){if(e){var i=this,n=i.options.dialogue;t.ajax({type:"POST",url:"echatManager.do?method=automaticResponse",data:{companyPk:i.options.companyPk,question:e,chatId:i.options.chatId,visitorName:i.options.visitorName,langPk:i.options.langPk,"true":i.click},dataType:"json"}).done(function(t){if(i.isUse)if(i.click=!1,1==t.reply)i.ncRobotTime=0,n.showMsg({date:(new Date).getTime(),content:t.answer,from:"robot"}),i.recored.push({date:(new Date).getTime(),content:t.answer,from:"robot"});else if(i.ncRobotTime++,i.ncRobotTime>=i.nc.number){if(i.choose)return;1==i.choose,i.cf||(i.cf=confirm("不能查找到答案，是否需要转人工服务?"),1==i.cf?(i.options.changeToNormal(),i.choose=!1):(i.cf=null,n.showMsg({date:(new Date).getTime(),content:i.nc.answer,from:"robot"}),i.recored.push({date:(new Date).getTime(),content:i.nc.answer,from:"robot"}),i.choose=!1,i.ncRobotTime=0))}else{var o=0;for(var a in i.nc.questions){var s=i.nc.questions[a];if(s==e){if(o=1,i.choose)return;1==i.choose,i.cf||(i.cf=confirm("不能查找到答案，是否需要转人工服务?"),1==i.cf?(i.choose=!1,i.options.changeToNormal()):(i.cf=null,o=0,i.choose=!1,i.ncRobotTime=0))}}0==o&&(n.showMsg({date:(new Date).getTime(),content:i.nc.answer,from:"robot"}),i.recored.push({date:(new Date).getTime(),content:i.nc.answer,from:"robot"}))}}).fail(function(){if(i.isUse)if(i.click=!1,i.ncRobotTime++,i.ncRobotTime>=i.nc.number){if(i.choose)return;1==i.choose,i.cf||(i.cf=confirm("不能查找到答案，是否需要转人工服务?"),1==i.cf?(i.choose=!1,i.options.changeToNormal()):(i.cf=null,n.showMsg({date:(new Date).getTime(),content:i.nc.answer,from:"robot"}),i.recored.push({date:(new Date).getTime(),content:i.nc.answer,from:"robot"}),i.choose=!1,i.ncRobotTime=0))}else{var t=0;for(var o in i.nc.questions){var a=i.nc.questions[o];if(a==e){if(t=1,i.choose)return;1==i.choose,i.cf||(i.cf=confirm("不能查找到答案，是否需要转人工服务?"),1==i.cf?(i.choose=!1,i.options.changeToNormal()):(i.cf=null,t=0,i.choose=!1,i.ncRobotTime=0))}}0==t&&(n.showMsg({date:(new Date).getTime(),content:i.nc.answer,from:"robot"}),i.recored.push({date:(new Date).getTime(),content:i.nc.answer,from:"robot"}))}})}},ywRobot:function(e){if(e){var n=this,o=n.options.dialogue;t.ajax({type:"POST",url:"echatManager.do?method=loadSelfService2",data:{chatId:n.options.chatId,companyPk:n.options.companyPk,content:encodeURIComponent(e)},dataType:"json"}).done(function(e){var a="";e&&"Artificial customer service"!=e.answer&&null!=e.answer&&""!=e.answer&&e.answer!=i?(a=e.answer.replace(/\+/g," ")+"<br />",o.showMsg({date:(new Date).getTime(),content:a+"<br />单击<a href='javascript:' class='robo'><span style='color: red;'>转人工</span></a>进行提问。",from:"robot",status:0}),n.recored.push({date:(new Date).getTime(),content:a+"<br />单击<a href='javascript:' class='robo'><span style='color: red;'>转人工</span></a>进行提问。",from:"robot"})):(o.showMsg({date:(new Date).getTime(),content:"<div id='conId'>您好，我正在成长过程中，您的这个问题可能已经超出了我目前的知识范围。单击<a href='javascript:' class='robo'><span style='color: red;'>转人工</span></a>进行提问。</div>",from:"robot",status:0}),n.recored.push({date:(new Date).getTime(),content:"<div id='conId'>您好，我正在成长过程中，您的这个问题可能已经超出了我目前的知识范围。单击<a href='javascript:' class='robo'><span style='color: red;'>转人工</span></a>进行提问。</div>",from:"robot"})),t(".robo").click(function(){n.options.changeToNormal()})})}},oldNcRobot:function(e){if(e){var i=this,n=i.options.dialogue,o="";t.ajax({type:"POST",url:"echatManager.do?method=loadSelfService",data:{chatId:i.options.chatId,companyPk:i.options.companyPk,content:encodeURIComponent(e)},dataType:"json"}).done(function(e){if(e&&e.length>1)t.each(e,function(t){o+=e[t].text.replace(/\+/g," ")+"<br />"}),n.showMsg({msgid:"",date:(new Date).getTime(),content:o,from:"client",status:0});else if(e&&1==e.length)o+="<div>"+e[0].text.replace(/\+/g," ")+"</div>",n.showMsg({msgid:"",date:(new Date).getTime(),content:o,from:"client",status:0});else{var a=confirm("不能查找到答案，是否需要转人工服务?");1==a?i.options.changeToNormal():i.ncRobotTime=0}})}}},t.robot=function(e){var t=new n(e);return t.recored=[],t.init(),t}}(window,jQuery),function(e,t,i){var n=function(e){this.defaults={companyPk:"",defaultLangPk:"",langMap:{},show:function(e){}},this.options=t.extend({},this.defaults,e)};n.prototype={type:{system:1,operator:2},key:{welcome_1:1,welcome_2:2,chat_ad:3,cs_busy:4,no_answer_close:5,no_answer_hint:6,dialog_start:7},langMap:{},init:function(){var e=this;return"{}"!=JSON.stringify(e.options.langMap)?void(e.langMap=e.options.langMap):void t.ajax({type:"POST",url:"echatManager.do?method=getLangList",async:!1,data:{companyPk:e.options.companyPk,langPk:e.options.defaultLangPk},dataType:"json"}).done(function(t){t&&(e.langMap=t)})},show:function(e,i){var n=this;1==e?n.langMap&&n.langMap[i]&&n.options.show(n.langMap[i]):t.ajax({type:"POST",url:"echatManager.do?method=getLangListByPk",async:!1,data:{companyPk:n.options.companyPk,langPk:n.options.defaultLangPk,langType:e,langKey:i},dataType:"json"}).done(function(e){e&&n.options.show(e)})}},t.langTip=function(e){var t=new n(e);return t.init(),t}}(window,jQuery),function(e,t,i){var n=function(e){this.defaults={open:"1",storage:null,time:6e4,num:5,blockTime:5e3,url:"./overLoad.jsp"},this.options=t.extend({},this.defaults,e)};n.prototype={init:function(){if("0"!=this.options.open){var t=this,i=this.options.storage,n=i.get("vLimit"),o=i.get("isLimit"),a=[],s=(new Date).getTime();if(n){if("islimited"==o&&s-n[n.length-1].time<=t.options.blockTime)return void(e.location.href=t.options.url);"islimited"==o&&(n=[]),i.set("isLimit","");for(var r in n)s-n[r].time<t.options.time&&a.push({time:n[r].time});if(a.push({time:s}),i.set("vLimit",a),a.length>t.options.num)return i.set("isLimit","islimited"),void(e.location.href=t.options.url)}else a.push({time:s}),i.set("vLimit",a)}}},t.visitLimit=function(e){var t=new n(e);return t}}(window,jQuery),function(e,t,i){var n=function(e){this.defaults={},this.options=t.extend({},this.defaults,e)};n.prototype={allDB:{},id:0,db:{},add:function(e){var t=this,i={msgId:e.msgId?e.msgId:"",type:e.type,content:e.content,time:e.date?e.date:(new Date).getTime(),isRevoke:!!e.isRevoke&&e.isRevoke,hasChecked:!!e.hasChecked&&e.hasChecked,status:e.status?e.status:0,saveIn:e.saveIn?e.saveIn:0,received:0,checkSend:0};t.db[t.id]=i,t.allDB[t.id]=i,t.id++},clear:function(){var e=this;e.db={}},last:function(){var e=this,t=0;for(var i in e.db)!isNaN(Number(i))&&Number(t)<=Number(i)&&(t=i);return t},setKey:function(e,t,i){var n=this;for(var o in n.db)e==o&&(n.db[o][t]=i,n.allDB[o][t]=i)},set:function(e,t,i){var n=this;for(var o in n.db)n.db[o].msgId==e&&(n.db[o][t]=i,n.allDB[o][t]=i)},get:function(e){var t=this;for(var i in t.db)if(t.db[i].msgId==e)return t.db[i]},getAll:function(){return this.db}},t.msgdb=function(e){var t=new n(e);return t}}(window,jQuery),function(e,t,i){var n=function(e){this.defaults={userDatas:null,storage:null},this.options=t.extend({},this.defaults,e)};n.prototype={init:function(e){var i=nowtime.getTime(),n=this,o=n.options.storage,a=o.get("ncVisitor")?o.get("ncVisitor"):{},s=n.getTrace(),r=s.result,c=n.getInfo();o.set("visitorId",c.visitorId),o.set("visitorName",c.visitorName),c=n.changeFirstTime(c,r),a.trace=r,a.info=c,o.set("ncVisitor",a);var l=c;i-c.lastTime>6e5||!s.hasVal?l.trace=[s.item]:l.trace=[],t.ajax({url:baseUrl+"/visitorMonitor.do",type:"get",dataType:"jsonp",data:{method:"setVisitorMonitor",monitorInfo:encodeURIComponent(JSON.stringify(l))}})},changeFirstTime:function(e,t){var i,n=e,o=n.firstTime;for(var a in t)(!i||i>t[a].firstInTime)&&(i&&new Date(t[a].firstInTime).Format("yyyy-mm-dd")!=nowtime.Format("yyyy-mm-dd")||(i=t[a].firstInTime));return n.firstTime=i?i:o,new Date(n.firstTime).Format("yyyy-mm-dd")!=nowtime.Format("yyyy-mm-dd")&&(n.firstTime=n.lastTime),n},get:function(){var e=mo.options.storage,t=e.get("route");return t},getInfo:function(){var e=this,t=(e.options.storage,e.options.userDatas),i=t.getJsonStr(),n=e.getAllTime(i);return i.firstTime=n.firstTime,i.lastTime=n.lastTime,i.status="broswer",i},getAllTime:function(e){var t=nowtime.getTime();return{firstTime:e&&e.firstTime?e.firstTime:t,lastTime:t}},getTrace:function(){var e=nowtime.getTime(),i=this,n=i.options.storage,o=n.get("ncVisitor"),a=o?o.trace:null,s=[],r=null,c=!1;if(a){for(var l in a)if(a[l]){var d=a[l];decodeURIComponent(d.url)==location.href&&(c=!0,d.inTime=e,r=d),s.push(d)}c||(r={url:location.href,firstInTime:e,inTime:e,title:t("title").html()},s.push(r))}else r={url:location.href,firstInTime:e,inTime:e,title:t("title").html()},s.push(r);return s.length>10&&(s=s.sort(function(e,t){return e.inTime<t.inTime}),s.pop()),s=s.sort(function(e,t){return e.firstInTime<t.firstInTime}),{item:r,result:s,hasVal:c}}},t.monitor=function(e){var t=new n(e);return t.init(),t}}(window,jQuery),function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery"],e):e("undefined"!=typeof jQuery?jQuery:window.Zepto)}(function(e){"use strict";function t(t){var i=t.data;t.isDefaultPrevented()||(t.preventDefault(),e(t.target).ajaxSubmit(i))}function i(t){var i=t.target,n=e(i);if(!n.is("[type=submit],[type=image]")){var o=n.closest("[type=submit]");if(0===o.length)return;i=o[0]}var a=this;if(a.clk=i,"image"==i.type)if(void 0!==t.offsetX)a.clk_x=t.offsetX,a.clk_y=t.offsetY;else if("function"==typeof e.fn.offset){var s=n.offset();a.clk_x=t.pageX-s.left,a.clk_y=t.pageY-s.top}else a.clk_x=t.pageX-i.offsetLeft,a.clk_y=t.pageY-i.offsetTop;setTimeout(function(){a.clk=a.clk_x=a.clk_y=null},100)}function n(){if(e.fn.ajaxSubmit.debug){var t="[jquery.form] "+Array.prototype.join.call(arguments,"");window.console&&window.console.log?window.console.log(t):window.opera&&window.opera.postError&&window.opera.postError(t)}}var o={};o.fileapi=void 0!==e("<input type='file'/>").get(0).files,o.formdata=void 0!==window.FormData;var a=!!e.fn.prop;e.fn.attr2=function(){if(!a)return this.attr.apply(this,arguments);var e=this.prop.apply(this,arguments);return e&&e.jquery||"string"==typeof e?e:this.attr.apply(this,arguments)},e.fn.ajaxSubmit=function(t){function i(i){var n,o,a=e.param(i,t.traditional).split("&"),s=a.length,r=[];for(n=0;n<s;n++)a[n]=a[n].replace(/\+/g," "),o=a[n].split("="),r.push([decodeURIComponent(o[0]),decodeURIComponent(o[1])]);return r}function s(n){for(var o=new FormData,a=0;a<n.length;a++)o.append(n[a].name,n[a].value);if(t.extraData){var s=i(t.extraData);for(a=0;a<s.length;a++)s[a]&&o.append(s[a][0],s[a][1])}t.data=null;var r=e.extend(!0,{},e.ajaxSettings,t,{contentType:!1,processData:!1,cache:!1,type:c||"POST"});t.uploadProgress&&(r.xhr=function(){var i=e.ajaxSettings.xhr();return i.upload&&i.upload.addEventListener("progress",function(e){var i=0,n=e.loaded||e.position,o=e.total;e.lengthComputable&&(i=Math.ceil(n/o*100)),t.uploadProgress(e,n,o,i)},!1),i}),r.data=null;var l=r.beforeSend;return r.beforeSend=function(e,i){t.formData?i.data=t.formData:i.data=o,l&&l.call(this,e,i)},e.ajax(r)}function r(i){function o(e){var t=null;try{e.contentWindow&&(t=e.contentWindow.document)}catch(i){n("cannot get iframe.contentWindow document: "+i)}if(t)return t;try{t=e.contentDocument?e.contentDocument:e.document}catch(i){n("cannot get iframe.contentDocument: "+i),t=e.document}return t}function s(){function t(){try{var e=o(v).readyState;n("state = "+e),e&&"uninitialized"==e.toLowerCase()&&setTimeout(t,50)}catch(i){n("Server abort: ",i," (",i.name,")"),r(C),I&&clearTimeout(I),I=void 0}}var i=u.attr2("target"),a=u.attr2("action"),s="multipart/form-data",l=u.attr("enctype")||u.attr("encoding")||s;T.setAttribute("target",m),c&&!/post/i.test(c)||T.setAttribute("method","POST"),a!=p.url&&T.setAttribute("action",p.url),p.skipEncodingOverride||c&&!/post/i.test(c)||u.attr({encoding:"multipart/form-data",enctype:"multipart/form-data"}),p.timeout&&(I=setTimeout(function(){k=!0,r(x)},p.timeout));var d=[];try{if(p.extraData)for(var g in p.extraData)p.extraData.hasOwnProperty(g)&&(e.isPlainObject(p.extraData[g])&&p.extraData[g].hasOwnProperty("name")&&p.extraData[g].hasOwnProperty("value")?d.push(e('<input type="hidden" name="'+p.extraData[g].name+'">').val(p.extraData[g].value).appendTo(T)[0]):d.push(e('<input type="hidden" name="'+g+'">').val(p.extraData[g]).appendTo(T)[0]));p.iframeTarget||h.appendTo("body"),v.attachEvent?v.attachEvent("onload",r):v.addEventListener("load",r,!1),setTimeout(t,15);try{T.submit()}catch(f){var w=document.createElement("form").submit;w.apply(T)}}finally{T.setAttribute("action",a),T.setAttribute("enctype",l),i?T.setAttribute("target",i):u.removeAttr("target"),e(d).remove()}}function r(t){if(!w.aborted&&!E){if(N=o(v),N||(n("cannot access response document"),t=C),t===x&&w)return w.abort("timeout"),void S.reject(w,"timeout");if(t==C&&w)return w.abort("server abort"),void S.reject(w,"error","server abort");if(N&&N.location.href!=p.iframeSrc||k){v.detachEvent?v.detachEvent("onload",r):v.removeEventListener("load",r,!1);var i,a="success";try{if(k)throw"timeout";var s="xml"==p.dataType||N.XMLDocument||e.isXMLDoc(N);if(n("isXml="+s),!s&&window.opera&&(null===N.body||!N.body.innerHTML)&&--L)return n("requeing onLoad callback, DOM not available"),void setTimeout(r,250);var c=N.body?N.body:N.documentElement;w.responseText=c?c.innerHTML:null,w.responseXML=N.XMLDocument?N.XMLDocument:N,s&&(p.dataType="xml"),w.getResponseHeader=function(e){var t={"content-type":p.dataType};return t[e.toLowerCase()]},c&&(w.status=Number(c.getAttribute("status"))||w.status,w.statusText=c.getAttribute("statusText")||w.statusText);var l=(p.dataType||"").toLowerCase(),d=/(json|script|text)/.test(l);if(d||p.textarea){var u=N.getElementsByTagName("textarea")[0];if(u)w.responseText=u.value,w.status=Number(u.getAttribute("status"))||w.status,w.statusText=u.getAttribute("statusText")||w.statusText;else if(d){var m=N.getElementsByTagName("pre")[0],f=N.getElementsByTagName("body")[0];m?w.responseText=m.textContent?m.textContent:m.innerText:f&&(w.responseText=f.textContent?f.textContent:f.innerText)}}else"xml"==l&&!w.responseXML&&w.responseText&&(w.responseXML=j(w.responseText));try{M=F(w,l,p)}catch(y){a="parsererror",w.error=i=y||a}}catch(y){n("error caught: ",y),a="error",w.error=i=y||a}w.aborted&&(n("upload aborted"),a=null),w.status&&(a=w.status>=200&&w.status<300||304===w.status?"success":"error"),"success"===a?(p.success&&p.success.call(p.context,M,"success",w),S.resolve(w.responseText,"success",w),g&&e.event.trigger("ajaxSuccess",[w,p])):a&&(void 0===i&&(i=w.statusText),p.error&&p.error.call(p.context,w,a,i),S.reject(w,"error",i),g&&e.event.trigger("ajaxError",[w,p,i])),g&&e.event.trigger("ajaxComplete",[w,p]),g&&!--e.active&&e.event.trigger("ajaxStop"),p.complete&&p.complete.call(p.context,w,a),E=!0,p.timeout&&clearTimeout(I),setTimeout(function(){p.iframeTarget?h.attr("src",p.iframeSrc):h.remove(),w.responseXML=null},100)}}}var l,d,p,g,m,h,v,w,y,b,k,I,T=u[0],S=e.Deferred();if(S.abort=function(e){w.abort(e)},i)for(d=0;d<f.length;d++)l=e(f[d]),a?l.prop("disabled",!1):l.removeAttr("disabled");if(p=e.extend(!0,{},e.ajaxSettings,t),p.context=p.context||p,m="jqFormIO"+(new Date).getTime(),p.iframeTarget?(h=e(p.iframeTarget),b=h.attr2("name"),b?m=b:h.attr2("name",m)):(h=e('<iframe name="'+m+'" src="'+p.iframeSrc+'" />'),h.css({position:"absolute",top:"-1000px",left:"-1000px"})),v=h[0],w={aborted:0,responseText:null,responseXML:null,status:0,statusText:"n/a",getAllResponseHeaders:function(){},getResponseHeader:function(){},setRequestHeader:function(){},abort:function(t){var i="timeout"===t?"timeout":"aborted";n("aborting upload... "+i),this.aborted=1;try{v.contentWindow.document.execCommand&&v.contentWindow.document.execCommand("Stop")}catch(o){}h.attr("src",p.iframeSrc),w.error=i,p.error&&p.error.call(p.context,w,i,t),g&&e.event.trigger("ajaxError",[w,p,i]),p.complete&&p.complete.call(p.context,w,i)}},g=p.global,g&&0===e.active++&&e.event.trigger("ajaxStart"),g&&e.event.trigger("ajaxSend",[w,p]),p.beforeSend&&p.beforeSend.call(p.context,w,p)===!1)return p.global&&e.active--,S.reject(),S;if(w.aborted)return S.reject(),S;y=T.clk,y&&(b=y.name,b&&!y.disabled&&(p.extraData=p.extraData||{},p.extraData[b]=y.value,"image"==y.type&&(p.extraData[b+".x"]=T.clk_x,p.extraData[b+".y"]=T.clk_y)));var x=1,C=2,D=e("meta[name=csrf-token]").attr("content"),P=e("meta[name=csrf-param]").attr("content");P&&D&&(p.extraData=p.extraData||{},p.extraData[P]=D),p.forceSync?s():setTimeout(s,10);var M,N,E,L=50,j=e.parseXML||function(e,t){return window.ActiveXObject?(t=new ActiveXObject("Microsoft.XMLDOM"),t.async="false",t.loadXML(e)):t=(new DOMParser).parseFromString(e,"text/xml"),t&&t.documentElement&&"parsererror"!=t.documentElement.nodeName?t:null},O=e.parseJSON||function(e){return window.eval("("+e+")")},F=function(t,i,n){var o=t.getResponseHeader("content-type")||"",a="xml"===i||!i&&o.indexOf("xml")>=0,s=a?t.responseXML:t.responseText;return a&&"parsererror"===s.documentElement.nodeName&&e.error&&e.error("parsererror"),n&&n.dataFilter&&(s=n.dataFilter(s,i)),"string"==typeof s&&("json"===i||!i&&o.indexOf("json")>=0?s=O(s):("script"===i||!i&&o.indexOf("javascript")>=0)&&e.globalEval(s)),s};return S}if(!this.length)return n("ajaxSubmit: skipping submit process - no element selected"),this;var c,l,d,u=this;"function"==typeof t?t={success:t}:void 0===t&&(t={}),c=t.type||this.attr2("method"),l=t.url||this.attr2("action"),d="string"==typeof l?e.trim(l):"",d=d||window.location.href||"",d&&(d=(d.match(/^([^#]+)/)||[])[1]),t=e.extend(!0,{url:d,success:e.ajaxSettings.success,type:c||e.ajaxSettings.type,iframeSrc:/^https/i.test(window.location.href||"")?"javascript:false":"about:blank"},t);var p={};if(this.trigger("form-pre-serialize",[this,t,p]),p.veto)return n("ajaxSubmit: submit vetoed via form-pre-serialize trigger"),this;if(t.beforeSerialize&&t.beforeSerialize(this,t)===!1)return n("ajaxSubmit: submit aborted via beforeSerialize callback"),this;var g=t.traditional;void 0===g&&(g=e.ajaxSettings.traditional);var m,f=[],h=this.formToArray(t.semantic,f);if(t.data&&(t.extraData=t.data,m=e.param(t.data,g)),t.beforeSubmit&&t.beforeSubmit(h,this,t)===!1)return n("ajaxSubmit: submit aborted via beforeSubmit callback"),this;if(this.trigger("form-submit-validate",[h,this,t,p]),p.veto)return n("ajaxSubmit: submit vetoed via form-submit-validate trigger"),this;var v=e.param(h,g);m&&(v=v?v+"&"+m:m),"GET"==t.type.toUpperCase()?(t.url+=(t.url.indexOf("?")>=0?"&":"?")+v,t.data=null):t.data=v;var w=[];if(t.resetForm&&w.push(function(){u.resetForm()}),t.clearForm&&w.push(function(){u.clearForm(t.includeHidden)}),!t.dataType&&t.target){var y=t.success||function(){};w.push(function(i){var n=t.replaceTarget?"replaceWith":"html";e(t.target)[n](i).each(y,arguments)})}else t.success&&w.push(t.success);if(t.success=function(e,i,n){for(var o=t.context||this,a=0,s=w.length;a<s;a++)w[a].apply(o,[e,i,n||u,u])},t.error){var b=t.error;t.error=function(e,i,n){var o=t.context||this;b.apply(o,[e,i,n,u])}}if(t.complete){var k=t.complete;t.complete=function(e,i){var n=t.context||this;k.apply(n,[e,i,u])}}var I=e("input[type=file]:enabled",this).filter(function(){return""!==e(this).val()}),T=I.length>0,S="multipart/form-data",x=u.attr("enctype")==S||u.attr("encoding")==S,C=o.fileapi&&o.formdata;n("fileAPI :"+C);var D,P=(T||x)&&!C;t.iframe!==!1&&(t.iframe||P)?t.closeKeepAlive?e.get(t.closeKeepAlive,function(){D=r(h)}):D=r(h):D=(T||x)&&C?s(h):e.ajax(t),u.removeData("jqxhr").data("jqxhr",D);for(var M=0;M<f.length;M++)f[M]=null;return this.trigger("form-submit-notify",[this,t]),this},e.fn.ajaxForm=function(o){if(o=o||{},o.delegation=o.delegation&&e.isFunction(e.fn.on),!o.delegation&&0===this.length){var a={s:this.selector,c:this.context};return!e.isReady&&a.s?(n("DOM not ready, queuing ajaxForm"),e(function(){e(a.s,a.c).ajaxForm(o)}),this):(n("terminating; zero elements found by selector"+(e.isReady?"":" (DOM not ready)")),this)}return o.delegation?(e(document).off("submit.form-plugin",this.selector,t).off("click.form-plugin",this.selector,i).on("submit.form-plugin",this.selector,o,t).on("click.form-plugin",this.selector,o,i),this):this.ajaxFormUnbind().bind("submit.form-plugin",o,t).bind("click.form-plugin",o,i)},e.fn.ajaxFormUnbind=function(){return this.unbind("submit.form-plugin click.form-plugin")},e.fn.formToArray=function(t,i){var n=[];if(0===this.length)return n;var a,s=this[0],r=this.attr("id"),c=t?s.getElementsByTagName("*"):s.elements;if(c&&!/MSIE [678]/.test(navigator.userAgent)&&(c=e(c).get()),r&&(a=e(':input[form="'+r+'"]').get(),a.length&&(c=(c||[]).concat(a))),!c||!c.length)return n;var l,d,u,p,g,m,f;for(l=0,m=c.length;l<m;l++)if(g=c[l],u=g.name,u&&!g.disabled)if(t&&s.clk&&"image"==g.type)s.clk==g&&(n.push({name:u,value:e(g).val(),type:g.type}),n.push({name:u+".x",value:s.clk_x},{name:u+".y",value:s.clk_y}));else if(p=e.fieldValue(g,!0),p&&p.constructor==Array)for(i&&i.push(g),d=0,f=p.length;d<f;d++)n.push({name:u,value:p[d]});else if(o.fileapi&&"file"==g.type){i&&i.push(g);var h=g.files;if(h.length)for(d=0;d<h.length;d++)n.push({name:u,value:h[d],type:g.type});else n.push({name:u,value:"",type:g.type})}else null!==p&&"undefined"!=typeof p&&(i&&i.push(g),n.push({name:u,value:p,type:g.type,required:g.required}));if(!t&&s.clk){var v=e(s.clk),w=v[0];u=w.name,u&&!w.disabled&&"image"==w.type&&(n.push({name:u,value:v.val()}),n.push({name:u+".x",value:s.clk_x},{name:u+".y",value:s.clk_y}))}return n},e.fn.formSerialize=function(t){return e.param(this.formToArray(t))},e.fn.fieldSerialize=function(t){var i=[];return this.each(function(){var n=this.name;if(n){var o=e.fieldValue(this,t);if(o&&o.constructor==Array)for(var a=0,s=o.length;a<s;a++)i.push({name:n,value:o[a]});else null!==o&&"undefined"!=typeof o&&i.push({name:this.name,value:o})}}),e.param(i)},e.fn.fieldValue=function(t){for(var i=[],n=0,o=this.length;n<o;n++){var a=this[n],s=e.fieldValue(a,t);null===s||"undefined"==typeof s||s.constructor==Array&&!s.length||(s.constructor==Array?e.merge(i,s):i.push(s))}return i},e.fieldValue=function(t,i){var n=t.name,o=t.type,a=t.tagName.toLowerCase();if(void 0===i&&(i=!0),i&&(!n||t.disabled||"reset"==o||"button"==o||("checkbox"==o||"radio"==o)&&!t.checked||("submit"==o||"image"==o)&&t.form&&t.form.clk!=t||"select"==a&&t.selectedIndex==-1))return null;if("select"==a){var s=t.selectedIndex;if(s<0)return null;for(var r=[],c=t.options,l="select-one"==o,d=l?s+1:c.length,u=l?s:0;u<d;u++){var p=c[u];if(p.selected){var g=p.value;if(g||(g=p.attributes&&p.attributes.value&&!p.attributes.value.specified?p.text:p.value),l)return g;r.push(g)}}return r}return e(t).val()},e.fn.clearForm=function(t){return this.each(function(){e("input,select,textarea",this).clearFields(t)})},e.fn.clearFields=e.fn.clearInputs=function(t){var i=/^(?:color|date|datetime|email|month|number|password|range|search|tel|text|time|url|week)$/i;
return this.each(function(){var n=this.type,o=this.tagName.toLowerCase();i.test(n)||"textarea"==o?this.value="":"checkbox"==n||"radio"==n?this.checked=!1:"select"==o?this.selectedIndex=-1:"file"==n?/MSIE/.test(navigator.userAgent)?e(this).replaceWith(e(this).clone(!0)):e(this).val(""):t&&(t===!0&&/hidden/.test(n)||"string"==typeof t&&e(this).is(t))&&(this.value="")})},e.fn.resetForm=function(){return this.each(function(){("function"==typeof this.reset||"object"==typeof this.reset&&!this.reset.nodeType)&&this.reset()})},e.fn.enable=function(e){return void 0===e&&(e=!0),this.each(function(){this.disabled=!e})},e.fn.selected=function(t){return void 0===t&&(t=!0),this.each(function(){var i=this.type;if("checkbox"==i||"radio"==i)this.checked=t;else if("option"==this.tagName.toLowerCase()){var n=e(this).parent("select");t&&n[0]&&"select-one"==n[0].type&&n.find("option").selected(!1),this.selected=t}})},e.fn.ajaxSubmit.debug=!1}),function(e,t,i){"use strict";var n=function(e,i){this.$el=e,this.defaults={other:function(e,t){},uploadType:"all",size:0,inputImage:!1,callback:function(e){},error:function(e){}},this.options=t.extend({},this.defaults,i)};n.prototype={errorCodes:{E001:"身份认证错误",E002:"上传文件类型错误，只允许上传.jpg .jpeg .bmp .png .doc .docx .xls .xlsx .pdf .txt .amr .ppt .pptx .csv",E003:""},init:function(){var e=this;this.options.uploadType,this.options.size;e.create()},create:function(){var e=this,i=this.options.uploadType,n=this.options.size,o=e.$el;e.$el.find(".fileup").length>0&&e.$el.find(".fileup").remove();var a="/any800/echatManager.do?method=uploadFile&fromType=visitor&chatId="+ucc.chatID,s="*/*";e.options.inputImage&&(s="image/*");var r='<form class="fileup" contentType="text/html"   method="post"  enctype="multipart/form-data" action="'+a+'"><input multiple="false" type="file" name="uploadField" accept="'+s+'" /></form>';t(o).append(r);var c=e.$el.find(".fileup").find("input:file");c.on("change",function(){var t=c[0],o=t.value,a=o.substring(o.lastIndexOf(".")).toLowerCase();return e.checkType(a,i)?t.files&&n&&n<t.files[0].size?(e.create(),void e.options.error("size")):void e.options.other(e,t.files?t.files[0].name:o,(new Date).getTime()):(e.create(),void e.options.error("type"))})},submit:function(e,t){var i=this;0!=i.$el.find(".fileup").length&&i.$el.find(".fileup").ajaxSubmit(function(n){var o=JSON.parse(n);o.success?i.options.callback(o.content,e,t):i.options.error("other",e,o.errorMessage,t),i.create()})},checkType:function(e,t){if(e=e.toLowerCase(),"all"==t)return e.match(/.gif|.jpg|.jpeg|.bmp|.png|.doc|.docx|.xls|.xlsx|.pdf|.txt/i);var i=t.split(";");if(i.length>0){for(var n in i)if("image"==i[n]){if(e.match(/.gif|.jpg|.jpeg|.bmp|.png/i))return!0}else if("doc"==i[n]){if(e.match(/.doc|.docx/i))return!0}else if("xls"==i[n]){if(e.match(/.xls|.xlsx/i))return!0}else if("pdf"==i[n]){if(e.match(/.pdf/i))return!0}else if("txt"==i[n]&&e.match(/.txt/i))return!0;return!1}}},t.fn.uploadFile=function(e){var i=new n(t(this),e);return i.init(),i}}(window,jQuery),function(e,t,i){var n=function(e){this.defaults={storage:null,loadMore:function(e){}},this.options=t.extend({},this.defaults,e)};n.prototype={current:[],history:[],time:0,init:function(){this.current=this.options.storage.get("localCur")?this.options.storage.get("localCur"):[],this.history=this.options.storage.get("localHis")?this.options.storage.get("localHis"):[],this.time=this.options.storage.get("localTim")?this.options.storage.get("localTim"):(new Date).getTime(),this.history.length>0&&(this.lastChat=this.history.length-1,this.lastId=this.history[this.lastChat].data.length-1)},setCurrent:function(e){var t=[];for(var i in e)if(!isNaN(Number(i))){var n=e[i];if(0==n.saveIn&&!n.isRevoke&&"system"!=n.type&&1!=n.status&&2!=n.checkSend){var o="client"==n.type?dialogue.getAttr("operatorName"):"visitor"==n.type?userDatas.getVisitorInfo().visitorName:"robot"==n.type?"机器人":"";t.push({from:n.type,content:n.content,time:n.time,opName:o})}}this.options.storage.set("localTim",this.time),this.options.storage.set("localCur",t),this.current=t},saveCurrent:function(){if(this.current.length>0){if(this.history.length>0&&this.time==this.history[this.history.length-1].time)return;this.history.push({data:this.current,time:this.time}),this.current=[],this.save()}this.time=(new Date).getTime(),this.options.storage.set("localTim",this.time)},save:function(){this.options.storage.set("localCur",this.current),this.options.storage.set("localHis",this.history)},lastId:0,lastChat:0,page:5,loadMore:function(){for(var e=[],t=0,i=this.page;t<i;){var n=this.preload(this.lastChat,this.lastId);if(!n)break;e.push(n),"date"!=n.type&&t++}this.options.loadMore(e)},preload:function(e,t){if(e==-1)return"";if(t==-1)return this.lastChat=e-1,this.lastChat==-1?"":(this.lastId=this.history[this.lastChat].data.length-1,{type:"date",time:this.history[this.lastChat].time});var i=this.history[this.lastChat].data[this.lastId];return this.lastId=this.lastId-1,i}},t.localHistory=function(e){var t=new n(e);return t}}(window,jQuery),function(e,t,i){var n=function(e){this.defaults={},this.options=t.extend({},this.defaults,e)};n.prototype={defered:null,init:function(){var e=this;t(".confirmBox").length>0||(t("body").append("<div class='confirmBox'><div class='body'><div class='title'></div><div class='rightBtn'></div><div class='wrongBtn'></div></div></div>"),t(".confirmBox .rightBtn").on("click",function(){e.defered&&e.defered.resolve(!0),t(".confirmBox").hide(),e.defered=null}),t(".confirmBox .wrongBtn").on("click",function(){e.defered&&e.defered.resolve(!1),t(".confirmBox").hide(),e.defered=null}),t(".confirmBox").hide())},create:function(e,i,n){var o=this;return i=i?i:"确定",n=n?n:"取消",t(".confirmBox").show(),o.switchTitle(e,i,n),o.defered&&o.defered.resolve(!1),o.defered=new t.Deferred,o.defered.promise()},switchTitle:function(e,i,n){t(".confirmBox .title").html(e),t(".confirmBox .rightBtn").html(i),t(".confirmBox .wrongBtn").html(n);var o=t(".confirmBox").height()/2-t(".confirmBox .body").height()/2;t(".confirmBox .body").css({marginTop:o})}},t.confirm=function(e){var t=new n(e);return t.init(),t}}(window,jQuery),function(e,t,i){var n=function(e){this.defaults={path:"/any800/UccWebSocket/",visitorId:"",message:function(e,t){},deal:function(e,t,i){},connect:function(e){},confirmSend:function(e){},leaveCover:function(){},open:function(){}},this.options=t.extend({},this.defaults,e)},o={pong:0,sendTime:2,checkTime:3,warnTime:10,reconnectTime:20,connnectNumber:0,connectTime:-1,w:null,init:function(e){var t=this;t.w=e,this.interval&&clearInterval(this.interval),t.check(),this.interval=setInterval(function(){t.check()},1e3*this.checkTime)},setPong:function(){this.pong=(new Date).getTime()},check:function(){return this.w.websocket.isConnect=!0,navigator&&0==navigator.onLine?(this.w.endTimeout(),console.log("navigator offline"),void(this.w.websocket.isConnect=!1)):void(this.w&&this.w.websocket&&this.w.websocket.readyState==this.w.websocket.CLOSED&&(this.w.websocket.isConnect=!1,this.w.endTimeout()))},setRate:function(){if(this.pong){var e=(new Date).getTime(),t=(e-this.pong)/1e3;t=Math.max(t,20),this.reconnectTime=t,this.warnTime=t/2,storage.set("reconnectTime",t)}},sendPing:function(){var e=new a({date:(new Date).getTime(),chatId:"",type:"PING"});this.w.send(JSON.stringify(e)),this.ping=(new Date).getTime()},end:function(){this.interval&&clearInterval(this.interval),this.w.websocket.readyState!=this.w.websocket.CLOSED&&this.w.websocket.close(),this.connnectNumber++},reconnect:function(){var e=!1;return this.connnectNumber<=this.connectTime&&(e=!0,this.w.reconnect()),e}},a=function(e){var t=this;return t.chatId=e.chatID,t.type=e.type?e.type:"VS_CHAT",t.content=JSON.stringify(new c(e.message)),t.messageId="Other"+e.date,t},s=function(e){var t=this;return t.chatId=e.chatID,t.type=e.type?e.type:"VS_CHAT",t.content=e.message,t.messageId="Other"+e.date,t},r=function(e){var t=this;return t.type="RECEIPTS",t.messageId=e,t},c=function(e){var t=this;return t.msg=e,t},l=new t.Deferred;n.prototype={isWork:!1,isConnect:!1,connectTimeout:null,websocket:null,keepAliveModel:!0,init:function(){var t=this;storage.get("webSocketIsWork");return e.WebSocket&&e.WebSocket.prototype.send&&"true"==t.options.isWs&&(t.isWork=!0),t.isWork&&(t.reconnectionFun(),t.connect()),t.isWork?l.promise():l.resolve(!1)},reconnectionFun:function(){var t=this;if(t.isWork)return e.WebSocket||e.MozWebSocket},getWebSocketUri:function(){return("http:"==e.location.protocol?"ws://":"wss://")+(""==document.location.hostname?"localhost":document.location.hostname)+(""==document.location.port?"":":"+document.location.port)+this.options.path+this.options.visitorId},connectType:0,connect:function(){var t=this;if(t.isWork&&(!t.websocket||t.websocket.readyState==WebSocket.CLOSED)){var i=e.WebSocket||e.MozWebSocket;t.websocket=new i(t.getWebSocketUri()),t.websocket.onopen=t.doOpen,t.websocket.onerror=t.doError,t.websocket.onclose=t.doClose,t.websocket.onmessage=t.doMessage,t.connectType=1}},doOpen:function(){var e=this;l.resolve(!0),console.log("Info: WebSocket connection opened."),e.isConnect=!0,webSocket.hasOpend=!0,webSocket.startTimeout(),webSocket.pingTime=0,webSocket.pongTime=0,webSocket.options.open(),webSocket.connectType=2,o.connnectNumber=0,storage.set("webSocketIsWork",!0)},pingTime:0,pongTime:0,sendPing:function(){var e=this;e.pingTime&&e.pongTime&&(e.pingTime-e.pongTime>3e3?e.websocket.isConnect=!1:e.websocket.isConnect=!0),e.pingTime=(new Date).getTime();var t=new a({date:(new Date).getTime(),chatId:"",type:"PING"});e.websocket&&e.websocket.send(JSON.stringify(t))},startTimeout:function(){if(this.isWork){this.keepAliveModel&&o.init(this);var e=this;e.connectTimeout&&clearTimeout(e.connectTimeout),e.connectTimeout=setTimeout(function(){e.options.connect(e.websocket.isConnect),e.websocket.isConnect||3!=e.connectType||e.websocket&&e.websocket.readyState==WebSocket.CLOSED&&e.connect(),e.startTimeout()},1e3)}},endTimeout:function(){this.keepAliveModel&&o.end();var e=this;e.connectTimeout&&clearTimeout(e.connectTimeout),e.connectTimeout=null},startReconnect:function(){var e=this;e.reconnectTimeout&&clearTimeout(e.reconnectTimeout),e.websocket&&e.websocket.isConnect||(e.connect(),e.reconnectTimeout=setTimeout(function(){e.startReconnect()},5e3))},doError:function(e){webSocket.hasOpend||(webSocket.isWork=!1,storage.set("webSocketIsWork",!1),l.resolve(!1)),console.log("Info: WebSocket error. code="+e.code)},doClose:function(e){var t=this;webSocket.hasOpend&&("1004"!=e.code&&"1006"!=e.code||webSocket.options.leaveCover(),"1006"==e.code&&webSocket.startReconnect(),console.log("Info: WebSocket closed. code="+e.code),console.log(e),t.isConnect=!1),webSocket.connectType=3},doMessage:function(e){o.setPong();console.log(e.data);var t=JSON.parse(e.data),i=t.type;if("WELCOME_TIPS"==i){var n=JSON.parse(t.content);webSocket.options.deal("CUTOMER_IS_INVITED",t.chatId,n.msg)}else if("CHAT"==i){var n=JSON.parse(t.content);webSocket.options.message(t.chatId,n.msg,t.messageId)}else if("CLOSE_ROOM"==i){var n=JSON.parse(t.content);"operatorLeaving"==n.msg?webSocket.options.deal("CLOSE",t.chatId,n.msg):webSocket.options.deal("CLOSE_CUSTOMER",t.chatId,n.msg)}else if("LEAVE_ROOM"==i){var n=JSON.parse(t.content);webSocket.options.deal("CLOSE_CUSTOMER",t.chatId,n.msg)}else if("RECEIPTS"==i){var n=JSON.parse(t.content);webSocket.options.deal("RECEIPT",t.chatId,n.targetMsgId)}else if("OPERATION_TIPS"==i){var n=JSON.parse(t.content);webSocket.options.deal(i,t.chatId,{params:n})}else if("REVOKE"==i){var n=JSON.parse(t.content);webSocket.options.deal("CUTOMER_REVOKE",t.chatId,t.messageId)}else if("VS_QUEUE_INDEX"==i){var n=JSON.parse(t.content);webSocket.options.deal("VS_QUEUE_INDEX",t.chatId,n)}else if("PONG"==i)webSocket.pongTime=(new Date).getTime();else if("DISCONNECTED_TIP"==i){var n=JSON.parse(t.content);webSocket.options.deal("CUSTOMER_NETWORK_INTERRUPT",t.chatId,n)}if("PONG"!=i&&"RECEIPTS"!=i&&null!=webSocket.websocket&&t.messageId){var a=new r(t.messageId);webSocket.websocket.send(JSON.stringify(a))}},close:function(e){var t=this;null!=t.websocket},send:function(e){var t=this;if(null!=t.websocket){var i=new a(e);t.options.confirmSend(i.messageId),t.websocket.send(JSON.stringify(i))}},queue:function(e){var t=this;if(null!=t.websocket){var i=new s(e);t.websocket.send(JSON.stringify(i))}}},t.webSocket=function(e){var t=new n(e);return t}}(window,jQuery);